(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Nw={exports:{}},Zc={},Dw={exports:{}},de={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sl=Symbol.for("react.element"),Jk=Symbol.for("react.portal"),Xk=Symbol.for("react.fragment"),Yk=Symbol.for("react.strict_mode"),Zk=Symbol.for("react.profiler"),eA=Symbol.for("react.provider"),tA=Symbol.for("react.context"),nA=Symbol.for("react.forward_ref"),rA=Symbol.for("react.suspense"),sA=Symbol.for("react.memo"),iA=Symbol.for("react.lazy"),hy=Symbol.iterator;function oA(n){return n===null||typeof n!="object"?null:(n=hy&&n[hy]||n["@@iterator"],typeof n=="function"?n:null)}var Vw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ow=Object.assign,Mw={};function oo(n,e,t){this.props=n,this.context=e,this.refs=Mw,this.updater=t||Vw}oo.prototype.isReactComponent={};oo.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};oo.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Lw(){}Lw.prototype=oo.prototype;function Jm(n,e,t){this.props=n,this.context=e,this.refs=Mw,this.updater=t||Vw}var Xm=Jm.prototype=new Lw;Xm.constructor=Jm;Ow(Xm,oo.prototype);Xm.isPureReactComponent=!0;var fy=Array.isArray,jw=Object.prototype.hasOwnProperty,Ym={current:null},Fw={key:!0,ref:!0,__self:!0,__source:!0};function Uw(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)jw.call(e,r)&&!Fw.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var u=Array(a),c=0;c<a;c++)u[c]=arguments[c+2];s.children=u}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:sl,type:n,key:i,ref:o,props:s,_owner:Ym.current}}function aA(n,e){return{$$typeof:sl,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Zm(n){return typeof n=="object"&&n!==null&&n.$$typeof===sl}function lA(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var my=/\/+/g;function xh(n,e){return typeof n=="object"&&n!==null&&n.key!=null?lA(""+n.key):e.toString(36)}function wu(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case sl:case Jk:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+xh(o,0):r,fy(s)?(t="",n!=null&&(t=n.replace(my,"$&/")+"/"),wu(s,e,t,"",function(c){return c})):s!=null&&(Zm(s)&&(s=aA(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(my,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",fy(n))for(var a=0;a<n.length;a++){i=n[a];var u=r+xh(i,a);o+=wu(i,e,t,u,s)}else if(u=oA(n),typeof u=="function")for(n=u.call(n),a=0;!(i=n.next()).done;)i=i.value,u=r+xh(i,a++),o+=wu(i,e,t,u,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function zl(n,e,t){if(n==null)return n;var r=[],s=0;return wu(n,r,"","",function(i){return e.call(t,i,s++)}),r}function uA(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ft={current:null},xu={transition:null},cA={ReactCurrentDispatcher:Ft,ReactCurrentBatchConfig:xu,ReactCurrentOwner:Ym};function $w(){throw Error("act(...) is not supported in production builds of React.")}de.Children={map:zl,forEach:function(n,e,t){zl(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return zl(n,function(){e++}),e},toArray:function(n){return zl(n,function(e){return e})||[]},only:function(n){if(!Zm(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};de.Component=oo;de.Fragment=Xk;de.Profiler=Zk;de.PureComponent=Jm;de.StrictMode=Yk;de.Suspense=rA;de.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cA;de.act=$w;de.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Ow({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Ym.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(u in e)jw.call(e,u)&&!Fw.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=t;else if(1<u){a=Array(u);for(var c=0;c<u;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:sl,type:n.type,key:s,ref:i,props:r,_owner:o}};de.createContext=function(n){return n={$$typeof:tA,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:eA,_context:n},n.Consumer=n};de.createElement=Uw;de.createFactory=function(n){var e=Uw.bind(null,n);return e.type=n,e};de.createRef=function(){return{current:null}};de.forwardRef=function(n){return{$$typeof:nA,render:n}};de.isValidElement=Zm;de.lazy=function(n){return{$$typeof:iA,_payload:{_status:-1,_result:n},_init:uA}};de.memo=function(n,e){return{$$typeof:sA,type:n,compare:e===void 0?null:e}};de.startTransition=function(n){var e=xu.transition;xu.transition={};try{n()}finally{xu.transition=e}};de.unstable_act=$w;de.useCallback=function(n,e){return Ft.current.useCallback(n,e)};de.useContext=function(n){return Ft.current.useContext(n)};de.useDebugValue=function(){};de.useDeferredValue=function(n){return Ft.current.useDeferredValue(n)};de.useEffect=function(n,e){return Ft.current.useEffect(n,e)};de.useId=function(){return Ft.current.useId()};de.useImperativeHandle=function(n,e,t){return Ft.current.useImperativeHandle(n,e,t)};de.useInsertionEffect=function(n,e){return Ft.current.useInsertionEffect(n,e)};de.useLayoutEffect=function(n,e){return Ft.current.useLayoutEffect(n,e)};de.useMemo=function(n,e){return Ft.current.useMemo(n,e)};de.useReducer=function(n,e,t){return Ft.current.useReducer(n,e,t)};de.useRef=function(n){return Ft.current.useRef(n)};de.useState=function(n){return Ft.current.useState(n)};de.useSyncExternalStore=function(n,e,t){return Ft.current.useSyncExternalStore(n,e,t)};de.useTransition=function(){return Ft.current.useTransition()};de.version="18.3.1";Dw.exports=de;var W=Dw.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dA=W,hA=Symbol.for("react.element"),fA=Symbol.for("react.fragment"),mA=Object.prototype.hasOwnProperty,pA=dA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gA={key:!0,ref:!0,__self:!0,__source:!0};function Bw(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)mA.call(e,r)&&!gA.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:hA,type:n,key:i,ref:o,props:s,_owner:pA.current}}Zc.Fragment=fA;Zc.jsx=Bw;Zc.jsxs=Bw;Nw.exports=Zc;var g=Nw.exports,zw={exports:{}},on={},qw={exports:{}},Ww={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(U,ne){var se=U.length;U.push(ne);e:for(;0<se;){var Ee=se-1>>>1,ae=U[Ee];if(0<s(ae,ne))U[Ee]=ne,U[se]=ae,se=Ee;else break e}}function t(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var ne=U[0],se=U.pop();if(se!==ne){U[0]=se;e:for(var Ee=0,ae=U.length,ge=ae>>>1;Ee<ge;){var Re=2*(Ee+1)-1,_t=U[Re],yt=Re+1,$n=U[yt];if(0>s(_t,se))yt<ae&&0>s($n,_t)?(U[Ee]=$n,U[yt]=se,Ee=yt):(U[Ee]=_t,U[Re]=se,Ee=Re);else if(yt<ae&&0>s($n,se))U[Ee]=$n,U[yt]=se,Ee=yt;else break e}}return ne}function s(U,ne){var se=U.sortIndex-ne.sortIndex;return se!==0?se:U.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var u=[],c=[],h=1,f=null,p=3,w=!1,k=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(U){for(var ne=t(c);ne!==null;){if(ne.callback===null)r(c);else if(ne.startTime<=U)r(c),ne.sortIndex=ne.expirationTime,e(u,ne);else break;ne=t(c)}}function P(U){if(S=!1,T(U),!k)if(t(u)!==null)k=!0,tt(M);else{var ne=t(c);ne!==null&&J(P,ne.startTime-U)}}function M(U,ne){k=!1,S&&(S=!1,A(_),_=-1),w=!0;var se=p;try{for(T(ne),f=t(u);f!==null&&(!(f.expirationTime>ne)||U&&!b());){var Ee=f.callback;if(typeof Ee=="function"){f.callback=null,p=f.priorityLevel;var ae=Ee(f.expirationTime<=ne);ne=n.unstable_now(),typeof ae=="function"?f.callback=ae:f===t(u)&&r(u),T(ne)}else r(u);f=t(u)}if(f!==null)var ge=!0;else{var Re=t(c);Re!==null&&J(P,Re.startTime-ne),ge=!1}return ge}finally{f=null,p=se,w=!1}}var V=!1,y=null,_=-1,v=5,E=-1;function b(){return!(n.unstable_now()-E<v)}function N(){if(y!==null){var U=n.unstable_now();E=U;var ne=!0;try{ne=y(!0,U)}finally{ne?R():(V=!1,y=null)}}else V=!1}var R;if(typeof x=="function")R=function(){x(N)};else if(typeof MessageChannel<"u"){var Ae=new MessageChannel,ot=Ae.port2;Ae.port1.onmessage=N,R=function(){ot.postMessage(null)}}else R=function(){C(N,0)};function tt(U){y=U,V||(V=!0,R())}function J(U,ne){_=C(function(){U(n.unstable_now())},ne)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(U){U.callback=null},n.unstable_continueExecution=function(){k||w||(k=!0,tt(M))},n.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<U?Math.floor(1e3/U):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(U){switch(p){case 1:case 2:case 3:var ne=3;break;default:ne=p}var se=p;p=ne;try{return U()}finally{p=se}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(U,ne){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var se=p;p=U;try{return ne()}finally{p=se}},n.unstable_scheduleCallback=function(U,ne,se){var Ee=n.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?Ee+se:Ee):se=Ee,U){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=se+ae,U={id:h++,callback:ne,priorityLevel:U,startTime:se,expirationTime:ae,sortIndex:-1},se>Ee?(U.sortIndex=se,e(c,U),t(u)===null&&U===t(c)&&(S?(A(_),_=-1):S=!0,J(P,se-Ee))):(U.sortIndex=ae,e(u,U),k||w||(k=!0,tt(M))),U},n.unstable_shouldYield=b,n.unstable_wrapCallback=function(U){var ne=p;return function(){var se=p;p=ne;try{return U.apply(this,arguments)}finally{p=se}}}})(Ww);qw.exports=Ww;var _A=qw.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yA=W,rn=_A;function z(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Kw=new Set,Aa={};function Gs(n,e){Bi(n,e),Bi(n+"Capture",e)}function Bi(n,e){for(Aa[n]=e,n=0;n<e.length;n++)Kw.add(e[n])}var nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mf=Object.prototype.hasOwnProperty,vA=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,py={},gy={};function wA(n){return mf.call(gy,n)?!0:mf.call(py,n)?!1:vA.test(n)?gy[n]=!0:(py[n]=!0,!1)}function xA(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function EA(n,e,t,r){if(e===null||typeof e>"u"||xA(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ut(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var mt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){mt[n]=new Ut(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];mt[e]=new Ut(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){mt[n]=new Ut(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){mt[n]=new Ut(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){mt[n]=new Ut(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){mt[n]=new Ut(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){mt[n]=new Ut(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){mt[n]=new Ut(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){mt[n]=new Ut(n,5,!1,n.toLowerCase(),null,!1,!1)});var ep=/[\-:]([a-z])/g;function tp(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(ep,tp);mt[e]=new Ut(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(ep,tp);mt[e]=new Ut(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(ep,tp);mt[e]=new Ut(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){mt[n]=new Ut(n,1,!1,n.toLowerCase(),null,!1,!1)});mt.xlinkHref=new Ut("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){mt[n]=new Ut(n,1,!1,n.toLowerCase(),null,!0,!0)});function np(n,e,t,r){var s=mt.hasOwnProperty(e)?mt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(EA(e,t,s,r)&&(t=null),r||s===null?wA(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var cr=yA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ql=Symbol.for("react.element"),yi=Symbol.for("react.portal"),vi=Symbol.for("react.fragment"),rp=Symbol.for("react.strict_mode"),pf=Symbol.for("react.profiler"),Gw=Symbol.for("react.provider"),Hw=Symbol.for("react.context"),sp=Symbol.for("react.forward_ref"),gf=Symbol.for("react.suspense"),_f=Symbol.for("react.suspense_list"),ip=Symbol.for("react.memo"),Er=Symbol.for("react.lazy"),Qw=Symbol.for("react.offscreen"),_y=Symbol.iterator;function No(n){return n===null||typeof n!="object"?null:(n=_y&&n[_y]||n["@@iterator"],typeof n=="function"?n:null)}var je=Object.assign,Eh;function Ko(n){if(Eh===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Eh=e&&e[1]||""}return`
`+Eh+n}var Ih=!1;function Th(n,e){if(!n||Ih)return"";Ih=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var u=`
`+s[o].replace(" at new "," at ");return n.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",n.displayName)),u}while(1<=o&&0<=a);break}}}finally{Ih=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Ko(n):""}function IA(n){switch(n.tag){case 5:return Ko(n.type);case 16:return Ko("Lazy");case 13:return Ko("Suspense");case 19:return Ko("SuspenseList");case 0:case 2:case 15:return n=Th(n.type,!1),n;case 11:return n=Th(n.type.render,!1),n;case 1:return n=Th(n.type,!0),n;default:return""}}function yf(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case vi:return"Fragment";case yi:return"Portal";case pf:return"Profiler";case rp:return"StrictMode";case gf:return"Suspense";case _f:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Hw:return(n.displayName||"Context")+".Consumer";case Gw:return(n._context.displayName||"Context")+".Provider";case sp:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ip:return e=n.displayName||null,e!==null?e:yf(n.type)||"Memo";case Er:e=n._payload,n=n._init;try{return yf(n(e))}catch{}}return null}function TA(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yf(e);case 8:return e===rp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Qr(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Jw(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function bA(n){var e=Jw(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Wl(n){n._valueTracker||(n._valueTracker=bA(n))}function Xw(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Jw(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ec(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function vf(n,e){var t=e.checked;return je({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function yy(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Qr(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Yw(n,e){e=e.checked,e!=null&&np(n,"checked",e,!1)}function wf(n,e){Yw(n,e);var t=Qr(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?xf(n,e.type,t):e.hasOwnProperty("defaultValue")&&xf(n,e.type,Qr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function vy(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function xf(n,e,t){(e!=="number"||ec(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Go=Array.isArray;function Ni(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Qr(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Ef(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(z(91));return je({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function wy(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(z(92));if(Go(t)){if(1<t.length)throw Error(z(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Qr(t)}}function Zw(n,e){var t=Qr(e.value),r=Qr(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function xy(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function ex(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function If(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?ex(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Kl,tx=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Kl=Kl||document.createElement("div"),Kl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Kl.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ra(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ca={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},SA=["Webkit","ms","Moz","O"];Object.keys(ca).forEach(function(n){SA.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ca[e]=ca[n]})});function nx(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ca.hasOwnProperty(n)&&ca[n]?(""+e).trim():e+"px"}function rx(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=nx(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var kA=je({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Tf(n,e){if(e){if(kA[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(z(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(z(62))}}function bf(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sf=null;function op(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var kf=null,Di=null,Vi=null;function Ey(n){if(n=al(n)){if(typeof kf!="function")throw Error(z(280));var e=n.stateNode;e&&(e=sd(e),kf(n.stateNode,n.type,e))}}function sx(n){Di?Vi?Vi.push(n):Vi=[n]:Di=n}function ix(){if(Di){var n=Di,e=Vi;if(Vi=Di=null,Ey(n),e)for(n=0;n<e.length;n++)Ey(e[n])}}function ox(n,e){return n(e)}function ax(){}var bh=!1;function lx(n,e,t){if(bh)return n(e,t);bh=!0;try{return ox(n,e,t)}finally{bh=!1,(Di!==null||Vi!==null)&&(ax(),ix())}}function Pa(n,e){var t=n.stateNode;if(t===null)return null;var r=sd(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(z(231,e,typeof t));return t}var Af=!1;if(nr)try{var Do={};Object.defineProperty(Do,"passive",{get:function(){Af=!0}}),window.addEventListener("test",Do,Do),window.removeEventListener("test",Do,Do)}catch{Af=!1}function AA(n,e,t,r,s,i,o,a,u){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(h){this.onError(h)}}var da=!1,tc=null,nc=!1,Rf=null,RA={onError:function(n){da=!0,tc=n}};function PA(n,e,t,r,s,i,o,a,u){da=!1,tc=null,AA.apply(RA,arguments)}function CA(n,e,t,r,s,i,o,a,u){if(PA.apply(this,arguments),da){if(da){var c=tc;da=!1,tc=null}else throw Error(z(198));nc||(nc=!0,Rf=c)}}function Hs(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function ux(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Iy(n){if(Hs(n)!==n)throw Error(z(188))}function NA(n){var e=n.alternate;if(!e){if(e=Hs(n),e===null)throw Error(z(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return Iy(s),n;if(i===r)return Iy(s),e;i=i.sibling}throw Error(z(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(z(189))}}if(t.alternate!==r)throw Error(z(190))}if(t.tag!==3)throw Error(z(188));return t.stateNode.current===t?n:e}function cx(n){return n=NA(n),n!==null?dx(n):null}function dx(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=dx(n);if(e!==null)return e;n=n.sibling}return null}var hx=rn.unstable_scheduleCallback,Ty=rn.unstable_cancelCallback,DA=rn.unstable_shouldYield,VA=rn.unstable_requestPaint,Be=rn.unstable_now,OA=rn.unstable_getCurrentPriorityLevel,ap=rn.unstable_ImmediatePriority,fx=rn.unstable_UserBlockingPriority,rc=rn.unstable_NormalPriority,MA=rn.unstable_LowPriority,mx=rn.unstable_IdlePriority,ed=null,Vn=null;function LA(n){if(Vn&&typeof Vn.onCommitFiberRoot=="function")try{Vn.onCommitFiberRoot(ed,n,void 0,(n.current.flags&128)===128)}catch{}}var In=Math.clz32?Math.clz32:UA,jA=Math.log,FA=Math.LN2;function UA(n){return n>>>=0,n===0?32:31-(jA(n)/FA|0)|0}var Gl=64,Hl=4194304;function Ho(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function sc(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Ho(a):(i&=o,i!==0&&(r=Ho(i)))}else o=t&~s,o!==0?r=Ho(o):i!==0&&(r=Ho(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-In(e),s=1<<t,r|=n[t],e&=~s;return r}function $A(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function BA(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-In(i),a=1<<o,u=s[o];u===-1?(!(a&t)||a&r)&&(s[o]=$A(a,e)):u<=e&&(n.expiredLanes|=a),i&=~a}}function Pf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function px(){var n=Gl;return Gl<<=1,!(Gl&4194240)&&(Gl=64),n}function Sh(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function il(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-In(e),n[e]=t}function zA(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-In(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function lp(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-In(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var we=0;function gx(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var _x,up,yx,vx,wx,Cf=!1,Ql=[],Vr=null,Or=null,Mr=null,Ca=new Map,Na=new Map,Tr=[],qA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function by(n,e){switch(n){case"focusin":case"focusout":Vr=null;break;case"dragenter":case"dragleave":Or=null;break;case"mouseover":case"mouseout":Mr=null;break;case"pointerover":case"pointerout":Ca.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Na.delete(e.pointerId)}}function Vo(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=al(e),e!==null&&up(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function WA(n,e,t,r,s){switch(e){case"focusin":return Vr=Vo(Vr,n,e,t,r,s),!0;case"dragenter":return Or=Vo(Or,n,e,t,r,s),!0;case"mouseover":return Mr=Vo(Mr,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Ca.set(i,Vo(Ca.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Na.set(i,Vo(Na.get(i)||null,n,e,t,r,s)),!0}return!1}function xx(n){var e=Es(n.target);if(e!==null){var t=Hs(e);if(t!==null){if(e=t.tag,e===13){if(e=ux(t),e!==null){n.blockedOn=e,wx(n.priority,function(){yx(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Eu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Nf(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Sf=r,t.target.dispatchEvent(r),Sf=null}else return e=al(t),e!==null&&up(e),n.blockedOn=t,!1;e.shift()}return!0}function Sy(n,e,t){Eu(n)&&t.delete(e)}function KA(){Cf=!1,Vr!==null&&Eu(Vr)&&(Vr=null),Or!==null&&Eu(Or)&&(Or=null),Mr!==null&&Eu(Mr)&&(Mr=null),Ca.forEach(Sy),Na.forEach(Sy)}function Oo(n,e){n.blockedOn===e&&(n.blockedOn=null,Cf||(Cf=!0,rn.unstable_scheduleCallback(rn.unstable_NormalPriority,KA)))}function Da(n){function e(s){return Oo(s,n)}if(0<Ql.length){Oo(Ql[0],n);for(var t=1;t<Ql.length;t++){var r=Ql[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Vr!==null&&Oo(Vr,n),Or!==null&&Oo(Or,n),Mr!==null&&Oo(Mr,n),Ca.forEach(e),Na.forEach(e),t=0;t<Tr.length;t++)r=Tr[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Tr.length&&(t=Tr[0],t.blockedOn===null);)xx(t),t.blockedOn===null&&Tr.shift()}var Oi=cr.ReactCurrentBatchConfig,ic=!0;function GA(n,e,t,r){var s=we,i=Oi.transition;Oi.transition=null;try{we=1,cp(n,e,t,r)}finally{we=s,Oi.transition=i}}function HA(n,e,t,r){var s=we,i=Oi.transition;Oi.transition=null;try{we=4,cp(n,e,t,r)}finally{we=s,Oi.transition=i}}function cp(n,e,t,r){if(ic){var s=Nf(n,e,t,r);if(s===null)Mh(n,e,r,oc,t),by(n,r);else if(WA(s,n,e,t,r))r.stopPropagation();else if(by(n,r),e&4&&-1<qA.indexOf(n)){for(;s!==null;){var i=al(s);if(i!==null&&_x(i),i=Nf(n,e,t,r),i===null&&Mh(n,e,r,oc,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else Mh(n,e,r,null,t)}}var oc=null;function Nf(n,e,t,r){if(oc=null,n=op(r),n=Es(n),n!==null)if(e=Hs(n),e===null)n=null;else if(t=e.tag,t===13){if(n=ux(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return oc=n,null}function Ex(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(OA()){case ap:return 1;case fx:return 4;case rc:case MA:return 16;case mx:return 536870912;default:return 16}default:return 16}}var Cr=null,dp=null,Iu=null;function Ix(){if(Iu)return Iu;var n,e=dp,t=e.length,r,s="value"in Cr?Cr.value:Cr.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Iu=s.slice(n,1<r?1-r:void 0)}function Tu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Jl(){return!0}function ky(){return!1}function an(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Jl:ky,this.isPropagationStopped=ky,this}return je(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Jl)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Jl)},persist:function(){},isPersistent:Jl}),e}var ao={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hp=an(ao),ol=je({},ao,{view:0,detail:0}),QA=an(ol),kh,Ah,Mo,td=je({},ol,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fp,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Mo&&(Mo&&n.type==="mousemove"?(kh=n.screenX-Mo.screenX,Ah=n.screenY-Mo.screenY):Ah=kh=0,Mo=n),kh)},movementY:function(n){return"movementY"in n?n.movementY:Ah}}),Ay=an(td),JA=je({},td,{dataTransfer:0}),XA=an(JA),YA=je({},ol,{relatedTarget:0}),Rh=an(YA),ZA=je({},ao,{animationName:0,elapsedTime:0,pseudoElement:0}),eR=an(ZA),tR=je({},ao,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),nR=an(tR),rR=je({},ao,{data:0}),Ry=an(rR),sR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aR(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=oR[n])?!!e[n]:!1}function fp(){return aR}var lR=je({},ol,{key:function(n){if(n.key){var e=sR[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Tu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?iR[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fp,charCode:function(n){return n.type==="keypress"?Tu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Tu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),uR=an(lR),cR=je({},td,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Py=an(cR),dR=je({},ol,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fp}),hR=an(dR),fR=je({},ao,{propertyName:0,elapsedTime:0,pseudoElement:0}),mR=an(fR),pR=je({},td,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),gR=an(pR),_R=[9,13,27,32],mp=nr&&"CompositionEvent"in window,ha=null;nr&&"documentMode"in document&&(ha=document.documentMode);var yR=nr&&"TextEvent"in window&&!ha,Tx=nr&&(!mp||ha&&8<ha&&11>=ha),Cy=" ",Ny=!1;function bx(n,e){switch(n){case"keyup":return _R.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sx(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var wi=!1;function vR(n,e){switch(n){case"compositionend":return Sx(e);case"keypress":return e.which!==32?null:(Ny=!0,Cy);case"textInput":return n=e.data,n===Cy&&Ny?null:n;default:return null}}function wR(n,e){if(wi)return n==="compositionend"||!mp&&bx(n,e)?(n=Ix(),Iu=dp=Cr=null,wi=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Tx&&e.locale!=="ko"?null:e.data;default:return null}}var xR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dy(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!xR[n.type]:e==="textarea"}function kx(n,e,t,r){sx(r),e=ac(e,"onChange"),0<e.length&&(t=new hp("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var fa=null,Va=null;function ER(n){jx(n,0)}function nd(n){var e=Ii(n);if(Xw(e))return n}function IR(n,e){if(n==="change")return e}var Ax=!1;if(nr){var Ph;if(nr){var Ch="oninput"in document;if(!Ch){var Vy=document.createElement("div");Vy.setAttribute("oninput","return;"),Ch=typeof Vy.oninput=="function"}Ph=Ch}else Ph=!1;Ax=Ph&&(!document.documentMode||9<document.documentMode)}function Oy(){fa&&(fa.detachEvent("onpropertychange",Rx),Va=fa=null)}function Rx(n){if(n.propertyName==="value"&&nd(Va)){var e=[];kx(e,Va,n,op(n)),lx(ER,e)}}function TR(n,e,t){n==="focusin"?(Oy(),fa=e,Va=t,fa.attachEvent("onpropertychange",Rx)):n==="focusout"&&Oy()}function bR(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return nd(Va)}function SR(n,e){if(n==="click")return nd(e)}function kR(n,e){if(n==="input"||n==="change")return nd(e)}function AR(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var bn=typeof Object.is=="function"?Object.is:AR;function Oa(n,e){if(bn(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!mf.call(e,s)||!bn(n[s],e[s]))return!1}return!0}function My(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Ly(n,e){var t=My(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=My(t)}}function Px(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Px(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Cx(){for(var n=window,e=ec();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ec(n.document)}return e}function pp(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function RR(n){var e=Cx(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Px(t.ownerDocument.documentElement,t)){if(r!==null&&pp(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=Ly(t,i);var o=Ly(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var PR=nr&&"documentMode"in document&&11>=document.documentMode,xi=null,Df=null,ma=null,Vf=!1;function jy(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Vf||xi==null||xi!==ec(r)||(r=xi,"selectionStart"in r&&pp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ma&&Oa(ma,r)||(ma=r,r=ac(Df,"onSelect"),0<r.length&&(e=new hp("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=xi)))}function Xl(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ei={animationend:Xl("Animation","AnimationEnd"),animationiteration:Xl("Animation","AnimationIteration"),animationstart:Xl("Animation","AnimationStart"),transitionend:Xl("Transition","TransitionEnd")},Nh={},Nx={};nr&&(Nx=document.createElement("div").style,"AnimationEvent"in window||(delete Ei.animationend.animation,delete Ei.animationiteration.animation,delete Ei.animationstart.animation),"TransitionEvent"in window||delete Ei.transitionend.transition);function rd(n){if(Nh[n])return Nh[n];if(!Ei[n])return n;var e=Ei[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in Nx)return Nh[n]=e[t];return n}var Dx=rd("animationend"),Vx=rd("animationiteration"),Ox=rd("animationstart"),Mx=rd("transitionend"),Lx=new Map,Fy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ts(n,e){Lx.set(n,e),Gs(e,[n])}for(var Dh=0;Dh<Fy.length;Dh++){var Vh=Fy[Dh],CR=Vh.toLowerCase(),NR=Vh[0].toUpperCase()+Vh.slice(1);ts(CR,"on"+NR)}ts(Dx,"onAnimationEnd");ts(Vx,"onAnimationIteration");ts(Ox,"onAnimationStart");ts("dblclick","onDoubleClick");ts("focusin","onFocus");ts("focusout","onBlur");ts(Mx,"onTransitionEnd");Bi("onMouseEnter",["mouseout","mouseover"]);Bi("onMouseLeave",["mouseout","mouseover"]);Bi("onPointerEnter",["pointerout","pointerover"]);Bi("onPointerLeave",["pointerout","pointerover"]);Gs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DR=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qo));function Uy(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,CA(r,e,void 0,n),n.currentTarget=null}function jx(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],u=a.instance,c=a.currentTarget;if(a=a.listener,u!==i&&s.isPropagationStopped())break e;Uy(s,a,c),i=u}else for(o=0;o<r.length;o++){if(a=r[o],u=a.instance,c=a.currentTarget,a=a.listener,u!==i&&s.isPropagationStopped())break e;Uy(s,a,c),i=u}}}if(nc)throw n=Rf,nc=!1,Rf=null,n}function Se(n,e){var t=e[Ff];t===void 0&&(t=e[Ff]=new Set);var r=n+"__bubble";t.has(r)||(Fx(e,n,2,!1),t.add(r))}function Oh(n,e,t){var r=0;e&&(r|=4),Fx(t,n,r,e)}var Yl="_reactListening"+Math.random().toString(36).slice(2);function Ma(n){if(!n[Yl]){n[Yl]=!0,Kw.forEach(function(t){t!=="selectionchange"&&(DR.has(t)||Oh(t,!1,n),Oh(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Yl]||(e[Yl]=!0,Oh("selectionchange",!1,e))}}function Fx(n,e,t,r){switch(Ex(e)){case 1:var s=GA;break;case 4:s=HA;break;default:s=cp}t=s.bind(null,e,t,n),s=void 0,!Af||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function Mh(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Es(a),o===null)return;if(u=o.tag,u===5||u===6){r=i=o;continue e}a=a.parentNode}}r=r.return}lx(function(){var c=i,h=op(t),f=[];e:{var p=Lx.get(n);if(p!==void 0){var w=hp,k=n;switch(n){case"keypress":if(Tu(t)===0)break e;case"keydown":case"keyup":w=uR;break;case"focusin":k="focus",w=Rh;break;case"focusout":k="blur",w=Rh;break;case"beforeblur":case"afterblur":w=Rh;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=Ay;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=XA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=hR;break;case Dx:case Vx:case Ox:w=eR;break;case Mx:w=mR;break;case"scroll":w=QA;break;case"wheel":w=gR;break;case"copy":case"cut":case"paste":w=nR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=Py}var S=(e&4)!==0,C=!S&&n==="scroll",A=S?p!==null?p+"Capture":null:p;S=[];for(var x=c,T;x!==null;){T=x;var P=T.stateNode;if(T.tag===5&&P!==null&&(T=P,A!==null&&(P=Pa(x,A),P!=null&&S.push(La(x,P,T)))),C)break;x=x.return}0<S.length&&(p=new w(p,k,null,t,h),f.push({event:p,listeners:S}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",w=n==="mouseout"||n==="pointerout",p&&t!==Sf&&(k=t.relatedTarget||t.fromElement)&&(Es(k)||k[rr]))break e;if((w||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,w?(k=t.relatedTarget||t.toElement,w=c,k=k?Es(k):null,k!==null&&(C=Hs(k),k!==C||k.tag!==5&&k.tag!==6)&&(k=null)):(w=null,k=c),w!==k)){if(S=Ay,P="onMouseLeave",A="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(S=Py,P="onPointerLeave",A="onPointerEnter",x="pointer"),C=w==null?p:Ii(w),T=k==null?p:Ii(k),p=new S(P,x+"leave",w,t,h),p.target=C,p.relatedTarget=T,P=null,Es(h)===c&&(S=new S(A,x+"enter",k,t,h),S.target=T,S.relatedTarget=C,P=S),C=P,w&&k)t:{for(S=w,A=k,x=0,T=S;T;T=ni(T))x++;for(T=0,P=A;P;P=ni(P))T++;for(;0<x-T;)S=ni(S),x--;for(;0<T-x;)A=ni(A),T--;for(;x--;){if(S===A||A!==null&&S===A.alternate)break t;S=ni(S),A=ni(A)}S=null}else S=null;w!==null&&$y(f,p,w,S,!1),k!==null&&C!==null&&$y(f,C,k,S,!0)}}e:{if(p=c?Ii(c):window,w=p.nodeName&&p.nodeName.toLowerCase(),w==="select"||w==="input"&&p.type==="file")var M=IR;else if(Dy(p))if(Ax)M=kR;else{M=bR;var V=TR}else(w=p.nodeName)&&w.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(M=SR);if(M&&(M=M(n,c))){kx(f,M,t,h);break e}V&&V(n,p,c),n==="focusout"&&(V=p._wrapperState)&&V.controlled&&p.type==="number"&&xf(p,"number",p.value)}switch(V=c?Ii(c):window,n){case"focusin":(Dy(V)||V.contentEditable==="true")&&(xi=V,Df=c,ma=null);break;case"focusout":ma=Df=xi=null;break;case"mousedown":Vf=!0;break;case"contextmenu":case"mouseup":case"dragend":Vf=!1,jy(f,t,h);break;case"selectionchange":if(PR)break;case"keydown":case"keyup":jy(f,t,h)}var y;if(mp)e:{switch(n){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else wi?bx(n,t)&&(_="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(_="onCompositionStart");_&&(Tx&&t.locale!=="ko"&&(wi||_!=="onCompositionStart"?_==="onCompositionEnd"&&wi&&(y=Ix()):(Cr=h,dp="value"in Cr?Cr.value:Cr.textContent,wi=!0)),V=ac(c,_),0<V.length&&(_=new Ry(_,n,null,t,h),f.push({event:_,listeners:V}),y?_.data=y:(y=Sx(t),y!==null&&(_.data=y)))),(y=yR?vR(n,t):wR(n,t))&&(c=ac(c,"onBeforeInput"),0<c.length&&(h=new Ry("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:c}),h.data=y))}jx(f,e)})}function La(n,e,t){return{instance:n,listener:e,currentTarget:t}}function ac(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Pa(n,t),i!=null&&r.unshift(La(n,i,s)),i=Pa(n,e),i!=null&&r.push(La(n,i,s))),n=n.return}return r}function ni(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function $y(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,u=a.alternate,c=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&c!==null&&(a=c,s?(u=Pa(t,i),u!=null&&o.unshift(La(t,u,a))):s||(u=Pa(t,i),u!=null&&o.push(La(t,u,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var VR=/\r\n?/g,OR=/\u0000|\uFFFD/g;function By(n){return(typeof n=="string"?n:""+n).replace(VR,`
`).replace(OR,"")}function Zl(n,e,t){if(e=By(e),By(n)!==e&&t)throw Error(z(425))}function lc(){}var Of=null,Mf=null;function Lf(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var jf=typeof setTimeout=="function"?setTimeout:void 0,MR=typeof clearTimeout=="function"?clearTimeout:void 0,zy=typeof Promise=="function"?Promise:void 0,LR=typeof queueMicrotask=="function"?queueMicrotask:typeof zy<"u"?function(n){return zy.resolve(null).then(n).catch(jR)}:jf;function jR(n){setTimeout(function(){throw n})}function Lh(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Da(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Da(e)}function Lr(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function qy(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var lo=Math.random().toString(36).slice(2),Pn="__reactFiber$"+lo,ja="__reactProps$"+lo,rr="__reactContainer$"+lo,Ff="__reactEvents$"+lo,FR="__reactListeners$"+lo,UR="__reactHandles$"+lo;function Es(n){var e=n[Pn];if(e)return e;for(var t=n.parentNode;t;){if(e=t[rr]||t[Pn]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=qy(n);n!==null;){if(t=n[Pn])return t;n=qy(n)}return e}n=t,t=n.parentNode}return null}function al(n){return n=n[Pn]||n[rr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ii(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(z(33))}function sd(n){return n[ja]||null}var Uf=[],Ti=-1;function ns(n){return{current:n}}function ke(n){0>Ti||(n.current=Uf[Ti],Uf[Ti]=null,Ti--)}function Te(n,e){Ti++,Uf[Ti]=n.current,n.current=e}var Jr={},Rt=ns(Jr),Kt=ns(!1),Cs=Jr;function zi(n,e){var t=n.type.contextTypes;if(!t)return Jr;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Gt(n){return n=n.childContextTypes,n!=null}function uc(){ke(Kt),ke(Rt)}function Wy(n,e,t){if(Rt.current!==Jr)throw Error(z(168));Te(Rt,e),Te(Kt,t)}function Ux(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(z(108,TA(n)||"Unknown",s));return je({},t,r)}function cc(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Jr,Cs=Rt.current,Te(Rt,n),Te(Kt,Kt.current),!0}function Ky(n,e,t){var r=n.stateNode;if(!r)throw Error(z(169));t?(n=Ux(n,e,Cs),r.__reactInternalMemoizedMergedChildContext=n,ke(Kt),ke(Rt),Te(Rt,n)):ke(Kt),Te(Kt,t)}var Gn=null,id=!1,jh=!1;function $x(n){Gn===null?Gn=[n]:Gn.push(n)}function $R(n){id=!0,$x(n)}function rs(){if(!jh&&Gn!==null){jh=!0;var n=0,e=we;try{var t=Gn;for(we=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Gn=null,id=!1}catch(s){throw Gn!==null&&(Gn=Gn.slice(n+1)),hx(ap,rs),s}finally{we=e,jh=!1}}return null}var bi=[],Si=0,dc=null,hc=0,ln=[],un=0,Ns=null,Hn=1,Qn="";function hs(n,e){bi[Si++]=hc,bi[Si++]=dc,dc=n,hc=e}function Bx(n,e,t){ln[un++]=Hn,ln[un++]=Qn,ln[un++]=Ns,Ns=n;var r=Hn;n=Qn;var s=32-In(r)-1;r&=~(1<<s),t+=1;var i=32-In(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Hn=1<<32-In(e)+s|t<<s|r,Qn=i+n}else Hn=1<<i|t<<s|r,Qn=n}function gp(n){n.return!==null&&(hs(n,1),Bx(n,1,0))}function _p(n){for(;n===dc;)dc=bi[--Si],bi[Si]=null,hc=bi[--Si],bi[Si]=null;for(;n===Ns;)Ns=ln[--un],ln[un]=null,Qn=ln[--un],ln[un]=null,Hn=ln[--un],ln[un]=null}var nn=null,en=null,Ce=!1,En=null;function zx(n,e){var t=cn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Gy(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,nn=n,en=Lr(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,nn=n,en=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ns!==null?{id:Hn,overflow:Qn}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=cn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,nn=n,en=null,!0):!1;default:return!1}}function $f(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Bf(n){if(Ce){var e=en;if(e){var t=e;if(!Gy(n,e)){if($f(n))throw Error(z(418));e=Lr(t.nextSibling);var r=nn;e&&Gy(n,e)?zx(r,t):(n.flags=n.flags&-4097|2,Ce=!1,nn=n)}}else{if($f(n))throw Error(z(418));n.flags=n.flags&-4097|2,Ce=!1,nn=n}}}function Hy(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;nn=n}function eu(n){if(n!==nn)return!1;if(!Ce)return Hy(n),Ce=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Lf(n.type,n.memoizedProps)),e&&(e=en)){if($f(n))throw qx(),Error(z(418));for(;e;)zx(n,e),e=Lr(e.nextSibling)}if(Hy(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(z(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){en=Lr(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}en=null}}else en=nn?Lr(n.stateNode.nextSibling):null;return!0}function qx(){for(var n=en;n;)n=Lr(n.nextSibling)}function qi(){en=nn=null,Ce=!1}function yp(n){En===null?En=[n]:En.push(n)}var BR=cr.ReactCurrentBatchConfig;function Lo(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(z(309));var r=t.stateNode}if(!r)throw Error(z(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(z(284));if(!t._owner)throw Error(z(290,n))}return n}function tu(n,e){throw n=Object.prototype.toString.call(e),Error(z(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Qy(n){var e=n._init;return e(n._payload)}function Wx(n){function e(A,x){if(n){var T=A.deletions;T===null?(A.deletions=[x],A.flags|=16):T.push(x)}}function t(A,x){if(!n)return null;for(;x!==null;)e(A,x),x=x.sibling;return null}function r(A,x){for(A=new Map;x!==null;)x.key!==null?A.set(x.key,x):A.set(x.index,x),x=x.sibling;return A}function s(A,x){return A=$r(A,x),A.index=0,A.sibling=null,A}function i(A,x,T){return A.index=T,n?(T=A.alternate,T!==null?(T=T.index,T<x?(A.flags|=2,x):T):(A.flags|=2,x)):(A.flags|=1048576,x)}function o(A){return n&&A.alternate===null&&(A.flags|=2),A}function a(A,x,T,P){return x===null||x.tag!==6?(x=Wh(T,A.mode,P),x.return=A,x):(x=s(x,T),x.return=A,x)}function u(A,x,T,P){var M=T.type;return M===vi?h(A,x,T.props.children,P,T.key):x!==null&&(x.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Er&&Qy(M)===x.type)?(P=s(x,T.props),P.ref=Lo(A,x,T),P.return=A,P):(P=Cu(T.type,T.key,T.props,null,A.mode,P),P.ref=Lo(A,x,T),P.return=A,P)}function c(A,x,T,P){return x===null||x.tag!==4||x.stateNode.containerInfo!==T.containerInfo||x.stateNode.implementation!==T.implementation?(x=Kh(T,A.mode,P),x.return=A,x):(x=s(x,T.children||[]),x.return=A,x)}function h(A,x,T,P,M){return x===null||x.tag!==7?(x=As(T,A.mode,P,M),x.return=A,x):(x=s(x,T),x.return=A,x)}function f(A,x,T){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Wh(""+x,A.mode,T),x.return=A,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ql:return T=Cu(x.type,x.key,x.props,null,A.mode,T),T.ref=Lo(A,null,x),T.return=A,T;case yi:return x=Kh(x,A.mode,T),x.return=A,x;case Er:var P=x._init;return f(A,P(x._payload),T)}if(Go(x)||No(x))return x=As(x,A.mode,T,null),x.return=A,x;tu(A,x)}return null}function p(A,x,T,P){var M=x!==null?x.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return M!==null?null:a(A,x,""+T,P);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case ql:return T.key===M?u(A,x,T,P):null;case yi:return T.key===M?c(A,x,T,P):null;case Er:return M=T._init,p(A,x,M(T._payload),P)}if(Go(T)||No(T))return M!==null?null:h(A,x,T,P,null);tu(A,T)}return null}function w(A,x,T,P,M){if(typeof P=="string"&&P!==""||typeof P=="number")return A=A.get(T)||null,a(x,A,""+P,M);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case ql:return A=A.get(P.key===null?T:P.key)||null,u(x,A,P,M);case yi:return A=A.get(P.key===null?T:P.key)||null,c(x,A,P,M);case Er:var V=P._init;return w(A,x,T,V(P._payload),M)}if(Go(P)||No(P))return A=A.get(T)||null,h(x,A,P,M,null);tu(x,P)}return null}function k(A,x,T,P){for(var M=null,V=null,y=x,_=x=0,v=null;y!==null&&_<T.length;_++){y.index>_?(v=y,y=null):v=y.sibling;var E=p(A,y,T[_],P);if(E===null){y===null&&(y=v);break}n&&y&&E.alternate===null&&e(A,y),x=i(E,x,_),V===null?M=E:V.sibling=E,V=E,y=v}if(_===T.length)return t(A,y),Ce&&hs(A,_),M;if(y===null){for(;_<T.length;_++)y=f(A,T[_],P),y!==null&&(x=i(y,x,_),V===null?M=y:V.sibling=y,V=y);return Ce&&hs(A,_),M}for(y=r(A,y);_<T.length;_++)v=w(y,A,_,T[_],P),v!==null&&(n&&v.alternate!==null&&y.delete(v.key===null?_:v.key),x=i(v,x,_),V===null?M=v:V.sibling=v,V=v);return n&&y.forEach(function(b){return e(A,b)}),Ce&&hs(A,_),M}function S(A,x,T,P){var M=No(T);if(typeof M!="function")throw Error(z(150));if(T=M.call(T),T==null)throw Error(z(151));for(var V=M=null,y=x,_=x=0,v=null,E=T.next();y!==null&&!E.done;_++,E=T.next()){y.index>_?(v=y,y=null):v=y.sibling;var b=p(A,y,E.value,P);if(b===null){y===null&&(y=v);break}n&&y&&b.alternate===null&&e(A,y),x=i(b,x,_),V===null?M=b:V.sibling=b,V=b,y=v}if(E.done)return t(A,y),Ce&&hs(A,_),M;if(y===null){for(;!E.done;_++,E=T.next())E=f(A,E.value,P),E!==null&&(x=i(E,x,_),V===null?M=E:V.sibling=E,V=E);return Ce&&hs(A,_),M}for(y=r(A,y);!E.done;_++,E=T.next())E=w(y,A,_,E.value,P),E!==null&&(n&&E.alternate!==null&&y.delete(E.key===null?_:E.key),x=i(E,x,_),V===null?M=E:V.sibling=E,V=E);return n&&y.forEach(function(N){return e(A,N)}),Ce&&hs(A,_),M}function C(A,x,T,P){if(typeof T=="object"&&T!==null&&T.type===vi&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case ql:e:{for(var M=T.key,V=x;V!==null;){if(V.key===M){if(M=T.type,M===vi){if(V.tag===7){t(A,V.sibling),x=s(V,T.props.children),x.return=A,A=x;break e}}else if(V.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Er&&Qy(M)===V.type){t(A,V.sibling),x=s(V,T.props),x.ref=Lo(A,V,T),x.return=A,A=x;break e}t(A,V);break}else e(A,V);V=V.sibling}T.type===vi?(x=As(T.props.children,A.mode,P,T.key),x.return=A,A=x):(P=Cu(T.type,T.key,T.props,null,A.mode,P),P.ref=Lo(A,x,T),P.return=A,A=P)}return o(A);case yi:e:{for(V=T.key;x!==null;){if(x.key===V)if(x.tag===4&&x.stateNode.containerInfo===T.containerInfo&&x.stateNode.implementation===T.implementation){t(A,x.sibling),x=s(x,T.children||[]),x.return=A,A=x;break e}else{t(A,x);break}else e(A,x);x=x.sibling}x=Kh(T,A.mode,P),x.return=A,A=x}return o(A);case Er:return V=T._init,C(A,x,V(T._payload),P)}if(Go(T))return k(A,x,T,P);if(No(T))return S(A,x,T,P);tu(A,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,x!==null&&x.tag===6?(t(A,x.sibling),x=s(x,T),x.return=A,A=x):(t(A,x),x=Wh(T,A.mode,P),x.return=A,A=x),o(A)):t(A,x)}return C}var Wi=Wx(!0),Kx=Wx(!1),fc=ns(null),mc=null,ki=null,vp=null;function wp(){vp=ki=mc=null}function xp(n){var e=fc.current;ke(fc),n._currentValue=e}function zf(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Mi(n,e){mc=n,vp=ki=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(qt=!0),n.firstContext=null)}function pn(n){var e=n._currentValue;if(vp!==n)if(n={context:n,memoizedValue:e,next:null},ki===null){if(mc===null)throw Error(z(308));ki=n,mc.dependencies={lanes:0,firstContext:n}}else ki=ki.next=n;return e}var Is=null;function Ep(n){Is===null?Is=[n]:Is.push(n)}function Gx(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Ep(e)):(t.next=s.next,s.next=t),e.interleaved=t,sr(n,r)}function sr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ir=!1;function Ip(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Hx(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function tr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function jr(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,pe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,sr(n,t)}return s=r.interleaved,s===null?(e.next=e,Ep(r)):(e.next=s.next,s.next=e),r.interleaved=e,sr(n,t)}function bu(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,lp(n,t)}}function Jy(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function pc(n,e,t,r){var s=n.updateQueue;Ir=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var u=a,c=u.next;u.next=null,o===null?i=c:o.next=c,o=u;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=u))}if(i!==null){var f=s.baseState;o=0,h=c=u=null,a=i;do{var p=a.lane,w=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:w,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var k=n,S=a;switch(p=e,w=t,S.tag){case 1:if(k=S.payload,typeof k=="function"){f=k.call(w,f,p);break e}f=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=S.payload,p=typeof k=="function"?k.call(w,f,p):k,p==null)break e;f=je({},f,p);break e;case 2:Ir=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[a]:p.push(a))}else w={eventTime:w,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=w,u=f):h=h.next=w,o|=p;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;p=a,a=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(h===null&&(u=f),s.baseState=u,s.firstBaseUpdate=c,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Vs|=o,n.lanes=o,n.memoizedState=f}}function Xy(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(z(191,s));s.call(r)}}}var ll={},On=ns(ll),Fa=ns(ll),Ua=ns(ll);function Ts(n){if(n===ll)throw Error(z(174));return n}function Tp(n,e){switch(Te(Ua,e),Te(Fa,n),Te(On,ll),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:If(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=If(e,n)}ke(On),Te(On,e)}function Ki(){ke(On),ke(Fa),ke(Ua)}function Qx(n){Ts(Ua.current);var e=Ts(On.current),t=If(e,n.type);e!==t&&(Te(Fa,n),Te(On,t))}function bp(n){Fa.current===n&&(ke(On),ke(Fa))}var De=ns(0);function gc(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Fh=[];function Sp(){for(var n=0;n<Fh.length;n++)Fh[n]._workInProgressVersionPrimary=null;Fh.length=0}var Su=cr.ReactCurrentDispatcher,Uh=cr.ReactCurrentBatchConfig,Ds=0,Me=null,Je=null,st=null,_c=!1,pa=!1,$a=0,zR=0;function Et(){throw Error(z(321))}function kp(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!bn(n[t],e[t]))return!1;return!0}function Ap(n,e,t,r,s,i){if(Ds=i,Me=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Su.current=n===null||n.memoizedState===null?GR:HR,n=t(r,s),pa){i=0;do{if(pa=!1,$a=0,25<=i)throw Error(z(301));i+=1,st=Je=null,e.updateQueue=null,Su.current=QR,n=t(r,s)}while(pa)}if(Su.current=yc,e=Je!==null&&Je.next!==null,Ds=0,st=Je=Me=null,_c=!1,e)throw Error(z(300));return n}function Rp(){var n=$a!==0;return $a=0,n}function An(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return st===null?Me.memoizedState=st=n:st=st.next=n,st}function gn(){if(Je===null){var n=Me.alternate;n=n!==null?n.memoizedState:null}else n=Je.next;var e=st===null?Me.memoizedState:st.next;if(e!==null)st=e,Je=n;else{if(n===null)throw Error(z(310));Je=n,n={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},st===null?Me.memoizedState=st=n:st=st.next=n}return st}function Ba(n,e){return typeof e=="function"?e(n):e}function $h(n){var e=gn(),t=e.queue;if(t===null)throw Error(z(311));t.lastRenderedReducer=n;var r=Je,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,u=null,c=i;do{var h=c.lane;if((Ds&h)===h)u!==null&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var f={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};u===null?(a=u=f,o=r):u=u.next=f,Me.lanes|=h,Vs|=h}c=c.next}while(c!==null&&c!==i);u===null?o=r:u.next=a,bn(r,e.memoizedState)||(qt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=u,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Me.lanes|=i,Vs|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Bh(n){var e=gn(),t=e.queue;if(t===null)throw Error(z(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);bn(i,e.memoizedState)||(qt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function Jx(){}function Xx(n,e){var t=Me,r=gn(),s=e(),i=!bn(r.memoizedState,s);if(i&&(r.memoizedState=s,qt=!0),r=r.queue,Pp(eE.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||st!==null&&st.memoizedState.tag&1){if(t.flags|=2048,za(9,Zx.bind(null,t,r,s,e),void 0,null),it===null)throw Error(z(349));Ds&30||Yx(t,e,s)}return s}function Yx(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Me.updateQueue,e===null?(e={lastEffect:null,stores:null},Me.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Zx(n,e,t,r){e.value=t,e.getSnapshot=r,tE(e)&&nE(n)}function eE(n,e,t){return t(function(){tE(e)&&nE(n)})}function tE(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!bn(n,t)}catch{return!0}}function nE(n){var e=sr(n,1);e!==null&&Tn(e,n,1,-1)}function Yy(n){var e=An();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:n},e.queue=n,n=n.dispatch=KR.bind(null,Me,n),[e.memoizedState,n]}function za(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Me.updateQueue,e===null?(e={lastEffect:null,stores:null},Me.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function rE(){return gn().memoizedState}function ku(n,e,t,r){var s=An();Me.flags|=n,s.memoizedState=za(1|e,t,void 0,r===void 0?null:r)}function od(n,e,t,r){var s=gn();r=r===void 0?null:r;var i=void 0;if(Je!==null){var o=Je.memoizedState;if(i=o.destroy,r!==null&&kp(r,o.deps)){s.memoizedState=za(e,t,i,r);return}}Me.flags|=n,s.memoizedState=za(1|e,t,i,r)}function Zy(n,e){return ku(8390656,8,n,e)}function Pp(n,e){return od(2048,8,n,e)}function sE(n,e){return od(4,2,n,e)}function iE(n,e){return od(4,4,n,e)}function oE(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function aE(n,e,t){return t=t!=null?t.concat([n]):null,od(4,4,oE.bind(null,e,n),t)}function Cp(){}function lE(n,e){var t=gn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kp(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function uE(n,e){var t=gn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&kp(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function cE(n,e,t){return Ds&21?(bn(t,e)||(t=px(),Me.lanes|=t,Vs|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,qt=!0),n.memoizedState=t)}function qR(n,e){var t=we;we=t!==0&&4>t?t:4,n(!0);var r=Uh.transition;Uh.transition={};try{n(!1),e()}finally{we=t,Uh.transition=r}}function dE(){return gn().memoizedState}function WR(n,e,t){var r=Ur(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},hE(n))fE(e,t);else if(t=Gx(n,e,t,r),t!==null){var s=Ot();Tn(t,n,r,s),mE(t,e,r)}}function KR(n,e,t){var r=Ur(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(hE(n))fE(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,bn(a,o)){var u=e.interleaved;u===null?(s.next=s,Ep(e)):(s.next=u.next,u.next=s),e.interleaved=s;return}}catch{}finally{}t=Gx(n,e,s,r),t!==null&&(s=Ot(),Tn(t,n,r,s),mE(t,e,r))}}function hE(n){var e=n.alternate;return n===Me||e!==null&&e===Me}function fE(n,e){pa=_c=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function mE(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,lp(n,t)}}var yc={readContext:pn,useCallback:Et,useContext:Et,useEffect:Et,useImperativeHandle:Et,useInsertionEffect:Et,useLayoutEffect:Et,useMemo:Et,useReducer:Et,useRef:Et,useState:Et,useDebugValue:Et,useDeferredValue:Et,useTransition:Et,useMutableSource:Et,useSyncExternalStore:Et,useId:Et,unstable_isNewReconciler:!1},GR={readContext:pn,useCallback:function(n,e){return An().memoizedState=[n,e===void 0?null:e],n},useContext:pn,useEffect:Zy,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,ku(4194308,4,oE.bind(null,e,n),t)},useLayoutEffect:function(n,e){return ku(4194308,4,n,e)},useInsertionEffect:function(n,e){return ku(4,2,n,e)},useMemo:function(n,e){var t=An();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=An();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=WR.bind(null,Me,n),[r.memoizedState,n]},useRef:function(n){var e=An();return n={current:n},e.memoizedState=n},useState:Yy,useDebugValue:Cp,useDeferredValue:function(n){return An().memoizedState=n},useTransition:function(){var n=Yy(!1),e=n[0];return n=qR.bind(null,n[1]),An().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Me,s=An();if(Ce){if(t===void 0)throw Error(z(407));t=t()}else{if(t=e(),it===null)throw Error(z(349));Ds&30||Yx(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Zy(eE.bind(null,r,i,n),[n]),r.flags|=2048,za(9,Zx.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=An(),e=it.identifierPrefix;if(Ce){var t=Qn,r=Hn;t=(r&~(1<<32-In(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=$a++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=zR++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},HR={readContext:pn,useCallback:lE,useContext:pn,useEffect:Pp,useImperativeHandle:aE,useInsertionEffect:sE,useLayoutEffect:iE,useMemo:uE,useReducer:$h,useRef:rE,useState:function(){return $h(Ba)},useDebugValue:Cp,useDeferredValue:function(n){var e=gn();return cE(e,Je.memoizedState,n)},useTransition:function(){var n=$h(Ba)[0],e=gn().memoizedState;return[n,e]},useMutableSource:Jx,useSyncExternalStore:Xx,useId:dE,unstable_isNewReconciler:!1},QR={readContext:pn,useCallback:lE,useContext:pn,useEffect:Pp,useImperativeHandle:aE,useInsertionEffect:sE,useLayoutEffect:iE,useMemo:uE,useReducer:Bh,useRef:rE,useState:function(){return Bh(Ba)},useDebugValue:Cp,useDeferredValue:function(n){var e=gn();return Je===null?e.memoizedState=n:cE(e,Je.memoizedState,n)},useTransition:function(){var n=Bh(Ba)[0],e=gn().memoizedState;return[n,e]},useMutableSource:Jx,useSyncExternalStore:Xx,useId:dE,unstable_isNewReconciler:!1};function vn(n,e){if(n&&n.defaultProps){e=je({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function qf(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:je({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var ad={isMounted:function(n){return(n=n._reactInternals)?Hs(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Ot(),s=Ur(n),i=tr(r,s);i.payload=e,t!=null&&(i.callback=t),e=jr(n,i,s),e!==null&&(Tn(e,n,s,r),bu(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Ot(),s=Ur(n),i=tr(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=jr(n,i,s),e!==null&&(Tn(e,n,s,r),bu(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ot(),r=Ur(n),s=tr(t,r);s.tag=2,e!=null&&(s.callback=e),e=jr(n,s,r),e!==null&&(Tn(e,n,r,t),bu(e,n,r))}};function e0(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Oa(t,r)||!Oa(s,i):!0}function pE(n,e,t){var r=!1,s=Jr,i=e.contextType;return typeof i=="object"&&i!==null?i=pn(i):(s=Gt(e)?Cs:Rt.current,r=e.contextTypes,i=(r=r!=null)?zi(n,s):Jr),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ad,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function t0(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&ad.enqueueReplaceState(e,e.state,null)}function Wf(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Ip(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=pn(i):(i=Gt(e)?Cs:Rt.current,s.context=zi(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(qf(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ad.enqueueReplaceState(s,s.state,null),pc(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Gi(n,e){try{var t="",r=e;do t+=IA(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function zh(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Kf(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var JR=typeof WeakMap=="function"?WeakMap:Map;function gE(n,e,t){t=tr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){wc||(wc=!0,nm=r),Kf(n,e)},t}function _E(n,e,t){t=tr(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){Kf(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Kf(n,e),typeof r!="function"&&(Fr===null?Fr=new Set([this]):Fr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function n0(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new JR;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=cP.bind(null,n,e,t),e.then(n,n))}function r0(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function s0(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=tr(-1,1),e.tag=2,jr(t,e,1))),t.lanes|=1),n)}var XR=cr.ReactCurrentOwner,qt=!1;function Dt(n,e,t,r){e.child=n===null?Kx(e,null,t,r):Wi(e,n.child,t,r)}function i0(n,e,t,r,s){t=t.render;var i=e.ref;return Mi(e,s),r=Ap(n,e,t,r,i,s),t=Rp(),n!==null&&!qt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ir(n,e,s)):(Ce&&t&&gp(e),e.flags|=1,Dt(n,e,r,s),e.child)}function o0(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!Fp(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,yE(n,e,i,r,s)):(n=Cu(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Oa,t(o,r)&&n.ref===e.ref)return ir(n,e,s)}return e.flags|=1,n=$r(i,r),n.ref=e.ref,n.return=e,e.child=n}function yE(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Oa(i,r)&&n.ref===e.ref)if(qt=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(qt=!0);else return e.lanes=n.lanes,ir(n,e,s)}return Gf(n,e,t,r,s)}function vE(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Te(Ri,Zt),Zt|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Te(Ri,Zt),Zt|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Te(Ri,Zt),Zt|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Te(Ri,Zt),Zt|=r;return Dt(n,e,s,t),e.child}function wE(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Gf(n,e,t,r,s){var i=Gt(t)?Cs:Rt.current;return i=zi(e,i),Mi(e,s),t=Ap(n,e,t,r,i,s),r=Rp(),n!==null&&!qt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,ir(n,e,s)):(Ce&&r&&gp(e),e.flags|=1,Dt(n,e,t,s),e.child)}function a0(n,e,t,r,s){if(Gt(t)){var i=!0;cc(e)}else i=!1;if(Mi(e,s),e.stateNode===null)Au(n,e),pE(e,t,r),Wf(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var u=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=pn(c):(c=Gt(t)?Cs:Rt.current,c=zi(e,c));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||u!==c)&&t0(e,o,r,c),Ir=!1;var p=e.memoizedState;o.state=p,pc(e,r,o,s),u=e.memoizedState,a!==r||p!==u||Kt.current||Ir?(typeof h=="function"&&(qf(e,t,h,r),u=e.memoizedState),(a=Ir||e0(e,t,a,r,p,u,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),o.props=r,o.state=u,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Hx(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:vn(e.type,a),o.props=c,f=e.pendingProps,p=o.context,u=t.contextType,typeof u=="object"&&u!==null?u=pn(u):(u=Gt(t)?Cs:Rt.current,u=zi(e,u));var w=t.getDerivedStateFromProps;(h=typeof w=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||p!==u)&&t0(e,o,r,u),Ir=!1,p=e.memoizedState,o.state=p,pc(e,r,o,s);var k=e.memoizedState;a!==f||p!==k||Kt.current||Ir?(typeof w=="function"&&(qf(e,t,w,r),k=e.memoizedState),(c=Ir||e0(e,t,c,r,p,k,u)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,k,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,k,u)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),o.props=r,o.state=k,o.context=u,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return Hf(n,e,t,r,i,s)}function Hf(n,e,t,r,s,i){wE(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Ky(e,t,!1),ir(n,e,i);r=e.stateNode,XR.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Wi(e,n.child,null,i),e.child=Wi(e,null,a,i)):Dt(n,e,a,i),e.memoizedState=r.state,s&&Ky(e,t,!0),e.child}function xE(n){var e=n.stateNode;e.pendingContext?Wy(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Wy(n,e.context,!1),Tp(n,e.containerInfo)}function l0(n,e,t,r,s){return qi(),yp(s),e.flags|=256,Dt(n,e,t,r),e.child}var Qf={dehydrated:null,treeContext:null,retryLane:0};function Jf(n){return{baseLanes:n,cachePool:null,transitions:null}}function EE(n,e,t){var r=e.pendingProps,s=De.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Te(De,s&1),n===null)return Bf(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=cd(o,r,0,null),n=As(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Jf(t),e.memoizedState=Qf,n):Np(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return YR(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var u={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=$r(s,u),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=$r(a,i):(i=As(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?Jf(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=Qf,r}return i=n.child,n=i.sibling,r=$r(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Np(n,e){return e=cd({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function nu(n,e,t,r){return r!==null&&yp(r),Wi(e,n.child,null,t),n=Np(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function YR(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=zh(Error(z(422))),nu(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=cd({mode:"visible",children:r.children},s,0,null),i=As(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Wi(e,n.child,null,o),e.child.memoizedState=Jf(o),e.memoizedState=Qf,i);if(!(e.mode&1))return nu(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(z(419)),r=zh(i,r,void 0),nu(n,e,o,r)}if(a=(o&n.childLanes)!==0,qt||a){if(r=it,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,sr(n,s),Tn(r,n,s,-1))}return jp(),r=zh(Error(z(421))),nu(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=dP.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,en=Lr(s.nextSibling),nn=e,Ce=!0,En=null,n!==null&&(ln[un++]=Hn,ln[un++]=Qn,ln[un++]=Ns,Hn=n.id,Qn=n.overflow,Ns=e),e=Np(e,r.children),e.flags|=4096,e)}function u0(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),zf(n.return,e,t)}function qh(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function IE(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Dt(n,e,r.children,t),r=De.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&u0(n,t,e);else if(n.tag===19)u0(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Te(De,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&gc(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),qh(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&gc(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}qh(e,!0,t,null,i);break;case"together":qh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Au(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ir(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Vs|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(z(153));if(e.child!==null){for(n=e.child,t=$r(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=$r(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function ZR(n,e,t){switch(e.tag){case 3:xE(e),qi();break;case 5:Qx(e);break;case 1:Gt(e.type)&&cc(e);break;case 4:Tp(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Te(fc,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Te(De,De.current&1),e.flags|=128,null):t&e.child.childLanes?EE(n,e,t):(Te(De,De.current&1),n=ir(n,e,t),n!==null?n.sibling:null);Te(De,De.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return IE(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Te(De,De.current),r)break;return null;case 22:case 23:return e.lanes=0,vE(n,e,t)}return ir(n,e,t)}var TE,Xf,bE,SE;TE=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Xf=function(){};bE=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Ts(On.current);var i=null;switch(t){case"input":s=vf(n,s),r=vf(n,r),i=[];break;case"select":s=je({},s,{value:void 0}),r=je({},r,{value:void 0}),i=[];break;case"textarea":s=Ef(n,s),r=Ef(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=lc)}Tf(t,r);var o;t=null;for(c in s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Aa.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var u=r[c];if(a=s!=null?s[c]:void 0,r.hasOwnProperty(c)&&u!==a&&(u!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in u)u.hasOwnProperty(o)&&a[o]!==u[o]&&(t||(t={}),t[o]=u[o])}else t||(i||(i=[]),i.push(c,t)),t=u;else c==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(i=i||[]).push(c,u)):c==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(c,""+u):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Aa.hasOwnProperty(c)?(u!=null&&c==="onScroll"&&Se("scroll",n),i||a===u||(i=[])):(i=i||[]).push(c,u))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};SE=function(n,e,t,r){t!==r&&(e.flags|=4)};function jo(n,e){if(!Ce)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function It(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function eP(n,e,t){var r=e.pendingProps;switch(_p(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return It(e),null;case 1:return Gt(e.type)&&uc(),It(e),null;case 3:return r=e.stateNode,Ki(),ke(Kt),ke(Rt),Sp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(eu(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,En!==null&&(im(En),En=null))),Xf(n,e),It(e),null;case 5:bp(e);var s=Ts(Ua.current);if(t=e.type,n!==null&&e.stateNode!=null)bE(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(z(166));return It(e),null}if(n=Ts(On.current),eu(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Pn]=e,r[ja]=i,n=(e.mode&1)!==0,t){case"dialog":Se("cancel",r),Se("close",r);break;case"iframe":case"object":case"embed":Se("load",r);break;case"video":case"audio":for(s=0;s<Qo.length;s++)Se(Qo[s],r);break;case"source":Se("error",r);break;case"img":case"image":case"link":Se("error",r),Se("load",r);break;case"details":Se("toggle",r);break;case"input":yy(r,i),Se("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Se("invalid",r);break;case"textarea":wy(r,i),Se("invalid",r)}Tf(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Zl(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Zl(r.textContent,a,n),s=["children",""+a]):Aa.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Se("scroll",r)}switch(t){case"input":Wl(r),vy(r,i,!0);break;case"textarea":Wl(r),xy(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=lc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=ex(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Pn]=e,n[ja]=r,TE(n,e,!1,!1),e.stateNode=n;e:{switch(o=bf(t,r),t){case"dialog":Se("cancel",n),Se("close",n),s=r;break;case"iframe":case"object":case"embed":Se("load",n),s=r;break;case"video":case"audio":for(s=0;s<Qo.length;s++)Se(Qo[s],n);s=r;break;case"source":Se("error",n),s=r;break;case"img":case"image":case"link":Se("error",n),Se("load",n),s=r;break;case"details":Se("toggle",n),s=r;break;case"input":yy(n,r),s=vf(n,r),Se("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=je({},r,{value:void 0}),Se("invalid",n);break;case"textarea":wy(n,r),s=Ef(n,r),Se("invalid",n);break;default:s=r}Tf(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var u=a[i];i==="style"?rx(n,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&tx(n,u)):i==="children"?typeof u=="string"?(t!=="textarea"||u!=="")&&Ra(n,u):typeof u=="number"&&Ra(n,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Aa.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Se("scroll",n):u!=null&&np(n,i,u,o))}switch(t){case"input":Wl(n),vy(n,r,!1);break;case"textarea":Wl(n),xy(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Qr(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Ni(n,!!r.multiple,i,!1):r.defaultValue!=null&&Ni(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=lc)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return It(e),null;case 6:if(n&&e.stateNode!=null)SE(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(z(166));if(t=Ts(Ua.current),Ts(On.current),eu(e)){if(r=e.stateNode,t=e.memoizedProps,r[Pn]=e,(i=r.nodeValue!==t)&&(n=nn,n!==null))switch(n.tag){case 3:Zl(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Zl(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Pn]=e,e.stateNode=r}return It(e),null;case 13:if(ke(De),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ce&&en!==null&&e.mode&1&&!(e.flags&128))qx(),qi(),e.flags|=98560,i=!1;else if(i=eu(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(z(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(z(317));i[Pn]=e}else qi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;It(e),i=!1}else En!==null&&(im(En),En=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||De.current&1?Ye===0&&(Ye=3):jp())),e.updateQueue!==null&&(e.flags|=4),It(e),null);case 4:return Ki(),Xf(n,e),n===null&&Ma(e.stateNode.containerInfo),It(e),null;case 10:return xp(e.type._context),It(e),null;case 17:return Gt(e.type)&&uc(),It(e),null;case 19:if(ke(De),i=e.memoizedState,i===null)return It(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)jo(i,!1);else{if(Ye!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=gc(n),o!==null){for(e.flags|=128,jo(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Te(De,De.current&1|2),e.child}n=n.sibling}i.tail!==null&&Be()>Hi&&(e.flags|=128,r=!0,jo(i,!1),e.lanes=4194304)}else{if(!r)if(n=gc(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),jo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ce)return It(e),null}else 2*Be()-i.renderingStartTime>Hi&&t!==1073741824&&(e.flags|=128,r=!0,jo(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Be(),e.sibling=null,t=De.current,Te(De,r?t&1|2:t&1),e):(It(e),null);case 22:case 23:return Lp(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Zt&1073741824&&(It(e),e.subtreeFlags&6&&(e.flags|=8192)):It(e),null;case 24:return null;case 25:return null}throw Error(z(156,e.tag))}function tP(n,e){switch(_p(e),e.tag){case 1:return Gt(e.type)&&uc(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ki(),ke(Kt),ke(Rt),Sp(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return bp(e),null;case 13:if(ke(De),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(z(340));qi()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ke(De),null;case 4:return Ki(),null;case 10:return xp(e.type._context),null;case 22:case 23:return Lp(),null;case 24:return null;default:return null}}var ru=!1,bt=!1,nP=typeof WeakSet=="function"?WeakSet:Set,H=null;function Ai(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ue(n,e,r)}else t.current=null}function Yf(n,e,t){try{t()}catch(r){Ue(n,e,r)}}var c0=!1;function rP(n,e){if(Of=ic,n=Cx(),pp(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,u=-1,c=0,h=0,f=n,p=null;t:for(;;){for(var w;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(u=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(w=f.firstChild)!==null;)p=f,f=w;for(;;){if(f===n)break t;if(p===t&&++c===s&&(a=o),p===i&&++h===r&&(u=o),(w=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=w}t=a===-1||u===-1?null:{start:a,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;for(Mf={focusedElem:n,selectionRange:t},ic=!1,H=e;H!==null;)if(e=H,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,H=n;else for(;H!==null;){e=H;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var S=k.memoizedProps,C=k.memoizedState,A=e.stateNode,x=A.getSnapshotBeforeUpdate(e.elementType===e.type?S:vn(e.type,S),C);A.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(z(163))}}catch(P){Ue(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,H=n;break}H=e.return}return k=c0,c0=!1,k}function ga(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&Yf(e,t,i)}s=s.next}while(s!==r)}}function ld(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Zf(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function kE(n){var e=n.alternate;e!==null&&(n.alternate=null,kE(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Pn],delete e[ja],delete e[Ff],delete e[FR],delete e[UR])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function AE(n){return n.tag===5||n.tag===3||n.tag===4}function d0(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||AE(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function em(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=lc));else if(r!==4&&(n=n.child,n!==null))for(em(n,e,t),n=n.sibling;n!==null;)em(n,e,t),n=n.sibling}function tm(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(tm(n,e,t),n=n.sibling;n!==null;)tm(n,e,t),n=n.sibling}var lt=null,xn=!1;function gr(n,e,t){for(t=t.child;t!==null;)RE(n,e,t),t=t.sibling}function RE(n,e,t){if(Vn&&typeof Vn.onCommitFiberUnmount=="function")try{Vn.onCommitFiberUnmount(ed,t)}catch{}switch(t.tag){case 5:bt||Ai(t,e);case 6:var r=lt,s=xn;lt=null,gr(n,e,t),lt=r,xn=s,lt!==null&&(xn?(n=lt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):lt.removeChild(t.stateNode));break;case 18:lt!==null&&(xn?(n=lt,t=t.stateNode,n.nodeType===8?Lh(n.parentNode,t):n.nodeType===1&&Lh(n,t),Da(n)):Lh(lt,t.stateNode));break;case 4:r=lt,s=xn,lt=t.stateNode.containerInfo,xn=!0,gr(n,e,t),lt=r,xn=s;break;case 0:case 11:case 14:case 15:if(!bt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Yf(t,e,o),s=s.next}while(s!==r)}gr(n,e,t);break;case 1:if(!bt&&(Ai(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Ue(t,e,a)}gr(n,e,t);break;case 21:gr(n,e,t);break;case 22:t.mode&1?(bt=(r=bt)||t.memoizedState!==null,gr(n,e,t),bt=r):gr(n,e,t);break;default:gr(n,e,t)}}function h0(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new nP),e.forEach(function(r){var s=hP.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function yn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:lt=a.stateNode,xn=!1;break e;case 3:lt=a.stateNode.containerInfo,xn=!0;break e;case 4:lt=a.stateNode.containerInfo,xn=!0;break e}a=a.return}if(lt===null)throw Error(z(160));RE(i,o,s),lt=null,xn=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(c){Ue(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)PE(e,n),e=e.sibling}function PE(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(yn(e,n),Sn(n),r&4){try{ga(3,n,n.return),ld(3,n)}catch(S){Ue(n,n.return,S)}try{ga(5,n,n.return)}catch(S){Ue(n,n.return,S)}}break;case 1:yn(e,n),Sn(n),r&512&&t!==null&&Ai(t,t.return);break;case 5:if(yn(e,n),Sn(n),r&512&&t!==null&&Ai(t,t.return),n.flags&32){var s=n.stateNode;try{Ra(s,"")}catch(S){Ue(n,n.return,S)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,u=n.updateQueue;if(n.updateQueue=null,u!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Yw(s,i),bf(a,o);var c=bf(a,i);for(o=0;o<u.length;o+=2){var h=u[o],f=u[o+1];h==="style"?rx(s,f):h==="dangerouslySetInnerHTML"?tx(s,f):h==="children"?Ra(s,f):np(s,h,f,c)}switch(a){case"input":wf(s,i);break;case"textarea":Zw(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var w=i.value;w!=null?Ni(s,!!i.multiple,w,!1):p!==!!i.multiple&&(i.defaultValue!=null?Ni(s,!!i.multiple,i.defaultValue,!0):Ni(s,!!i.multiple,i.multiple?[]:"",!1))}s[ja]=i}catch(S){Ue(n,n.return,S)}}break;case 6:if(yn(e,n),Sn(n),r&4){if(n.stateNode===null)throw Error(z(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(S){Ue(n,n.return,S)}}break;case 3:if(yn(e,n),Sn(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Da(e.containerInfo)}catch(S){Ue(n,n.return,S)}break;case 4:yn(e,n),Sn(n);break;case 13:yn(e,n),Sn(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Op=Be())),r&4&&h0(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(bt=(c=bt)||h,yn(e,n),bt=c):yn(e,n),Sn(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!h&&n.mode&1)for(H=n,h=n.child;h!==null;){for(f=H=h;H!==null;){switch(p=H,w=p.child,p.tag){case 0:case 11:case 14:case 15:ga(4,p,p.return);break;case 1:Ai(p,p.return);var k=p.stateNode;if(typeof k.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(S){Ue(r,t,S)}}break;case 5:Ai(p,p.return);break;case 22:if(p.memoizedState!==null){m0(f);continue}}w!==null?(w.return=p,H=w):m0(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,u=f.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=nx("display",o))}catch(S){Ue(n,n.return,S)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(S){Ue(n,n.return,S)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:yn(e,n),Sn(n),r&4&&h0(n);break;case 21:break;default:yn(e,n),Sn(n)}}function Sn(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(AE(t)){var r=t;break e}t=t.return}throw Error(z(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ra(s,""),r.flags&=-33);var i=d0(n);tm(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=d0(n);em(n,a,o);break;default:throw Error(z(161))}}catch(u){Ue(n,n.return,u)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function sP(n,e,t){H=n,CE(n)}function CE(n,e,t){for(var r=(n.mode&1)!==0;H!==null;){var s=H,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||ru;if(!o){var a=s.alternate,u=a!==null&&a.memoizedState!==null||bt;a=ru;var c=bt;if(ru=o,(bt=u)&&!c)for(H=s;H!==null;)o=H,u=o.child,o.tag===22&&o.memoizedState!==null?p0(s):u!==null?(u.return=o,H=u):p0(s);for(;i!==null;)H=i,CE(i),i=i.sibling;H=s,ru=a,bt=c}f0(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,H=i):f0(n)}}function f0(n){for(;H!==null;){var e=H;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bt||ld(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bt)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:vn(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Xy(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Xy(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&t.focus();break;case"img":u.src&&(t.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Da(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(z(163))}bt||e.flags&512&&Zf(e)}catch(p){Ue(e,e.return,p)}}if(e===n){H=null;break}if(t=e.sibling,t!==null){t.return=e.return,H=t;break}H=e.return}}function m0(n){for(;H!==null;){var e=H;if(e===n){H=null;break}var t=e.sibling;if(t!==null){t.return=e.return,H=t;break}H=e.return}}function p0(n){for(;H!==null;){var e=H;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ld(4,e)}catch(u){Ue(e,t,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(u){Ue(e,s,u)}}var i=e.return;try{Zf(e)}catch(u){Ue(e,i,u)}break;case 5:var o=e.return;try{Zf(e)}catch(u){Ue(e,o,u)}}}catch(u){Ue(e,e.return,u)}if(e===n){H=null;break}var a=e.sibling;if(a!==null){a.return=e.return,H=a;break}H=e.return}}var iP=Math.ceil,vc=cr.ReactCurrentDispatcher,Dp=cr.ReactCurrentOwner,fn=cr.ReactCurrentBatchConfig,pe=0,it=null,We=null,ft=0,Zt=0,Ri=ns(0),Ye=0,qa=null,Vs=0,ud=0,Vp=0,_a=null,zt=null,Op=0,Hi=1/0,Kn=null,wc=!1,nm=null,Fr=null,su=!1,Nr=null,xc=0,ya=0,rm=null,Ru=-1,Pu=0;function Ot(){return pe&6?Be():Ru!==-1?Ru:Ru=Be()}function Ur(n){return n.mode&1?pe&2&&ft!==0?ft&-ft:BR.transition!==null?(Pu===0&&(Pu=px()),Pu):(n=we,n!==0||(n=window.event,n=n===void 0?16:Ex(n.type)),n):1}function Tn(n,e,t,r){if(50<ya)throw ya=0,rm=null,Error(z(185));il(n,t,r),(!(pe&2)||n!==it)&&(n===it&&(!(pe&2)&&(ud|=t),Ye===4&&br(n,ft)),Ht(n,r),t===1&&pe===0&&!(e.mode&1)&&(Hi=Be()+500,id&&rs()))}function Ht(n,e){var t=n.callbackNode;BA(n,e);var r=sc(n,n===it?ft:0);if(r===0)t!==null&&Ty(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Ty(t),e===1)n.tag===0?$R(g0.bind(null,n)):$x(g0.bind(null,n)),LR(function(){!(pe&6)&&rs()}),t=null;else{switch(gx(r)){case 1:t=ap;break;case 4:t=fx;break;case 16:t=rc;break;case 536870912:t=mx;break;default:t=rc}t=FE(t,NE.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function NE(n,e){if(Ru=-1,Pu=0,pe&6)throw Error(z(327));var t=n.callbackNode;if(Li()&&n.callbackNode!==t)return null;var r=sc(n,n===it?ft:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Ec(n,r);else{e=r;var s=pe;pe|=2;var i=VE();(it!==n||ft!==e)&&(Kn=null,Hi=Be()+500,ks(n,e));do try{lP();break}catch(a){DE(n,a)}while(!0);wp(),vc.current=i,pe=s,We!==null?e=0:(it=null,ft=0,e=Ye)}if(e!==0){if(e===2&&(s=Pf(n),s!==0&&(r=s,e=sm(n,s))),e===1)throw t=qa,ks(n,0),br(n,r),Ht(n,Be()),t;if(e===6)br(n,r);else{if(s=n.current.alternate,!(r&30)&&!oP(s)&&(e=Ec(n,r),e===2&&(i=Pf(n),i!==0&&(r=i,e=sm(n,i))),e===1))throw t=qa,ks(n,0),br(n,r),Ht(n,Be()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(z(345));case 2:fs(n,zt,Kn);break;case 3:if(br(n,r),(r&130023424)===r&&(e=Op+500-Be(),10<e)){if(sc(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){Ot(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=jf(fs.bind(null,n,zt,Kn),e);break}fs(n,zt,Kn);break;case 4:if(br(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-In(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Be()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*iP(r/1960))-r,10<r){n.timeoutHandle=jf(fs.bind(null,n,zt,Kn),r);break}fs(n,zt,Kn);break;case 5:fs(n,zt,Kn);break;default:throw Error(z(329))}}}return Ht(n,Be()),n.callbackNode===t?NE.bind(null,n):null}function sm(n,e){var t=_a;return n.current.memoizedState.isDehydrated&&(ks(n,e).flags|=256),n=Ec(n,e),n!==2&&(e=zt,zt=t,e!==null&&im(e)),n}function im(n){zt===null?zt=n:zt.push.apply(zt,n)}function oP(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!bn(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function br(n,e){for(e&=~Vp,e&=~ud,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-In(e),r=1<<t;n[t]=-1,e&=~r}}function g0(n){if(pe&6)throw Error(z(327));Li();var e=sc(n,0);if(!(e&1))return Ht(n,Be()),null;var t=Ec(n,e);if(n.tag!==0&&t===2){var r=Pf(n);r!==0&&(e=r,t=sm(n,r))}if(t===1)throw t=qa,ks(n,0),br(n,e),Ht(n,Be()),t;if(t===6)throw Error(z(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,fs(n,zt,Kn),Ht(n,Be()),null}function Mp(n,e){var t=pe;pe|=1;try{return n(e)}finally{pe=t,pe===0&&(Hi=Be()+500,id&&rs())}}function Os(n){Nr!==null&&Nr.tag===0&&!(pe&6)&&Li();var e=pe;pe|=1;var t=fn.transition,r=we;try{if(fn.transition=null,we=1,n)return n()}finally{we=r,fn.transition=t,pe=e,!(pe&6)&&rs()}}function Lp(){Zt=Ri.current,ke(Ri)}function ks(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,MR(t)),We!==null)for(t=We.return;t!==null;){var r=t;switch(_p(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&uc();break;case 3:Ki(),ke(Kt),ke(Rt),Sp();break;case 5:bp(r);break;case 4:Ki();break;case 13:ke(De);break;case 19:ke(De);break;case 10:xp(r.type._context);break;case 22:case 23:Lp()}t=t.return}if(it=n,We=n=$r(n.current,null),ft=Zt=e,Ye=0,qa=null,Vp=ud=Vs=0,zt=_a=null,Is!==null){for(e=0;e<Is.length;e++)if(t=Is[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Is=null}return n}function DE(n,e){do{var t=We;try{if(wp(),Su.current=yc,_c){for(var r=Me.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}_c=!1}if(Ds=0,st=Je=Me=null,pa=!1,$a=0,Dp.current=null,t===null||t.return===null){Ye=1,qa=e,We=null;break}e:{var i=n,o=t.return,a=t,u=e;if(e=ft,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var c=u,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var w=r0(o);if(w!==null){w.flags&=-257,s0(w,o,a,i,e),w.mode&1&&n0(i,c,e),e=w,u=c;var k=e.updateQueue;if(k===null){var S=new Set;S.add(u),e.updateQueue=S}else k.add(u);break e}else{if(!(e&1)){n0(i,c,e),jp();break e}u=Error(z(426))}}else if(Ce&&a.mode&1){var C=r0(o);if(C!==null){!(C.flags&65536)&&(C.flags|=256),s0(C,o,a,i,e),yp(Gi(u,a));break e}}i=u=Gi(u,a),Ye!==4&&(Ye=2),_a===null?_a=[i]:_a.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var A=gE(i,u,e);Jy(i,A);break e;case 1:a=u;var x=i.type,T=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Fr===null||!Fr.has(T)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=_E(i,a,e);Jy(i,P);break e}}i=i.return}while(i!==null)}ME(t)}catch(M){e=M,We===t&&t!==null&&(We=t=t.return);continue}break}while(!0)}function VE(){var n=vc.current;return vc.current=yc,n===null?yc:n}function jp(){(Ye===0||Ye===3||Ye===2)&&(Ye=4),it===null||!(Vs&268435455)&&!(ud&268435455)||br(it,ft)}function Ec(n,e){var t=pe;pe|=2;var r=VE();(it!==n||ft!==e)&&(Kn=null,ks(n,e));do try{aP();break}catch(s){DE(n,s)}while(!0);if(wp(),pe=t,vc.current=r,We!==null)throw Error(z(261));return it=null,ft=0,Ye}function aP(){for(;We!==null;)OE(We)}function lP(){for(;We!==null&&!DA();)OE(We)}function OE(n){var e=jE(n.alternate,n,Zt);n.memoizedProps=n.pendingProps,e===null?ME(n):We=e,Dp.current=null}function ME(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=tP(t,e),t!==null){t.flags&=32767,We=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ye=6,We=null;return}}else if(t=eP(t,e,Zt),t!==null){We=t;return}if(e=e.sibling,e!==null){We=e;return}We=e=n}while(e!==null);Ye===0&&(Ye=5)}function fs(n,e,t){var r=we,s=fn.transition;try{fn.transition=null,we=1,uP(n,e,t,r)}finally{fn.transition=s,we=r}return null}function uP(n,e,t,r){do Li();while(Nr!==null);if(pe&6)throw Error(z(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(z(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(zA(n,i),n===it&&(We=it=null,ft=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||su||(su=!0,FE(rc,function(){return Li(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=fn.transition,fn.transition=null;var o=we;we=1;var a=pe;pe|=4,Dp.current=null,rP(n,t),PE(t,n),RR(Mf),ic=!!Of,Mf=Of=null,n.current=t,sP(t),VA(),pe=a,we=o,fn.transition=i}else n.current=t;if(su&&(su=!1,Nr=n,xc=s),i=n.pendingLanes,i===0&&(Fr=null),LA(t.stateNode),Ht(n,Be()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(wc)throw wc=!1,n=nm,nm=null,n;return xc&1&&n.tag!==0&&Li(),i=n.pendingLanes,i&1?n===rm?ya++:(ya=0,rm=n):ya=0,rs(),null}function Li(){if(Nr!==null){var n=gx(xc),e=fn.transition,t=we;try{if(fn.transition=null,we=16>n?16:n,Nr===null)var r=!1;else{if(n=Nr,Nr=null,xc=0,pe&6)throw Error(z(331));var s=pe;for(pe|=4,H=n.current;H!==null;){var i=H,o=i.child;if(H.flags&16){var a=i.deletions;if(a!==null){for(var u=0;u<a.length;u++){var c=a[u];for(H=c;H!==null;){var h=H;switch(h.tag){case 0:case 11:case 15:ga(8,h,i)}var f=h.child;if(f!==null)f.return=h,H=f;else for(;H!==null;){h=H;var p=h.sibling,w=h.return;if(kE(h),h===c){H=null;break}if(p!==null){p.return=w,H=p;break}H=w}}}var k=i.alternate;if(k!==null){var S=k.child;if(S!==null){k.child=null;do{var C=S.sibling;S.sibling=null,S=C}while(S!==null)}}H=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,H=o;else e:for(;H!==null;){if(i=H,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ga(9,i,i.return)}var A=i.sibling;if(A!==null){A.return=i.return,H=A;break e}H=i.return}}var x=n.current;for(H=x;H!==null;){o=H;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,H=T;else e:for(o=x;H!==null;){if(a=H,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ld(9,a)}}catch(M){Ue(a,a.return,M)}if(a===o){H=null;break e}var P=a.sibling;if(P!==null){P.return=a.return,H=P;break e}H=a.return}}if(pe=s,rs(),Vn&&typeof Vn.onPostCommitFiberRoot=="function")try{Vn.onPostCommitFiberRoot(ed,n)}catch{}r=!0}return r}finally{we=t,fn.transition=e}}return!1}function _0(n,e,t){e=Gi(t,e),e=gE(n,e,1),n=jr(n,e,1),e=Ot(),n!==null&&(il(n,1,e),Ht(n,e))}function Ue(n,e,t){if(n.tag===3)_0(n,n,t);else for(;e!==null;){if(e.tag===3){_0(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Fr===null||!Fr.has(r))){n=Gi(t,n),n=_E(e,n,1),e=jr(e,n,1),n=Ot(),e!==null&&(il(e,1,n),Ht(e,n));break}}e=e.return}}function cP(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Ot(),n.pingedLanes|=n.suspendedLanes&t,it===n&&(ft&t)===t&&(Ye===4||Ye===3&&(ft&130023424)===ft&&500>Be()-Op?ks(n,0):Vp|=t),Ht(n,e)}function LE(n,e){e===0&&(n.mode&1?(e=Hl,Hl<<=1,!(Hl&130023424)&&(Hl=4194304)):e=1);var t=Ot();n=sr(n,e),n!==null&&(il(n,e,t),Ht(n,t))}function dP(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),LE(n,t)}function hP(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(z(314))}r!==null&&r.delete(e),LE(n,t)}var jE;jE=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Kt.current)qt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return qt=!1,ZR(n,e,t);qt=!!(n.flags&131072)}else qt=!1,Ce&&e.flags&1048576&&Bx(e,hc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Au(n,e),n=e.pendingProps;var s=zi(e,Rt.current);Mi(e,t),s=Ap(null,e,r,n,s,t);var i=Rp();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Gt(r)?(i=!0,cc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Ip(e),s.updater=ad,e.stateNode=s,s._reactInternals=e,Wf(e,r,n,t),e=Hf(null,e,r,!0,i,t)):(e.tag=0,Ce&&i&&gp(e),Dt(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Au(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=mP(r),n=vn(r,n),s){case 0:e=Gf(null,e,r,n,t);break e;case 1:e=a0(null,e,r,n,t);break e;case 11:e=i0(null,e,r,n,t);break e;case 14:e=o0(null,e,r,vn(r.type,n),t);break e}throw Error(z(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vn(r,s),Gf(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vn(r,s),a0(n,e,r,s,t);case 3:e:{if(xE(e),n===null)throw Error(z(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Hx(n,e),pc(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Gi(Error(z(423)),e),e=l0(n,e,r,t,s);break e}else if(r!==s){s=Gi(Error(z(424)),e),e=l0(n,e,r,t,s);break e}else for(en=Lr(e.stateNode.containerInfo.firstChild),nn=e,Ce=!0,En=null,t=Kx(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(qi(),r===s){e=ir(n,e,t);break e}Dt(n,e,r,t)}e=e.child}return e;case 5:return Qx(e),n===null&&Bf(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,Lf(r,s)?o=null:i!==null&&Lf(r,i)&&(e.flags|=32),wE(n,e),Dt(n,e,o,t),e.child;case 6:return n===null&&Bf(e),null;case 13:return EE(n,e,t);case 4:return Tp(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Wi(e,null,r,t):Dt(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vn(r,s),i0(n,e,r,s,t);case 7:return Dt(n,e,e.pendingProps,t),e.child;case 8:return Dt(n,e,e.pendingProps.children,t),e.child;case 12:return Dt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Te(fc,r._currentValue),r._currentValue=o,i!==null)if(bn(i.value,o)){if(i.children===s.children&&!Kt.current){e=ir(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=tr(-1,t&-t),u.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?u.next=u:(u.next=h.next,h.next=u),c.pending=u}}i.lanes|=t,u=i.alternate,u!==null&&(u.lanes|=t),zf(i.return,t,e),a.lanes|=t;break}u=u.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(z(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),zf(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Dt(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Mi(e,t),s=pn(s),r=r(s),e.flags|=1,Dt(n,e,r,t),e.child;case 14:return r=e.type,s=vn(r,e.pendingProps),s=vn(r.type,s),o0(n,e,r,s,t);case 15:return yE(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vn(r,s),Au(n,e),e.tag=1,Gt(r)?(n=!0,cc(e)):n=!1,Mi(e,t),pE(e,r,s),Wf(e,r,s,t),Hf(null,e,r,!0,n,t);case 19:return IE(n,e,t);case 22:return vE(n,e,t)}throw Error(z(156,e.tag))};function FE(n,e){return hx(n,e)}function fP(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cn(n,e,t,r){return new fP(n,e,t,r)}function Fp(n){return n=n.prototype,!(!n||!n.isReactComponent)}function mP(n){if(typeof n=="function")return Fp(n)?1:0;if(n!=null){if(n=n.$$typeof,n===sp)return 11;if(n===ip)return 14}return 2}function $r(n,e){var t=n.alternate;return t===null?(t=cn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Cu(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")Fp(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case vi:return As(t.children,s,i,e);case rp:o=8,s|=8;break;case pf:return n=cn(12,t,e,s|2),n.elementType=pf,n.lanes=i,n;case gf:return n=cn(13,t,e,s),n.elementType=gf,n.lanes=i,n;case _f:return n=cn(19,t,e,s),n.elementType=_f,n.lanes=i,n;case Qw:return cd(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Gw:o=10;break e;case Hw:o=9;break e;case sp:o=11;break e;case ip:o=14;break e;case Er:o=16,r=null;break e}throw Error(z(130,n==null?n:typeof n,""))}return e=cn(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function As(n,e,t,r){return n=cn(7,n,r,e),n.lanes=t,n}function cd(n,e,t,r){return n=cn(22,n,r,e),n.elementType=Qw,n.lanes=t,n.stateNode={isHidden:!1},n}function Wh(n,e,t){return n=cn(6,n,null,e),n.lanes=t,n}function Kh(n,e,t){return e=cn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function pP(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Sh(0),this.expirationTimes=Sh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Sh(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Up(n,e,t,r,s,i,o,a,u){return n=new pP(n,e,t,a,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=cn(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ip(i),n}function gP(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yi,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function UE(n){if(!n)return Jr;n=n._reactInternals;e:{if(Hs(n)!==n||n.tag!==1)throw Error(z(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Gt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(z(171))}if(n.tag===1){var t=n.type;if(Gt(t))return Ux(n,t,e)}return e}function $E(n,e,t,r,s,i,o,a,u){return n=Up(t,r,!0,n,s,i,o,a,u),n.context=UE(null),t=n.current,r=Ot(),s=Ur(t),i=tr(r,s),i.callback=e??null,jr(t,i,s),n.current.lanes=s,il(n,s,r),Ht(n,r),n}function dd(n,e,t,r){var s=e.current,i=Ot(),o=Ur(s);return t=UE(t),e.context===null?e.context=t:e.pendingContext=t,e=tr(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=jr(s,e,o),n!==null&&(Tn(n,s,o,i),bu(n,s,o)),o}function Ic(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function y0(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function $p(n,e){y0(n,e),(n=n.alternate)&&y0(n,e)}function _P(){return null}var BE=typeof reportError=="function"?reportError:function(n){console.error(n)};function Bp(n){this._internalRoot=n}hd.prototype.render=Bp.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(z(409));dd(n,e,null,null)};hd.prototype.unmount=Bp.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Os(function(){dd(null,n,null,null)}),e[rr]=null}};function hd(n){this._internalRoot=n}hd.prototype.unstable_scheduleHydration=function(n){if(n){var e=vx();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Tr.length&&e!==0&&e<Tr[t].priority;t++);Tr.splice(t,0,n),t===0&&xx(n)}};function zp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function fd(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function v0(){}function yP(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var c=Ic(o);i.call(c)}}var o=$E(e,r,n,0,null,!1,!1,"",v0);return n._reactRootContainer=o,n[rr]=o.current,Ma(n.nodeType===8?n.parentNode:n),Os(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var c=Ic(u);a.call(c)}}var u=Up(n,0,!1,null,null,!1,!1,"",v0);return n._reactRootContainer=u,n[rr]=u.current,Ma(n.nodeType===8?n.parentNode:n),Os(function(){dd(e,u,t,r)}),u}function md(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var u=Ic(o);a.call(u)}}dd(e,o,n,s)}else o=yP(t,e,n,s,r);return Ic(o)}_x=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Ho(e.pendingLanes);t!==0&&(lp(e,t|1),Ht(e,Be()),!(pe&6)&&(Hi=Be()+500,rs()))}break;case 13:Os(function(){var r=sr(n,1);if(r!==null){var s=Ot();Tn(r,n,1,s)}}),$p(n,1)}};up=function(n){if(n.tag===13){var e=sr(n,134217728);if(e!==null){var t=Ot();Tn(e,n,134217728,t)}$p(n,134217728)}};yx=function(n){if(n.tag===13){var e=Ur(n),t=sr(n,e);if(t!==null){var r=Ot();Tn(t,n,e,r)}$p(n,e)}};vx=function(){return we};wx=function(n,e){var t=we;try{return we=n,e()}finally{we=t}};kf=function(n,e,t){switch(e){case"input":if(wf(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=sd(r);if(!s)throw Error(z(90));Xw(r),wf(r,s)}}}break;case"textarea":Zw(n,t);break;case"select":e=t.value,e!=null&&Ni(n,!!t.multiple,e,!1)}};ox=Mp;ax=Os;var vP={usingClientEntryPoint:!1,Events:[al,Ii,sd,sx,ix,Mp]},Fo={findFiberByHostInstance:Es,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wP={bundleType:Fo.bundleType,version:Fo.version,rendererPackageName:Fo.rendererPackageName,rendererConfig:Fo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:cr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=cx(n),n===null?null:n.stateNode},findFiberByHostInstance:Fo.findFiberByHostInstance||_P,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{ed=iu.inject(wP),Vn=iu}catch{}}on.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vP;on.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zp(e))throw Error(z(200));return gP(n,e,null,t)};on.createRoot=function(n,e){if(!zp(n))throw Error(z(299));var t=!1,r="",s=BE;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Up(n,1,!1,null,null,t,!1,r,s),n[rr]=e.current,Ma(n.nodeType===8?n.parentNode:n),new Bp(e)};on.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(z(188)):(n=Object.keys(n).join(","),Error(z(268,n)));return n=cx(e),n=n===null?null:n.stateNode,n};on.flushSync=function(n){return Os(n)};on.hydrate=function(n,e,t){if(!fd(e))throw Error(z(200));return md(null,n,e,!0,t)};on.hydrateRoot=function(n,e,t){if(!zp(n))throw Error(z(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=BE;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=$E(e,null,n,1,t??null,s,!1,i,o),n[rr]=e.current,Ma(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new hd(e)};on.render=function(n,e,t){if(!fd(e))throw Error(z(200));return md(null,n,e,!1,t)};on.unmountComponentAtNode=function(n){if(!fd(n))throw Error(z(40));return n._reactRootContainer?(Os(function(){md(null,null,n,!1,function(){n._reactRootContainer=null,n[rr]=null})}),!0):!1};on.unstable_batchedUpdates=Mp;on.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!fd(t))throw Error(z(200));if(n==null||n._reactInternals===void 0)throw Error(z(38));return md(n,e,t,!1,r)};on.version="18.3.1-next-f1338f8080-20240426";function zE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(zE)}catch(n){console.error(n)}}zE(),zw.exports=on;var xP=zw.exports,qE,w0=xP;qE=w0.createRoot,w0.hydrateRoot;var x0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WE=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},EP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],u=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},KE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,u=s+2<n.length,c=u?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let p=(a&15)<<2|c>>6,w=c&63;u||(w=64,o||(p=64)),r.push(t[h],t[f],t[p],t[w])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(WE(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):EP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new IP;const p=i<<2|a>>4;if(r.push(p),c!==64){const w=a<<4&240|c>>2;if(r.push(w),f!==64){const k=c<<6&192|f;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class IP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const TP=function(n){const e=WE(n);return KE.encodeByteArray(e,!0)},Tc=function(n){return TP(n).replace(/\./g,"")},GE=function(n){try{return KE.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SP=()=>bP().__FIREBASE_DEFAULTS__,kP=()=>{if(typeof process>"u"||typeof x0>"u")return;const n=x0.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},AP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&GE(n[1]);return e&&JSON.parse(e)},pd=()=>{try{return SP()||kP()||AP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},HE=n=>{var e,t;return(t=(e=pd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},RP=n=>{const e=HE(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},QE=()=>{var n;return(n=pd())===null||n===void 0?void 0:n.config},JE=n=>{var e;return(e=pd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Tc(JSON.stringify(t)),Tc(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ze(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function NP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ze())}function DP(){var n;const e=(n=pd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function VP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function OP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function MP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function LP(){const n=Ze();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function XE(){return!DP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function YE(){try{return typeof indexedDB=="object"}catch{return!1}}function jP(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP="FirebaseError";class dr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=FP,Object.setPrototypeOf(this,dr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ul.prototype.create)}}class ul{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?UP(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new dr(s,a,r)}}function UP(n,e){return n.replace($P,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const $P=/\{\$([^}]+)}/g;function BP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function bc(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(E0(i)&&E0(o)){if(!bc(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function E0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function zP(n,e){const t=new qP(n,e);return t.subscribe.bind(t)}class qP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");WP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Gh),s.error===void 0&&(s.error=Gh),s.complete===void 0&&(s.complete=Gh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function WP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Gh(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pt(n){return n&&n._delegate?n._delegate:n}class Ms{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ms="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new PP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(HP(e))try{this.getOrInitializeService({instanceIdentifier:ms})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ms){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ms){return this.instances.has(e)}getOptions(e=ms){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:GP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ms){return this.component?this.component.multipleInstances?e:ms:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function GP(n){return n===ms?void 0:n}function HP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new KP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var he;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(he||(he={}));const JP={debug:he.DEBUG,verbose:he.VERBOSE,info:he.INFO,warn:he.WARN,error:he.ERROR,silent:he.SILENT},XP=he.INFO,YP={[he.DEBUG]:"log",[he.VERBOSE]:"log",[he.INFO]:"info",[he.WARN]:"warn",[he.ERROR]:"error"},ZP=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=YP[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class qp{constructor(e){this.name=e,this._logLevel=XP,this._logHandler=ZP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in he))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?JP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,he.DEBUG,...e),this._logHandler(this,he.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,he.VERBOSE,...e),this._logHandler(this,he.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,he.INFO,...e),this._logHandler(this,he.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,he.WARN,...e),this._logHandler(this,he.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,he.ERROR,...e),this._logHandler(this,he.ERROR,...e)}}const eC=(n,e)=>e.some(t=>n instanceof t);let I0,T0;function tC(){return I0||(I0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nC(){return T0||(T0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ZE=new WeakMap,om=new WeakMap,eI=new WeakMap,Hh=new WeakMap,Wp=new WeakMap;function rC(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Br(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ZE.set(t,n)}).catch(()=>{}),Wp.set(e,n),e}function sC(n){if(om.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});om.set(n,e)}let am={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return om.get(n);if(e==="objectStoreNames")return n.objectStoreNames||eI.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Br(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function iC(n){am=n(am)}function oC(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Qh(this),e,...t);return eI.set(r,e.sort?e.sort():[e]),Br(r)}:nC().includes(n)?function(...e){return n.apply(Qh(this),e),Br(ZE.get(this))}:function(...e){return Br(n.apply(Qh(this),e))}}function aC(n){return typeof n=="function"?oC(n):(n instanceof IDBTransaction&&sC(n),eC(n,tC())?new Proxy(n,am):n)}function Br(n){if(n instanceof IDBRequest)return rC(n);if(Hh.has(n))return Hh.get(n);const e=aC(n);return e!==n&&(Hh.set(n,e),Wp.set(e,n)),e}const Qh=n=>Wp.get(n);function lC(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Br(o);return r&&o.addEventListener("upgradeneeded",u=>{r(Br(o.result),u.oldVersion,u.newVersion,Br(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const uC=["get","getKey","getAll","getAllKeys","count"],cC=["put","add","delete","clear"],Jh=new Map;function b0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Jh.get(e))return Jh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=cC.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||uC.includes(t)))return;const i=async function(o,...a){const u=this.transaction(o,s?"readwrite":"readonly");let c=u.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&u.done]))[0]};return Jh.set(e,i),i}iC(n=>({...n,get:(e,t,r)=>b0(e,t)||n.get(e,t,r),has:(e,t)=>!!b0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(hC(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function hC(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const lm="@firebase/app",S0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const or=new qp("@firebase/app"),fC="@firebase/app-compat",mC="@firebase/analytics-compat",pC="@firebase/analytics",gC="@firebase/app-check-compat",_C="@firebase/app-check",yC="@firebase/auth",vC="@firebase/auth-compat",wC="@firebase/database",xC="@firebase/data-connect",EC="@firebase/database-compat",IC="@firebase/functions",TC="@firebase/functions-compat",bC="@firebase/installations",SC="@firebase/installations-compat",kC="@firebase/messaging",AC="@firebase/messaging-compat",RC="@firebase/performance",PC="@firebase/performance-compat",CC="@firebase/remote-config",NC="@firebase/remote-config-compat",DC="@firebase/storage",VC="@firebase/storage-compat",OC="@firebase/firestore",MC="@firebase/vertexai-preview",LC="@firebase/firestore-compat",jC="firebase",FC="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const um="[DEFAULT]",UC={[lm]:"fire-core",[fC]:"fire-core-compat",[pC]:"fire-analytics",[mC]:"fire-analytics-compat",[_C]:"fire-app-check",[gC]:"fire-app-check-compat",[yC]:"fire-auth",[vC]:"fire-auth-compat",[wC]:"fire-rtdb",[xC]:"fire-data-connect",[EC]:"fire-rtdb-compat",[IC]:"fire-fn",[TC]:"fire-fn-compat",[bC]:"fire-iid",[SC]:"fire-iid-compat",[kC]:"fire-fcm",[AC]:"fire-fcm-compat",[RC]:"fire-perf",[PC]:"fire-perf-compat",[CC]:"fire-rc",[NC]:"fire-rc-compat",[DC]:"fire-gcs",[VC]:"fire-gcs-compat",[OC]:"fire-fst",[LC]:"fire-fst-compat",[MC]:"fire-vertex","fire-js":"fire-js",[jC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc=new Map,$C=new Map,cm=new Map;function k0(n,e){try{n.container.addComponent(e)}catch(t){or.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Qi(n){const e=n.name;if(cm.has(e))return or.debug(`There were multiple attempts to register component ${e}.`),!1;cm.set(e,n);for(const t of Sc.values())k0(t,n);for(const t of $C.values())k0(t,n);return!0}function Kp(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Jn(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},zr=new ul("app","Firebase",BC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ms("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw zr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uo=FC;function tI(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:um,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw zr.create("bad-app-name",{appName:String(s)});if(t||(t=QE()),!t)throw zr.create("no-options");const i=Sc.get(s);if(i){if(bc(t,i.options)&&bc(r,i.config))return i;throw zr.create("duplicate-app",{appName:s})}const o=new QP(s);for(const u of cm.values())o.addComponent(u);const a=new zC(t,r,o);return Sc.set(s,a),a}function nI(n=um){const e=Sc.get(n);if(!e&&n===um&&QE())return tI();if(!e)throw zr.create("no-app",{appName:n});return e}function qr(n,e,t){var r;let s=(r=UC[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),or.warn(a.join(" "));return}Qi(new Ms(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC="firebase-heartbeat-database",WC=1,Wa="firebase-heartbeat-store";let Xh=null;function rI(){return Xh||(Xh=lC(qC,WC,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Wa)}catch(t){console.warn(t)}}}}).catch(n=>{throw zr.create("idb-open",{originalErrorMessage:n.message})})),Xh}async function KC(n){try{const t=(await rI()).transaction(Wa),r=await t.objectStore(Wa).get(sI(n));return await t.done,r}catch(e){if(e instanceof dr)or.warn(e.message);else{const t=zr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});or.warn(t.message)}}}async function A0(n,e){try{const r=(await rI()).transaction(Wa,"readwrite");await r.objectStore(Wa).put(e,sI(n)),await r.done}catch(t){if(t instanceof dr)or.warn(t.message);else{const r=zr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});or.warn(r.message)}}}function sI(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GC=1024,HC=30*24*60*60*1e3;class QC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new XC(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=R0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=HC}),this._storage.overwrite(this._heartbeatsCache))}catch(r){or.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=R0(),{heartbeatsToSend:r,unsentEntries:s}=JC(this._heartbeatsCache.heartbeats),i=Tc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return or.warn(t),""}}}function R0(){return new Date().toISOString().substring(0,10)}function JC(n,e=GC){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),P0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),P0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class XC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return YE()?jP().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await KC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return A0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return A0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function P0(n){return Tc(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(n){Qi(new Ms("platform-logger",e=>new dC(e),"PRIVATE")),Qi(new Ms("heartbeat",e=>new QC(e),"PRIVATE")),qr(lm,S0,n),qr(lm,S0,"esm2017"),qr("fire-js","")}YC("");var ZC="firebase",e1="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qr(ZC,e1,"app");function Gp(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function iI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const t1=iI,oI=new ul("auth","Firebase",iI());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=new qp("@firebase/auth");function n1(n,...e){kc.logLevel<=he.WARN&&kc.warn(`Auth (${uo}): ${n}`,...e)}function Nu(n,...e){kc.logLevel<=he.ERROR&&kc.error(`Auth (${uo}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ar(n,...e){throw Hp(n,...e)}function Mn(n,...e){return Hp(n,...e)}function aI(n,e,t){const r=Object.assign(Object.assign({},t1()),{[e]:t});return new ul("auth","Firebase",r).create(e,{appName:n.name})}function Wr(n){return aI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Hp(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return oI.create(n,...e)}function ie(n,e,...t){if(!n)throw Hp(e,...t)}function Xn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Nu(e),new Error(e)}function lr(n,e){n||Xn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function r1(){return C0()==="http:"||C0()==="https:"}function C0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s1(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(r1()||OP()||"connection"in navigator)?navigator.onLine:!0}function i1(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(e,t){this.shortDelay=e,this.longDelay=t,lr(t>e,"Short delay should be less than long delay!"),this.isMobile=NP()||MP()}get(){return s1()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qp(n,e){lr(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lI{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a1=new dl(3e4,6e4);function gd(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function co(n,e,t,r,s={}){return uI(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=cl(Object.assign({key:n.config.apiKey},o)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:u},i);return VP()||(c.referrerPolicy="no-referrer"),lI.fetch()(dI(n,n.config.apiHost,t,a),c)})}async function uI(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},o1),e);try{const s=new l1(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw ou(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[u,c]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ou(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw ou(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw ou(n,"user-disabled",o);const h=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw aI(n,h,c);ar(n,h)}}catch(s){if(s instanceof dr)throw s;ar(n,"network-request-failed",{message:String(s)})}}async function cI(n,e,t,r,s={}){const i=await co(n,e,t,r,s);return"mfaPendingCredential"in i&&ar(n,"multi-factor-auth-required",{_serverResponse:i}),i}function dI(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Qp(n.config,s):`${n.config.apiScheme}://${s}`}class l1{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Mn(this.auth,"network-request-failed")),a1.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ou(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Mn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u1(n,e){return co(n,"POST","/v1/accounts:delete",e)}async function hI(n,e){return co(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function c1(n,e=!1){const t=pt(n),r=await t.getIdToken(e),s=Jp(r);ie(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:va(Yh(s.auth_time)),issuedAtTime:va(Yh(s.iat)),expirationTime:va(Yh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Yh(n){return Number(n)*1e3}function Jp(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Nu("JWT malformed, contained fewer than 3 sections"),null;try{const s=GE(t);return s?JSON.parse(s):(Nu("Failed to decode base64 JWT payload"),null)}catch(s){return Nu("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function N0(n){const e=Jp(n);return ie(e,"internal-error"),ie(typeof e.exp<"u","internal-error"),ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ka(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof dr&&d1(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function d1({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=va(this.lastLoginAt),this.creationTime=va(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ac(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Ka(n,hI(t,{idToken:r}));ie(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?fI(i.providerUserInfo):[],a=m1(n.providerData,o),u=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=u?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new hm(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function f1(n){const e=pt(n);await Ac(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function m1(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function fI(n){return n.map(e=>{var{providerId:t}=e,r=Gp(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p1(n,e){const t=await uI(n,{},async()=>{const r=cl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=dI(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",lI.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function g1(n,e){return co(n,"POST","/v2/accounts:revokeToken",gd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ie(e.idToken,"internal-error"),ie(typeof e.idToken<"u","internal-error"),ie(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):N0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ie(e.length!==0,"internal-error");const t=N0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await p1(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ji;return r&&(ie(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ie(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ji,this.toJSON())}_performRefresh(){return Xn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(n,e){ie(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Yn{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Gp(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new h1(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new hm(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Ka(this,this.stsTokenManager.getToken(this.auth,e));return ie(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return c1(this,e)}reload(){return f1(this)}_assign(e){this!==e&&(ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Yn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ac(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Jn(this.auth.app))return Promise.reject(Wr(this.auth));const e=await this.getIdToken();return await Ka(this,u1(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,u,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,p=(s=t.email)!==null&&s!==void 0?s:void 0,w=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,k=(o=t.photoURL)!==null&&o!==void 0?o:void 0,S=(a=t.tenantId)!==null&&a!==void 0?a:void 0,C=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,A=(c=t.createdAt)!==null&&c!==void 0?c:void 0,x=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:T,emailVerified:P,isAnonymous:M,providerData:V,stsTokenManager:y}=t;ie(T&&y,e,"internal-error");const _=ji.fromJSON(this.name,y);ie(typeof T=="string",e,"internal-error"),_r(f,e.name),_r(p,e.name),ie(typeof P=="boolean",e,"internal-error"),ie(typeof M=="boolean",e,"internal-error"),_r(w,e.name),_r(k,e.name),_r(S,e.name),_r(C,e.name),_r(A,e.name),_r(x,e.name);const v=new Yn({uid:T,auth:e,email:p,emailVerified:P,displayName:f,isAnonymous:M,photoURL:k,phoneNumber:w,tenantId:S,stsTokenManager:_,createdAt:A,lastLoginAt:x});return V&&Array.isArray(V)&&(v.providerData=V.map(E=>Object.assign({},E))),C&&(v._redirectEventId=C),v}static async _fromIdTokenResponse(e,t,r=!1){const s=new ji;s.updateFromServerResponse(t);const i=new Yn({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ac(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ie(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?fI(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ji;a.updateFromIdToken(r);const u=new Yn({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new hm(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,c),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0=new Map;function Zn(n){lr(n instanceof Function,"Expected a class definition");let e=D0.get(n);return e?(lr(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,D0.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}mI.type="NONE";const V0=mI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Du(n,e,t){return`firebase:${n}:${e}:${t}`}class Fi{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Du(this.userKey,s.apiKey,i),this.fullPersistenceKey=Du("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Yn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Fi(Zn(V0),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Zn(V0);const o=Du(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=Yn._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const u=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Fi(i,e,r):(i=u[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Fi(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O0(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(pI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(wI(e))return"Blackberry";if(xI(e))return"Webos";if(gI(e))return"Safari";if((e.includes("chrome/")||_I(e))&&!e.includes("edge/"))return"Chrome";if(vI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function pI(n=Ze()){return/firefox\//i.test(n)}function gI(n=Ze()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _I(n=Ze()){return/crios\//i.test(n)}function yI(n=Ze()){return/iemobile/i.test(n)}function vI(n=Ze()){return/android/i.test(n)}function wI(n=Ze()){return/blackberry/i.test(n)}function xI(n=Ze()){return/webos/i.test(n)}function Xp(n=Ze()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function _1(n=Ze()){var e;return Xp(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function y1(){return LP()&&document.documentMode===10}function EI(n=Ze()){return Xp(n)||vI(n)||xI(n)||wI(n)||/windows phone/i.test(n)||yI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(n,e=[]){let t;switch(n){case"Browser":t=O0(Ze());break;case"Worker":t=`${O0(Ze())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${uo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const u=e(i);o(u)}catch(u){a(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w1(n,e={}){return co(n,"GET","/v2/passwordPolicy",gd(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x1=6;class E1{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:x1,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),u}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new M0(this),this.idTokenSubscription=new M0(this),this.beforeStateQueue=new v1(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=oI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zn(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Fi.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await hI(this,{idToken:e}),r=await Yn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Jn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ac(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=i1()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Jn(this.app))return Promise.reject(Wr(this));const t=e?pt(e):null;return t&&ie(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Jn(this.app)?Promise.reject(Wr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Jn(this.app)?Promise.reject(Wr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await w1(this),t=new E1(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ul("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await g1(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Zn(e)||this._popupRedirectResolver;ie(t,this,"argument-error"),this.redirectPersistenceManager=await Fi.create(this,[Zn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ie(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{o=!0,u()}}else{const u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=II(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&n1(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function _d(n){return pt(n)}class M0{constructor(e){this.auth=e,this.observer=null,this.addObserver=zP(t=>this.observer=t)}get next(){return ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function T1(n){Yp=n}function b1(n){return Yp.loadJS(n)}function S1(){return Yp.gapiScript}function k1(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A1(n,e){const t=Kp(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(bc(i,e??{}))return s;ar(s,"already-initialized")}return t.initialize({options:e})}function R1(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Zn);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function P1(n,e,t){const r=_d(n);ie(r._canInitEmulator,r,"emulator-config-failed"),ie(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=TI(e),{host:o,port:a}=C1(e),u=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),N1()}function TI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function C1(n){const e=TI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:L0(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:L0(o)}}}function L0(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function N1(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xn("not implemented")}_getIdTokenResponse(e){return Xn("not implemented")}_linkToIdToken(e,t){return Xn("not implemented")}_getReauthenticationResolver(e){return Xn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ui(n,e){return cI(n,"POST","/v1/accounts:signInWithIdp",gd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D1="http://localhost";class Ls extends bI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ls(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ar("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Gp(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Ls(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ui(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ui(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ui(e,t)}buildRequest(){const e={requestUri:D1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=cl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl extends SI{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr extends hl{constructor(){super("facebook.com")}static credential(e){return Ls._fromParams({providerId:Sr.PROVIDER_ID,signInMethod:Sr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sr.credentialFromTaggedObject(e)}static credentialFromError(e){return Sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sr.credential(e.oauthAccessToken)}catch{return null}}}Sr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Sr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr extends hl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ls._fromParams({providerId:kr.PROVIDER_ID,signInMethod:kr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return kr.credentialFromTaggedObject(e)}static credentialFromError(e){return kr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return kr.credential(t,r)}catch{return null}}}kr.GOOGLE_SIGN_IN_METHOD="google.com";kr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar extends hl{constructor(){super("github.com")}static credential(e){return Ls._fromParams({providerId:Ar.PROVIDER_ID,signInMethod:Ar.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ar.credentialFromTaggedObject(e)}static credentialFromError(e){return Ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ar.credential(e.oauthAccessToken)}catch{return null}}}Ar.GITHUB_SIGN_IN_METHOD="github.com";Ar.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr extends hl{constructor(){super("twitter.com")}static credential(e,t){return Ls._fromParams({providerId:Rr.PROVIDER_ID,signInMethod:Rr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Rr.credentialFromTaggedObject(e)}static credentialFromError(e){return Rr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Rr.credential(t,r)}catch{return null}}}Rr.TWITTER_SIGN_IN_METHOD="twitter.com";Rr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V1(n,e){return cI(n,"POST","/v1/accounts:signUp",gd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Yn._fromIdTokenResponse(e,r,s),o=j0(r);return new Xr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=j0(r);return new Xr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function j0(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O1(n){var e;if(Jn(n.app))return Promise.reject(Wr(n));const t=_d(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Xr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await V1(t,{returnSecureToken:!0}),s=await Xr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc extends dr{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Rc.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Rc(e,t,r,s)}}function kI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Rc._fromErrorAndOperation(n,i,e,r):i})}async function M1(n,e,t=!1){const r=await Ka(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Xr._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L1(n,e,t=!1){const{auth:r}=n;if(Jn(r.app))return Promise.reject(Wr(r));const s="reauthenticate";try{const i=await Ka(n,kI(r,s,e,n),t);ie(i.idToken,r,"internal-error");const o=Jp(i.idToken);ie(o,r,"internal-error");const{sub:a}=o;return ie(n.uid===a,r,"user-mismatch"),Xr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ar(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j1(n,e,t=!1){if(Jn(n.app))return Promise.reject(Wr(n));const r="signIn",s=await kI(n,r,e),i=await Xr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function F1(n,e,t,r){return pt(n).onIdTokenChanged(e,t,r)}function U1(n,e,t){return pt(n).beforeAuthStateChanged(e,t)}function $1(n,e,t,r){return pt(n).onAuthStateChanged(e,t,r)}const Pc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Pc,"1"),this.storage.removeItem(Pc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B1=1e3,z1=10;class RI extends AI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=EI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,u)=>{this.notifyListeners(o,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);y1()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,z1):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},B1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}RI.type="LOCAL";const q1=RI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI extends AI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}PI.type="SESSION";const CI=PI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W1(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new yd(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),u=await W1(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}yd.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zp(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,u)=>{const c=Zp("",20);s.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===c)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(){return window}function G1(n){Ln().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NI(){return typeof Ln().WorkerGlobalScope<"u"&&typeof Ln().importScripts=="function"}async function H1(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Q1(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function J1(){return NI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DI="firebaseLocalStorageDb",X1=1,Cc="firebaseLocalStorage",VI="fbase_key";class fl{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function vd(n,e){return n.transaction([Cc],e?"readwrite":"readonly").objectStore(Cc)}function Y1(){const n=indexedDB.deleteDatabase(DI);return new fl(n).toPromise()}function fm(){const n=indexedDB.open(DI,X1);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Cc,{keyPath:VI})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Cc)?e(r):(r.close(),await Y1(),e(await fm()))})})}async function F0(n,e,t){const r=vd(n,!0).put({[VI]:e,value:t});return new fl(r).toPromise()}async function Z1(n,e){const t=vd(n,!1).get(e),r=await new fl(t).toPromise();return r===void 0?null:r.value}function U0(n,e){const t=vd(n,!0).delete(e);return new fl(t).toPromise()}const eN=800,tN=3;class OI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await fm(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>tN)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return NI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=yd._getInstance(J1()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await H1(),!this.activeServiceWorker)return;this.sender=new K1(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Q1()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await fm();return await F0(e,Pc,"1"),await U0(e,Pc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>F0(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Z1(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>U0(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=vd(s,!1).getAll();return new fl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),eN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}OI.type="LOCAL";const nN=OI;new dl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rN(n,e){return e?Zn(e):(ie(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg extends bI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ui(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ui(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ui(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function sN(n){return j1(n.auth,new eg(n),n.bypassAuthState)}function iN(n){const{auth:e,user:t}=n;return ie(t,e,"internal-error"),L1(t,new eg(n),n.bypassAuthState)}async function oN(n){const{auth:e,user:t}=n;return ie(t,e,"internal-error"),M1(t,new eg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(u))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sN;case"linkViaPopup":case"linkViaRedirect":return oN;case"reauthViaPopup":case"reauthViaRedirect":return iN;default:ar(this.auth,"internal-error")}}resolve(e){lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aN=new dl(2e3,1e4);class Pi extends MI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Pi.currentPopupAction&&Pi.currentPopupAction.cancel(),Pi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ie(e,this.auth,"internal-error"),e}async onExecution(){lr(this.filter.length===1,"Popup operations only handle one event");const e=Zp();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Mn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Mn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Pi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Mn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,aN.get())};e()}}Pi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lN="pendingRedirect",Vu=new Map;class uN extends MI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Vu.get(this.auth._key());if(!e){try{const r=await cN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Vu.set(this.auth._key(),e)}return this.bypassAuthState||Vu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function cN(n,e){const t=fN(e),r=hN(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function dN(n,e){Vu.set(n._key(),e)}function hN(n){return Zn(n._redirectPersistence)}function fN(n){return Du(lN,n.config.apiKey,n.name)}async function mN(n,e,t=!1){if(Jn(n.app))return Promise.reject(Wr(n));const r=_d(n),s=rN(r,e),o=await new uN(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pN=10*60*1e3;class gN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_N(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!LI(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Mn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=pN&&this.cachedEventUids.clear(),this.cachedEventUids.has($0(e))}saveEventToCache(e){this.cachedEventUids.add($0(e)),this.lastProcessedEventTime=Date.now()}}function $0(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function LI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function _N(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return LI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yN(n,e={}){return co(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vN=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wN=/^https?/;async function xN(n){if(n.config.emulator)return;const{authorizedDomains:e}=await yN(n);for(const t of e)try{if(EN(t))return}catch{}ar(n,"unauthorized-domain")}function EN(n){const e=dm(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!wN.test(t))return!1;if(vN.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IN=new dl(3e4,6e4);function B0(){const n=Ln().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function TN(n){return new Promise((e,t)=>{var r,s,i;function o(){B0(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{B0(),t(Mn(n,"network-request-failed"))},timeout:IN.get()})}if(!((s=(r=Ln().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Ln().gapi)===null||i===void 0)&&i.load)o();else{const a=k1("iframefcb");return Ln()[a]=()=>{gapi.load?o():t(Mn(n,"network-request-failed"))},b1(`${S1()}?onload=${a}`).catch(u=>t(u))}}).catch(e=>{throw Ou=null,e})}let Ou=null;function bN(n){return Ou=Ou||TN(n),Ou}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SN=new dl(5e3,15e3),kN="__/auth/iframe",AN="emulator/auth/iframe",RN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},PN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function CN(n){const e=n.config;ie(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Qp(e,AN):`https://${n.config.authDomain}/${kN}`,r={apiKey:e.apiKey,appName:n.name,v:uo},s=PN.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${cl(r).slice(1)}`}async function NN(n){const e=await bN(n),t=Ln().gapi;return ie(t,n,"internal-error"),e.open({where:document.body,url:CN(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:RN,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Mn(n,"network-request-failed"),a=Ln().setTimeout(()=>{i(o)},SN.get());function u(){Ln().clearTimeout(a),s(r)}r.ping(u).then(u,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VN=500,ON=600,MN="_blank",LN="http://localhost";class z0{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function jN(n,e,t,r=VN,s=ON){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const u=Object.assign(Object.assign({},DN),{width:r.toString(),height:s.toString(),top:i,left:o}),c=Ze().toLowerCase();t&&(a=_I(c)?MN:t),pI(c)&&(e=e||LN,u.scrollbars="yes");const h=Object.entries(u).reduce((p,[w,k])=>`${p}${w}=${k},`,"");if(_1(c)&&a!=="_self")return FN(e||"",a),new z0(null);const f=window.open(e||"",a,h);ie(f,n,"popup-blocked");try{f.focus()}catch{}return new z0(f)}function FN(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UN="__/auth/handler",$N="emulator/auth/handler",BN=encodeURIComponent("fac");async function q0(n,e,t,r,s,i){ie(n.config.authDomain,n,"auth-domain-config-required"),ie(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:uo,eventId:s};if(e instanceof SI){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",BP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))o[h]=f}if(e instanceof hl){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const u=await n._getAppCheckToken(),c=u?`#${BN}=${encodeURIComponent(u)}`:"";return`${zN(n)}?${cl(a).slice(1)}${c}`}function zN({config:n}){return n.emulator?Qp(n,$N):`https://${n.authDomain}/${UN}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zh="webStorageSupport";class qN{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=CI,this._completeRedirectFn=mN,this._overrideRedirectResult=dN}async _openPopup(e,t,r,s){var i;lr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await q0(e,t,r,dm(),s);return jN(e,o,Zp())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await q0(e,t,r,dm(),s);return G1(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(lr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await NN(e),r=new gN(e);return t.register("authEvent",s=>(ie(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Zh,{type:Zh},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Zh];o!==void 0&&t(!!o),ar(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=xN(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return EI()||gI()||Xp()}}const WN=qN;var W0="@firebase/auth",K0="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function HN(n){Qi(new Ms("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ie(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:II(n)},c=new I1(r,s,i,u);return R1(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Qi(new Ms("auth-internal",e=>{const t=_d(e.getProvider("auth").getImmediate());return(r=>new KN(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),qr(W0,K0,GN(n)),qr(W0,K0,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QN=5*60,JN=JE("authIdTokenMaxAge")||QN;let G0=null;const XN=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>JN)return;const s=t==null?void 0:t.token;G0!==s&&(G0=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function YN(n=nI()){const e=Kp(n,"auth");if(e.isInitialized())return e.getImmediate();const t=A1(n,{popupRedirectResolver:WN,persistence:[nN,q1,CI]}),r=JE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=XN(i.toString());U1(t,o,()=>o(t.currentUser)),F1(t,a=>o(a))}}const s=HE("auth");return s&&P1(t,`http://${s}`),t}function ZN(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}T1({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Mn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",ZN().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});HN("Browser");var H0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Rs,jI;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(y,_){function v(){}v.prototype=_.prototype,y.D=_.prototype,y.prototype=new v,y.prototype.constructor=y,y.C=function(E,b,N){for(var R=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)R[Ae-2]=arguments[Ae];return _.prototype[b].apply(E,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(y,_,v){v||(v=0);var E=Array(16);if(typeof _=="string")for(var b=0;16>b;++b)E[b]=_.charCodeAt(v++)|_.charCodeAt(v++)<<8|_.charCodeAt(v++)<<16|_.charCodeAt(v++)<<24;else for(b=0;16>b;++b)E[b]=_[v++]|_[v++]<<8|_[v++]<<16|_[v++]<<24;_=y.g[0],v=y.g[1],b=y.g[2];var N=y.g[3],R=_+(N^v&(b^N))+E[0]+3614090360&4294967295;_=v+(R<<7&4294967295|R>>>25),R=N+(b^_&(v^b))+E[1]+3905402710&4294967295,N=_+(R<<12&4294967295|R>>>20),R=b+(v^N&(_^v))+E[2]+606105819&4294967295,b=N+(R<<17&4294967295|R>>>15),R=v+(_^b&(N^_))+E[3]+3250441966&4294967295,v=b+(R<<22&4294967295|R>>>10),R=_+(N^v&(b^N))+E[4]+4118548399&4294967295,_=v+(R<<7&4294967295|R>>>25),R=N+(b^_&(v^b))+E[5]+1200080426&4294967295,N=_+(R<<12&4294967295|R>>>20),R=b+(v^N&(_^v))+E[6]+2821735955&4294967295,b=N+(R<<17&4294967295|R>>>15),R=v+(_^b&(N^_))+E[7]+4249261313&4294967295,v=b+(R<<22&4294967295|R>>>10),R=_+(N^v&(b^N))+E[8]+1770035416&4294967295,_=v+(R<<7&4294967295|R>>>25),R=N+(b^_&(v^b))+E[9]+2336552879&4294967295,N=_+(R<<12&4294967295|R>>>20),R=b+(v^N&(_^v))+E[10]+4294925233&4294967295,b=N+(R<<17&4294967295|R>>>15),R=v+(_^b&(N^_))+E[11]+2304563134&4294967295,v=b+(R<<22&4294967295|R>>>10),R=_+(N^v&(b^N))+E[12]+1804603682&4294967295,_=v+(R<<7&4294967295|R>>>25),R=N+(b^_&(v^b))+E[13]+4254626195&4294967295,N=_+(R<<12&4294967295|R>>>20),R=b+(v^N&(_^v))+E[14]+2792965006&4294967295,b=N+(R<<17&4294967295|R>>>15),R=v+(_^b&(N^_))+E[15]+1236535329&4294967295,v=b+(R<<22&4294967295|R>>>10),R=_+(b^N&(v^b))+E[1]+4129170786&4294967295,_=v+(R<<5&4294967295|R>>>27),R=N+(v^b&(_^v))+E[6]+3225465664&4294967295,N=_+(R<<9&4294967295|R>>>23),R=b+(_^v&(N^_))+E[11]+643717713&4294967295,b=N+(R<<14&4294967295|R>>>18),R=v+(N^_&(b^N))+E[0]+3921069994&4294967295,v=b+(R<<20&4294967295|R>>>12),R=_+(b^N&(v^b))+E[5]+3593408605&4294967295,_=v+(R<<5&4294967295|R>>>27),R=N+(v^b&(_^v))+E[10]+38016083&4294967295,N=_+(R<<9&4294967295|R>>>23),R=b+(_^v&(N^_))+E[15]+3634488961&4294967295,b=N+(R<<14&4294967295|R>>>18),R=v+(N^_&(b^N))+E[4]+3889429448&4294967295,v=b+(R<<20&4294967295|R>>>12),R=_+(b^N&(v^b))+E[9]+568446438&4294967295,_=v+(R<<5&4294967295|R>>>27),R=N+(v^b&(_^v))+E[14]+3275163606&4294967295,N=_+(R<<9&4294967295|R>>>23),R=b+(_^v&(N^_))+E[3]+4107603335&4294967295,b=N+(R<<14&4294967295|R>>>18),R=v+(N^_&(b^N))+E[8]+1163531501&4294967295,v=b+(R<<20&4294967295|R>>>12),R=_+(b^N&(v^b))+E[13]+2850285829&4294967295,_=v+(R<<5&4294967295|R>>>27),R=N+(v^b&(_^v))+E[2]+4243563512&4294967295,N=_+(R<<9&4294967295|R>>>23),R=b+(_^v&(N^_))+E[7]+1735328473&4294967295,b=N+(R<<14&4294967295|R>>>18),R=v+(N^_&(b^N))+E[12]+2368359562&4294967295,v=b+(R<<20&4294967295|R>>>12),R=_+(v^b^N)+E[5]+4294588738&4294967295,_=v+(R<<4&4294967295|R>>>28),R=N+(_^v^b)+E[8]+2272392833&4294967295,N=_+(R<<11&4294967295|R>>>21),R=b+(N^_^v)+E[11]+1839030562&4294967295,b=N+(R<<16&4294967295|R>>>16),R=v+(b^N^_)+E[14]+4259657740&4294967295,v=b+(R<<23&4294967295|R>>>9),R=_+(v^b^N)+E[1]+2763975236&4294967295,_=v+(R<<4&4294967295|R>>>28),R=N+(_^v^b)+E[4]+1272893353&4294967295,N=_+(R<<11&4294967295|R>>>21),R=b+(N^_^v)+E[7]+4139469664&4294967295,b=N+(R<<16&4294967295|R>>>16),R=v+(b^N^_)+E[10]+3200236656&4294967295,v=b+(R<<23&4294967295|R>>>9),R=_+(v^b^N)+E[13]+681279174&4294967295,_=v+(R<<4&4294967295|R>>>28),R=N+(_^v^b)+E[0]+3936430074&4294967295,N=_+(R<<11&4294967295|R>>>21),R=b+(N^_^v)+E[3]+3572445317&4294967295,b=N+(R<<16&4294967295|R>>>16),R=v+(b^N^_)+E[6]+76029189&4294967295,v=b+(R<<23&4294967295|R>>>9),R=_+(v^b^N)+E[9]+3654602809&4294967295,_=v+(R<<4&4294967295|R>>>28),R=N+(_^v^b)+E[12]+3873151461&4294967295,N=_+(R<<11&4294967295|R>>>21),R=b+(N^_^v)+E[15]+530742520&4294967295,b=N+(R<<16&4294967295|R>>>16),R=v+(b^N^_)+E[2]+3299628645&4294967295,v=b+(R<<23&4294967295|R>>>9),R=_+(b^(v|~N))+E[0]+4096336452&4294967295,_=v+(R<<6&4294967295|R>>>26),R=N+(v^(_|~b))+E[7]+1126891415&4294967295,N=_+(R<<10&4294967295|R>>>22),R=b+(_^(N|~v))+E[14]+2878612391&4294967295,b=N+(R<<15&4294967295|R>>>17),R=v+(N^(b|~_))+E[5]+4237533241&4294967295,v=b+(R<<21&4294967295|R>>>11),R=_+(b^(v|~N))+E[12]+1700485571&4294967295,_=v+(R<<6&4294967295|R>>>26),R=N+(v^(_|~b))+E[3]+2399980690&4294967295,N=_+(R<<10&4294967295|R>>>22),R=b+(_^(N|~v))+E[10]+4293915773&4294967295,b=N+(R<<15&4294967295|R>>>17),R=v+(N^(b|~_))+E[1]+2240044497&4294967295,v=b+(R<<21&4294967295|R>>>11),R=_+(b^(v|~N))+E[8]+1873313359&4294967295,_=v+(R<<6&4294967295|R>>>26),R=N+(v^(_|~b))+E[15]+4264355552&4294967295,N=_+(R<<10&4294967295|R>>>22),R=b+(_^(N|~v))+E[6]+2734768916&4294967295,b=N+(R<<15&4294967295|R>>>17),R=v+(N^(b|~_))+E[13]+1309151649&4294967295,v=b+(R<<21&4294967295|R>>>11),R=_+(b^(v|~N))+E[4]+4149444226&4294967295,_=v+(R<<6&4294967295|R>>>26),R=N+(v^(_|~b))+E[11]+3174756917&4294967295,N=_+(R<<10&4294967295|R>>>22),R=b+(_^(N|~v))+E[2]+718787259&4294967295,b=N+(R<<15&4294967295|R>>>17),R=v+(N^(b|~_))+E[9]+3951481745&4294967295,y.g[0]=y.g[0]+_&4294967295,y.g[1]=y.g[1]+(b+(R<<21&4294967295|R>>>11))&4294967295,y.g[2]=y.g[2]+b&4294967295,y.g[3]=y.g[3]+N&4294967295}r.prototype.u=function(y,_){_===void 0&&(_=y.length);for(var v=_-this.blockSize,E=this.B,b=this.h,N=0;N<_;){if(b==0)for(;N<=v;)s(this,y,N),N+=this.blockSize;if(typeof y=="string"){for(;N<_;)if(E[b++]=y.charCodeAt(N++),b==this.blockSize){s(this,E),b=0;break}}else for(;N<_;)if(E[b++]=y[N++],b==this.blockSize){s(this,E),b=0;break}}this.h=b,this.o+=_},r.prototype.v=function(){var y=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);y[0]=128;for(var _=1;_<y.length-8;++_)y[_]=0;var v=8*this.o;for(_=y.length-8;_<y.length;++_)y[_]=v&255,v/=256;for(this.u(y),y=Array(16),_=v=0;4>_;++_)for(var E=0;32>E;E+=8)y[v++]=this.g[_]>>>E&255;return y};function i(y,_){var v=a;return Object.prototype.hasOwnProperty.call(v,y)?v[y]:v[y]=_(y)}function o(y,_){this.h=_;for(var v=[],E=!0,b=y.length-1;0<=b;b--){var N=y[b]|0;E&&N==_||(v[b]=N,E=!1)}this.g=v}var a={};function u(y){return-128<=y&&128>y?i(y,function(_){return new o([_|0],0>_?-1:0)}):new o([y|0],0>y?-1:0)}function c(y){if(isNaN(y)||!isFinite(y))return f;if(0>y)return C(c(-y));for(var _=[],v=1,E=0;y>=v;E++)_[E]=y/v|0,v*=4294967296;return new o(_,0)}function h(y,_){if(y.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(y.charAt(0)=="-")return C(h(y.substring(1),_));if(0<=y.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=c(Math.pow(_,8)),E=f,b=0;b<y.length;b+=8){var N=Math.min(8,y.length-b),R=parseInt(y.substring(b,b+N),_);8>N?(N=c(Math.pow(_,N)),E=E.j(N).add(c(R))):(E=E.j(v),E=E.add(c(R)))}return E}var f=u(0),p=u(1),w=u(16777216);n=o.prototype,n.m=function(){if(S(this))return-C(this).m();for(var y=0,_=1,v=0;v<this.g.length;v++){var E=this.i(v);y+=(0<=E?E:4294967296+E)*_,_*=4294967296}return y},n.toString=function(y){if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(k(this))return"0";if(S(this))return"-"+C(this).toString(y);for(var _=c(Math.pow(y,6)),v=this,E="";;){var b=P(v,_).g;v=A(v,b.j(_));var N=((0<v.g.length?v.g[0]:v.h)>>>0).toString(y);if(v=b,k(v))return N+E;for(;6>N.length;)N="0"+N;E=N+E}},n.i=function(y){return 0>y?0:y<this.g.length?this.g[y]:this.h};function k(y){if(y.h!=0)return!1;for(var _=0;_<y.g.length;_++)if(y.g[_]!=0)return!1;return!0}function S(y){return y.h==-1}n.l=function(y){return y=A(this,y),S(y)?-1:k(y)?0:1};function C(y){for(var _=y.g.length,v=[],E=0;E<_;E++)v[E]=~y.g[E];return new o(v,~y.h).add(p)}n.abs=function(){return S(this)?C(this):this},n.add=function(y){for(var _=Math.max(this.g.length,y.g.length),v=[],E=0,b=0;b<=_;b++){var N=E+(this.i(b)&65535)+(y.i(b)&65535),R=(N>>>16)+(this.i(b)>>>16)+(y.i(b)>>>16);E=R>>>16,N&=65535,R&=65535,v[b]=R<<16|N}return new o(v,v[v.length-1]&-2147483648?-1:0)};function A(y,_){return y.add(C(_))}n.j=function(y){if(k(this)||k(y))return f;if(S(this))return S(y)?C(this).j(C(y)):C(C(this).j(y));if(S(y))return C(this.j(C(y)));if(0>this.l(w)&&0>y.l(w))return c(this.m()*y.m());for(var _=this.g.length+y.g.length,v=[],E=0;E<2*_;E++)v[E]=0;for(E=0;E<this.g.length;E++)for(var b=0;b<y.g.length;b++){var N=this.i(E)>>>16,R=this.i(E)&65535,Ae=y.i(b)>>>16,ot=y.i(b)&65535;v[2*E+2*b]+=R*ot,x(v,2*E+2*b),v[2*E+2*b+1]+=N*ot,x(v,2*E+2*b+1),v[2*E+2*b+1]+=R*Ae,x(v,2*E+2*b+1),v[2*E+2*b+2]+=N*Ae,x(v,2*E+2*b+2)}for(E=0;E<_;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=_;E<2*_;E++)v[E]=0;return new o(v,0)};function x(y,_){for(;(y[_]&65535)!=y[_];)y[_+1]+=y[_]>>>16,y[_]&=65535,_++}function T(y,_){this.g=y,this.h=_}function P(y,_){if(k(_))throw Error("division by zero");if(k(y))return new T(f,f);if(S(y))return _=P(C(y),_),new T(C(_.g),C(_.h));if(S(_))return _=P(y,C(_)),new T(C(_.g),_.h);if(30<y.g.length){if(S(y)||S(_))throw Error("slowDivide_ only works with positive integers.");for(var v=p,E=_;0>=E.l(y);)v=M(v),E=M(E);var b=V(v,1),N=V(E,1);for(E=V(E,2),v=V(v,2);!k(E);){var R=N.add(E);0>=R.l(y)&&(b=b.add(v),N=R),E=V(E,1),v=V(v,1)}return _=A(y,b.j(_)),new T(b,_)}for(b=f;0<=y.l(_);){for(v=Math.max(1,Math.floor(y.m()/_.m())),E=Math.ceil(Math.log(v)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),N=c(v),R=N.j(_);S(R)||0<R.l(y);)v-=E,N=c(v),R=N.j(_);k(N)&&(N=p),b=b.add(N),y=A(y,R)}return new T(b,y)}n.A=function(y){return P(this,y).h},n.and=function(y){for(var _=Math.max(this.g.length,y.g.length),v=[],E=0;E<_;E++)v[E]=this.i(E)&y.i(E);return new o(v,this.h&y.h)},n.or=function(y){for(var _=Math.max(this.g.length,y.g.length),v=[],E=0;E<_;E++)v[E]=this.i(E)|y.i(E);return new o(v,this.h|y.h)},n.xor=function(y){for(var _=Math.max(this.g.length,y.g.length),v=[],E=0;E<_;E++)v[E]=this.i(E)^y.i(E);return new o(v,this.h^y.h)};function M(y){for(var _=y.g.length+1,v=[],E=0;E<_;E++)v[E]=y.i(E)<<1|y.i(E-1)>>>31;return new o(v,y.h)}function V(y,_){var v=_>>5;_%=32;for(var E=y.g.length-v,b=[],N=0;N<E;N++)b[N]=0<_?y.i(N+v)>>>_|y.i(N+v+1)<<32-_:y.i(N+v);return new o(b,y.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,jI=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,Rs=o}).apply(typeof H0<"u"?H0:typeof self<"u"?self:typeof window<"u"?window:{});var au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var FI,Jo,UI,Mu,mm,$I,BI,zI;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,d,m){return l==Array.prototype||l==Object.prototype||(l[d]=m.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof au=="object"&&au];for(var d=0;d<l.length;++d){var m=l[d];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function s(l,d){if(d)e:{var m=r;l=l.split(".");for(var I=0;I<l.length-1;I++){var D=l[I];if(!(D in m))break e;m=m[D]}l=l[l.length-1],I=m[l],d=d(I),d!=I&&d!=null&&e(m,l,{configurable:!0,writable:!0,value:d})}}function i(l,d){l instanceof String&&(l+="");var m=0,I=!1,D={next:function(){if(!I&&m<l.length){var j=m++;return{value:d(j,l[j]),done:!1}}return I=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}s("Array.prototype.values",function(l){return l||function(){return i(this,function(d,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function u(l){var d=typeof l;return d=d!="object"?d:l?Array.isArray(l)?"array":d:"null",d=="array"||d=="object"&&typeof l.length=="number"}function c(l){var d=typeof l;return d=="object"&&l!=null||d=="function"}function h(l,d,m){return l.call.apply(l.bind,arguments)}function f(l,d,m){if(!l)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var D=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(D,I),l.apply(d,D)}}return function(){return l.apply(d,arguments)}}function p(l,d,m){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function w(l,d){var m=Array.prototype.slice.call(arguments,1);return function(){var I=m.slice();return I.push.apply(I,arguments),l.apply(this,I)}}function k(l,d){function m(){}m.prototype=d.prototype,l.aa=d.prototype,l.prototype=new m,l.prototype.constructor=l,l.Qb=function(I,D,j){for(var q=Array(arguments.length-2),Ie=2;Ie<arguments.length;Ie++)q[Ie-2]=arguments[Ie];return d.prototype[D].apply(I,q)}}function S(l){const d=l.length;if(0<d){const m=Array(d);for(let I=0;I<d;I++)m[I]=l[I];return m}return[]}function C(l,d){for(let m=1;m<arguments.length;m++){const I=arguments[m];if(u(I)){const D=l.length||0,j=I.length||0;l.length=D+j;for(let q=0;q<j;q++)l[D+q]=I[q]}else l.push(I)}}class A{constructor(d,m){this.i=d,this.j=m,this.h=0,this.g=null}get(){let d;return 0<this.h?(this.h--,d=this.g,this.g=d.next,d.next=null):d=this.i(),d}}function x(l){return/^[\s\xa0]*$/.test(l)}function T(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function P(l){return P[" "](l),l}P[" "]=function(){};var M=T().indexOf("Gecko")!=-1&&!(T().toLowerCase().indexOf("webkit")!=-1&&T().indexOf("Edge")==-1)&&!(T().indexOf("Trident")!=-1||T().indexOf("MSIE")!=-1)&&T().indexOf("Edge")==-1;function V(l,d,m){for(const I in l)d.call(m,l[I],I,l)}function y(l,d){for(const m in l)d.call(void 0,l[m],m,l)}function _(l){const d={};for(const m in l)d[m]=l[m];return d}const v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(l,d){let m,I;for(let D=1;D<arguments.length;D++){I=arguments[D];for(m in I)l[m]=I[m];for(let j=0;j<v.length;j++)m=v[j],Object.prototype.hasOwnProperty.call(I,m)&&(l[m]=I[m])}}function b(l){var d=1;l=l.split(":");const m=[];for(;0<d&&l.length;)m.push(l.shift()),d--;return l.length&&m.push(l.join(":")),m}function N(l){a.setTimeout(()=>{throw l},0)}function R(){var l=ne;let d=null;return l.g&&(d=l.g,l.g=l.g.next,l.g||(l.h=null),d.next=null),d}class Ae{constructor(){this.h=this.g=null}add(d,m){const I=ot.get();I.set(d,m),this.h?this.h.next=I:this.g=I,this.h=I}}var ot=new A(()=>new tt,l=>l.reset());class tt{constructor(){this.next=this.g=this.h=null}set(d,m){this.h=d,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let J,U=!1,ne=new Ae,se=()=>{const l=a.Promise.resolve(void 0);J=()=>{l.then(Ee)}};var Ee=()=>{for(var l;l=R();){try{l.h.call(l.g)}catch(m){N(m)}var d=ot;d.j(l),100>d.h&&(d.h++,l.next=d.g,d.g=l)}U=!1};function ae(){this.s=this.s,this.C=this.C}ae.prototype.s=!1,ae.prototype.ma=function(){this.s||(this.s=!0,this.N())},ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ge(l,d){this.type=l,this.g=this.target=d,this.defaultPrevented=!1}ge.prototype.h=function(){this.defaultPrevented=!0};var Re=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,d=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const m=()=>{};a.addEventListener("test",m,d),a.removeEventListener("test",m,d)}catch{}return l}();function _t(l,d){if(ge.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var m=this.type=l.type,I=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=d,d=l.relatedTarget){if(M){e:{try{P(d.nodeName);var D=!0;break e}catch{}D=!1}D||(d=null)}}else m=="mouseover"?d=l.fromElement:m=="mouseout"&&(d=l.toElement);this.relatedTarget=d,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:yt[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&_t.aa.h.call(this)}}k(_t,ge);var yt={2:"touch",3:"pen",4:"mouse"};_t.prototype.h=function(){_t.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var $n="closure_listenable_"+(1e6*Math.random()|0),vk=0;function wk(l,d,m,I,D){this.listener=l,this.proxy=null,this.src=d,this.type=m,this.capture=!!I,this.ha=D,this.key=++vk,this.da=this.fa=!1}function bl(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Sl(l){this.src=l,this.g={},this.h=0}Sl.prototype.add=function(l,d,m,I,D){var j=l.toString();l=this.g[j],l||(l=this.g[j]=[],this.h++);var q=Zd(l,d,I,D);return-1<q?(d=l[q],m||(d.fa=!1)):(d=new wk(d,this.src,j,!!I,D),d.fa=m,l.push(d)),d};function Yd(l,d){var m=d.type;if(m in l.g){var I=l.g[m],D=Array.prototype.indexOf.call(I,d,void 0),j;(j=0<=D)&&Array.prototype.splice.call(I,D,1),j&&(bl(d),l.g[m].length==0&&(delete l.g[m],l.h--))}}function Zd(l,d,m,I){for(var D=0;D<l.length;++D){var j=l[D];if(!j.da&&j.listener==d&&j.capture==!!m&&j.ha==I)return D}return-1}var eh="closure_lm_"+(1e6*Math.random()|0),th={};function f_(l,d,m,I,D){if(Array.isArray(d)){for(var j=0;j<d.length;j++)f_(l,d[j],m,I,D);return null}return m=g_(m),l&&l[$n]?l.K(d,m,c(I)?!!I.capture:!1,D):xk(l,d,m,!1,I,D)}function xk(l,d,m,I,D,j){if(!d)throw Error("Invalid event type");var q=c(D)?!!D.capture:!!D,Ie=rh(l);if(Ie||(l[eh]=Ie=new Sl(l)),m=Ie.add(d,m,I,q,j),m.proxy)return m;if(I=Ek(),m.proxy=I,I.src=l,I.listener=m,l.addEventListener)Re||(D=q),D===void 0&&(D=!1),l.addEventListener(d.toString(),I,D);else if(l.attachEvent)l.attachEvent(p_(d.toString()),I);else if(l.addListener&&l.removeListener)l.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Ek(){function l(m){return d.call(l.src,l.listener,m)}const d=Ik;return l}function m_(l,d,m,I,D){if(Array.isArray(d))for(var j=0;j<d.length;j++)m_(l,d[j],m,I,D);else I=c(I)?!!I.capture:!!I,m=g_(m),l&&l[$n]?(l=l.i,d=String(d).toString(),d in l.g&&(j=l.g[d],m=Zd(j,m,I,D),-1<m&&(bl(j[m]),Array.prototype.splice.call(j,m,1),j.length==0&&(delete l.g[d],l.h--)))):l&&(l=rh(l))&&(d=l.g[d.toString()],l=-1,d&&(l=Zd(d,m,I,D)),(m=-1<l?d[l]:null)&&nh(m))}function nh(l){if(typeof l!="number"&&l&&!l.da){var d=l.src;if(d&&d[$n])Yd(d.i,l);else{var m=l.type,I=l.proxy;d.removeEventListener?d.removeEventListener(m,I,l.capture):d.detachEvent?d.detachEvent(p_(m),I):d.addListener&&d.removeListener&&d.removeListener(I),(m=rh(d))?(Yd(m,l),m.h==0&&(m.src=null,d[eh]=null)):bl(l)}}}function p_(l){return l in th?th[l]:th[l]="on"+l}function Ik(l,d){if(l.da)l=!0;else{d=new _t(d,this);var m=l.listener,I=l.ha||l.src;l.fa&&nh(l),l=m.call(I,d)}return l}function rh(l){return l=l[eh],l instanceof Sl?l:null}var sh="__closure_events_fn_"+(1e9*Math.random()>>>0);function g_(l){return typeof l=="function"?l:(l[sh]||(l[sh]=function(d){return l.handleEvent(d)}),l[sh])}function vt(){ae.call(this),this.i=new Sl(this),this.M=this,this.F=null}k(vt,ae),vt.prototype[$n]=!0,vt.prototype.removeEventListener=function(l,d,m,I){m_(this,l,d,m,I)};function Pt(l,d){var m,I=l.F;if(I)for(m=[];I;I=I.F)m.push(I);if(l=l.M,I=d.type||d,typeof d=="string")d=new ge(d,l);else if(d instanceof ge)d.target=d.target||l;else{var D=d;d=new ge(I,l),E(d,D)}if(D=!0,m)for(var j=m.length-1;0<=j;j--){var q=d.g=m[j];D=kl(q,I,!0,d)&&D}if(q=d.g=l,D=kl(q,I,!0,d)&&D,D=kl(q,I,!1,d)&&D,m)for(j=0;j<m.length;j++)q=d.g=m[j],D=kl(q,I,!1,d)&&D}vt.prototype.N=function(){if(vt.aa.N.call(this),this.i){var l=this.i,d;for(d in l.g){for(var m=l.g[d],I=0;I<m.length;I++)bl(m[I]);delete l.g[d],l.h--}}this.F=null},vt.prototype.K=function(l,d,m,I){return this.i.add(String(l),d,!1,m,I)},vt.prototype.L=function(l,d,m,I){return this.i.add(String(l),d,!0,m,I)};function kl(l,d,m,I){if(d=l.i.g[String(d)],!d)return!0;d=d.concat();for(var D=!0,j=0;j<d.length;++j){var q=d[j];if(q&&!q.da&&q.capture==m){var Ie=q.listener,at=q.ha||q.src;q.fa&&Yd(l.i,q),D=Ie.call(at,I)!==!1&&D}}return D&&!I.defaultPrevented}function __(l,d,m){if(typeof l=="function")m&&(l=p(l,m));else if(l&&typeof l.handleEvent=="function")l=p(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(d)?-1:a.setTimeout(l,d||0)}function y_(l){l.g=__(()=>{l.g=null,l.i&&(l.i=!1,y_(l))},l.l);const d=l.h;l.h=null,l.m.apply(null,d)}class Tk extends ae{constructor(d,m){super(),this.m=d,this.l=m,this.h=null,this.i=!1,this.g=null}j(d){this.h=arguments,this.g?this.i=!0:y_(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function vo(l){ae.call(this),this.h=l,this.g={}}k(vo,ae);var v_=[];function w_(l){V(l.g,function(d,m){this.g.hasOwnProperty(m)&&nh(d)},l),l.g={}}vo.prototype.N=function(){vo.aa.N.call(this),w_(this)},vo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ih=a.JSON.stringify,bk=a.JSON.parse,Sk=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function oh(){}oh.prototype.h=null;function x_(l){return l.h||(l.h=l.i())}function E_(){}var wo={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ah(){ge.call(this,"d")}k(ah,ge);function lh(){ge.call(this,"c")}k(lh,ge);var as={},I_=null;function Al(){return I_=I_||new vt}as.La="serverreachability";function T_(l){ge.call(this,as.La,l)}k(T_,ge);function xo(l){const d=Al();Pt(d,new T_(d))}as.STAT_EVENT="statevent";function b_(l,d){ge.call(this,as.STAT_EVENT,l),this.stat=d}k(b_,ge);function Ct(l){const d=Al();Pt(d,new b_(d,l))}as.Ma="timingevent";function S_(l,d){ge.call(this,as.Ma,l),this.size=d}k(S_,ge);function Eo(l,d){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},d)}function Io(){this.g=!0}Io.prototype.xa=function(){this.g=!1};function kk(l,d,m,I,D,j){l.info(function(){if(l.g)if(j)for(var q="",Ie=j.split("&"),at=0;at<Ie.length;at++){var _e=Ie[at].split("=");if(1<_e.length){var wt=_e[0];_e=_e[1];var xt=wt.split("_");q=2<=xt.length&&xt[1]=="type"?q+(wt+"="+_e+"&"):q+(wt+"=redacted&")}}else q=null;else q=j;return"XMLHTTP REQ ("+I+") [attempt "+D+"]: "+d+`
`+m+`
`+q})}function Ak(l,d,m,I,D,j,q){l.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+D+"]: "+d+`
`+m+`
`+j+" "+q})}function Ys(l,d,m,I){l.info(function(){return"XMLHTTP TEXT ("+d+"): "+Pk(l,m)+(I?" "+I:"")})}function Rk(l,d){l.info(function(){return"TIMEOUT: "+d})}Io.prototype.info=function(){};function Pk(l,d){if(!l.g)return d;if(!d)return null;try{var m=JSON.parse(d);if(m){for(l=0;l<m.length;l++)if(Array.isArray(m[l])){var I=m[l];if(!(2>I.length)){var D=I[1];if(Array.isArray(D)&&!(1>D.length)){var j=D[0];if(j!="noop"&&j!="stop"&&j!="close")for(var q=1;q<D.length;q++)D[q]=""}}}}return ih(m)}catch{return d}}var Rl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},k_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},uh;function Pl(){}k(Pl,oh),Pl.prototype.g=function(){return new XMLHttpRequest},Pl.prototype.i=function(){return{}},uh=new Pl;function fr(l,d,m,I){this.j=l,this.i=d,this.l=m,this.R=I||1,this.U=new vo(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new A_}function A_(){this.i=null,this.g="",this.h=!1}var R_={},ch={};function dh(l,d,m){l.L=1,l.v=Vl(Bn(d)),l.m=m,l.P=!0,P_(l,null)}function P_(l,d){l.F=Date.now(),Cl(l),l.A=Bn(l.v);var m=l.A,I=l.R;Array.isArray(I)||(I=[String(I)]),q_(m.i,"t",I),l.C=0,m=l.j.J,l.h=new A_,l.g=ly(l.j,m?d:null,!l.m),0<l.O&&(l.M=new Tk(p(l.Y,l,l.g),l.O)),d=l.U,m=l.g,I=l.ca;var D="readystatechange";Array.isArray(D)||(D&&(v_[0]=D.toString()),D=v_);for(var j=0;j<D.length;j++){var q=f_(m,D[j],I||d.handleEvent,!1,d.h||d);if(!q)break;d.g[q.key]=q}d=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),d["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,d)):(l.u="GET",l.g.ea(l.A,l.u,null,d)),xo(),kk(l.i,l.u,l.A,l.l,l.R,l.m)}fr.prototype.ca=function(l){l=l.target;const d=this.M;d&&zn(l)==3?d.j():this.Y(l)},fr.prototype.Y=function(l){try{if(l==this.g)e:{const xt=zn(this.g);var d=this.g.Ba();const ti=this.g.Z();if(!(3>xt)&&(xt!=3||this.g&&(this.h.h||this.g.oa()||X_(this.g)))){this.J||xt!=4||d==7||(d==8||0>=ti?xo(3):xo(2)),hh(this);var m=this.g.Z();this.X=m;t:if(C_(this)){var I=X_(this.g);l="";var D=I.length,j=zn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ls(this),To(this);var q="";break t}this.h.i=new a.TextDecoder}for(d=0;d<D;d++)this.h.h=!0,l+=this.h.i.decode(I[d],{stream:!(j&&d==D-1)});I.length=0,this.h.g+=l,this.C=0,q=this.h.g}else q=this.g.oa();if(this.o=m==200,Ak(this.i,this.u,this.A,this.l,this.R,xt,m),this.o){if(this.T&&!this.K){t:{if(this.g){var Ie,at=this.g;if((Ie=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(Ie)){var _e=Ie;break t}}_e=null}if(m=_e)Ys(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fh(this,m);else{this.o=!1,this.s=3,Ct(12),ls(this),To(this);break e}}if(this.P){m=!0;let _n;for(;!this.J&&this.C<q.length;)if(_n=Ck(this,q),_n==ch){xt==4&&(this.s=4,Ct(14),m=!1),Ys(this.i,this.l,null,"[Incomplete Response]");break}else if(_n==R_){this.s=4,Ct(15),Ys(this.i,this.l,q,"[Invalid Chunk]"),m=!1;break}else Ys(this.i,this.l,_n,null),fh(this,_n);if(C_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),xt!=4||q.length!=0||this.h.h||(this.s=1,Ct(16),m=!1),this.o=this.o&&m,!m)Ys(this.i,this.l,q,"[Invalid Chunked Response]"),ls(this),To(this);else if(0<q.length&&!this.W){this.W=!0;var wt=this.j;wt.g==this&&wt.ba&&!wt.M&&(wt.j.info("Great, no buffering proxy detected. Bytes received: "+q.length),vh(wt),wt.M=!0,Ct(11))}}else Ys(this.i,this.l,q,null),fh(this,q);xt==4&&ls(this),this.o&&!this.J&&(xt==4?sy(this.j,this):(this.o=!1,Cl(this)))}else Hk(this.g),m==400&&0<q.indexOf("Unknown SID")?(this.s=3,Ct(12)):(this.s=0,Ct(13)),ls(this),To(this)}}}catch{}finally{}};function C_(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function Ck(l,d){var m=l.C,I=d.indexOf(`
`,m);return I==-1?ch:(m=Number(d.substring(m,I)),isNaN(m)?R_:(I+=1,I+m>d.length?ch:(d=d.slice(I,I+m),l.C=I+m,d)))}fr.prototype.cancel=function(){this.J=!0,ls(this)};function Cl(l){l.S=Date.now()+l.I,N_(l,l.I)}function N_(l,d){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Eo(p(l.ba,l),d)}function hh(l){l.B&&(a.clearTimeout(l.B),l.B=null)}fr.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(Rk(this.i,this.A),this.L!=2&&(xo(),Ct(17)),ls(this),this.s=2,To(this)):N_(this,this.S-l)};function To(l){l.j.G==0||l.J||sy(l.j,l)}function ls(l){hh(l);var d=l.M;d&&typeof d.ma=="function"&&d.ma(),l.M=null,w_(l.U),l.g&&(d=l.g,l.g=null,d.abort(),d.ma())}function fh(l,d){try{var m=l.j;if(m.G!=0&&(m.g==l||mh(m.h,l))){if(!l.K&&mh(m.h,l)&&m.G==3){try{var I=m.Da.g.parse(d)}catch{I=null}if(Array.isArray(I)&&I.length==3){var D=I;if(D[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<l.F)Ul(m),jl(m);else break e;yh(m),Ct(18)}}else m.za=D[1],0<m.za-m.T&&37500>D[2]&&m.F&&m.v==0&&!m.C&&(m.C=Eo(p(m.Za,m),6e3));if(1>=O_(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else cs(m,11)}else if((l.K||m.g==l)&&Ul(m),!x(d))for(D=m.Da.g.parse(d),d=0;d<D.length;d++){let _e=D[d];if(m.T=_e[0],_e=_e[1],m.G==2)if(_e[0]=="c"){m.K=_e[1],m.ia=_e[2];const wt=_e[3];wt!=null&&(m.la=wt,m.j.info("VER="+m.la));const xt=_e[4];xt!=null&&(m.Aa=xt,m.j.info("SVER="+m.Aa));const ti=_e[5];ti!=null&&typeof ti=="number"&&0<ti&&(I=1.5*ti,m.L=I,m.j.info("backChannelRequestTimeoutMs_="+I)),I=m;const _n=l.g;if(_n){const Bl=_n.g?_n.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Bl){var j=I.h;j.g||Bl.indexOf("spdy")==-1&&Bl.indexOf("quic")==-1&&Bl.indexOf("h2")==-1||(j.j=j.l,j.g=new Set,j.h&&(ph(j,j.h),j.h=null))}if(I.D){const wh=_n.g?_n.g.getResponseHeader("X-HTTP-Session-Id"):null;wh&&(I.ya=wh,be(I.I,I.D,wh))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-l.F,m.j.info("Handshake RTT: "+m.R+"ms")),I=m;var q=l;if(I.qa=ay(I,I.J?I.ia:null,I.W),q.K){M_(I.h,q);var Ie=q,at=I.L;at&&(Ie.I=at),Ie.B&&(hh(Ie),Cl(Ie)),I.g=q}else ny(I);0<m.i.length&&Fl(m)}else _e[0]!="stop"&&_e[0]!="close"||cs(m,7);else m.G==3&&(_e[0]=="stop"||_e[0]=="close"?_e[0]=="stop"?cs(m,7):_h(m):_e[0]!="noop"&&m.l&&m.l.ta(_e),m.v=0)}}xo(4)}catch{}}var Nk=class{constructor(l,d){this.g=l,this.map=d}};function D_(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function V_(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function O_(l){return l.h?1:l.g?l.g.size:0}function mh(l,d){return l.h?l.h==d:l.g?l.g.has(d):!1}function ph(l,d){l.g?l.g.add(d):l.h=d}function M_(l,d){l.h&&l.h==d?l.h=null:l.g&&l.g.has(d)&&l.g.delete(d)}D_.prototype.cancel=function(){if(this.i=L_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function L_(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let d=l.i;for(const m of l.g.values())d=d.concat(m.D);return d}return S(l.i)}function Dk(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var d=[],m=l.length,I=0;I<m;I++)d.push(l[I]);return d}d=[],m=0;for(I in l)d[m++]=l[I];return d}function Vk(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var d=[];l=l.length;for(var m=0;m<l;m++)d.push(m);return d}d=[],m=0;for(const I in l)d[m++]=I;return d}}}function j_(l,d){if(l.forEach&&typeof l.forEach=="function")l.forEach(d,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,d,void 0);else for(var m=Vk(l),I=Dk(l),D=I.length,j=0;j<D;j++)d.call(void 0,I[j],m&&m[j],l)}var F_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ok(l,d){if(l){l=l.split("&");for(var m=0;m<l.length;m++){var I=l[m].indexOf("="),D=null;if(0<=I){var j=l[m].substring(0,I);D=l[m].substring(I+1)}else j=l[m];d(j,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function us(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof us){this.h=l.h,Nl(this,l.j),this.o=l.o,this.g=l.g,Dl(this,l.s),this.l=l.l;var d=l.i,m=new ko;m.i=d.i,d.g&&(m.g=new Map(d.g),m.h=d.h),U_(this,m),this.m=l.m}else l&&(d=String(l).match(F_))?(this.h=!1,Nl(this,d[1]||"",!0),this.o=bo(d[2]||""),this.g=bo(d[3]||"",!0),Dl(this,d[4]),this.l=bo(d[5]||"",!0),U_(this,d[6]||"",!0),this.m=bo(d[7]||"")):(this.h=!1,this.i=new ko(null,this.h))}us.prototype.toString=function(){var l=[],d=this.j;d&&l.push(So(d,$_,!0),":");var m=this.g;return(m||d=="file")&&(l.push("//"),(d=this.o)&&l.push(So(d,$_,!0),"@"),l.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&l.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&l.push("/"),l.push(So(m,m.charAt(0)=="/"?jk:Lk,!0))),(m=this.i.toString())&&l.push("?",m),(m=this.m)&&l.push("#",So(m,Uk)),l.join("")};function Bn(l){return new us(l)}function Nl(l,d,m){l.j=m?bo(d,!0):d,l.j&&(l.j=l.j.replace(/:$/,""))}function Dl(l,d){if(d){if(d=Number(d),isNaN(d)||0>d)throw Error("Bad port number "+d);l.s=d}else l.s=null}function U_(l,d,m){d instanceof ko?(l.i=d,$k(l.i,l.h)):(m||(d=So(d,Fk)),l.i=new ko(d,l.h))}function be(l,d,m){l.i.set(d,m)}function Vl(l){return be(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function bo(l,d){return l?d?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function So(l,d,m){return typeof l=="string"?(l=encodeURI(l).replace(d,Mk),m&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function Mk(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var $_=/[#\/\?@]/g,Lk=/[#\?:]/g,jk=/[#\?]/g,Fk=/[#\?@]/g,Uk=/#/g;function ko(l,d){this.h=this.g=null,this.i=l||null,this.j=!!d}function mr(l){l.g||(l.g=new Map,l.h=0,l.i&&Ok(l.i,function(d,m){l.add(decodeURIComponent(d.replace(/\+/g," ")),m)}))}n=ko.prototype,n.add=function(l,d){mr(this),this.i=null,l=Zs(this,l);var m=this.g.get(l);return m||this.g.set(l,m=[]),m.push(d),this.h+=1,this};function B_(l,d){mr(l),d=Zs(l,d),l.g.has(d)&&(l.i=null,l.h-=l.g.get(d).length,l.g.delete(d))}function z_(l,d){return mr(l),d=Zs(l,d),l.g.has(d)}n.forEach=function(l,d){mr(this),this.g.forEach(function(m,I){m.forEach(function(D){l.call(d,D,I,this)},this)},this)},n.na=function(){mr(this);const l=Array.from(this.g.values()),d=Array.from(this.g.keys()),m=[];for(let I=0;I<d.length;I++){const D=l[I];for(let j=0;j<D.length;j++)m.push(d[I])}return m},n.V=function(l){mr(this);let d=[];if(typeof l=="string")z_(this,l)&&(d=d.concat(this.g.get(Zs(this,l))));else{l=Array.from(this.g.values());for(let m=0;m<l.length;m++)d=d.concat(l[m])}return d},n.set=function(l,d){return mr(this),this.i=null,l=Zs(this,l),z_(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[d]),this.h+=1,this},n.get=function(l,d){return l?(l=this.V(l),0<l.length?String(l[0]):d):d};function q_(l,d,m){B_(l,d),0<m.length&&(l.i=null,l.g.set(Zs(l,d),S(m)),l.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],d=Array.from(this.g.keys());for(var m=0;m<d.length;m++){var I=d[m];const j=encodeURIComponent(String(I)),q=this.V(I);for(I=0;I<q.length;I++){var D=j;q[I]!==""&&(D+="="+encodeURIComponent(String(q[I]))),l.push(D)}}return this.i=l.join("&")};function Zs(l,d){return d=String(d),l.j&&(d=d.toLowerCase()),d}function $k(l,d){d&&!l.j&&(mr(l),l.i=null,l.g.forEach(function(m,I){var D=I.toLowerCase();I!=D&&(B_(this,I),q_(this,D,m))},l)),l.j=d}function Bk(l,d){const m=new Io;if(a.Image){const I=new Image;I.onload=w(pr,m,"TestLoadImage: loaded",!0,d,I),I.onerror=w(pr,m,"TestLoadImage: error",!1,d,I),I.onabort=w(pr,m,"TestLoadImage: abort",!1,d,I),I.ontimeout=w(pr,m,"TestLoadImage: timeout",!1,d,I),a.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=l}else d(!1)}function zk(l,d){const m=new Io,I=new AbortController,D=setTimeout(()=>{I.abort(),pr(m,"TestPingServer: timeout",!1,d)},1e4);fetch(l,{signal:I.signal}).then(j=>{clearTimeout(D),j.ok?pr(m,"TestPingServer: ok",!0,d):pr(m,"TestPingServer: server error",!1,d)}).catch(()=>{clearTimeout(D),pr(m,"TestPingServer: error",!1,d)})}function pr(l,d,m,I,D){try{D&&(D.onload=null,D.onerror=null,D.onabort=null,D.ontimeout=null),I(m)}catch{}}function qk(){this.g=new Sk}function Wk(l,d,m){const I=m||"";try{j_(l,function(D,j){let q=D;c(D)&&(q=ih(D)),d.push(I+j+"="+encodeURIComponent(q))})}catch(D){throw d.push(I+"type="+encodeURIComponent("_badmap")),D}}function Ol(l){this.l=l.Ub||null,this.j=l.eb||!1}k(Ol,oh),Ol.prototype.g=function(){return new Ml(this.l,this.j)},Ol.prototype.i=function(l){return function(){return l}}({});function Ml(l,d){vt.call(this),this.D=l,this.o=d,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Ml,vt),n=Ml.prototype,n.open=function(l,d){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=d,this.readyState=1,Ro(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const d={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(d.body=l),(this.D||a).fetch(new Request(this.A,d)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ao(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Ro(this)),this.g&&(this.readyState=3,Ro(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;W_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function W_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var d=l.value?l.value:new Uint8Array(0);(d=this.v.decode(d,{stream:!l.done}))&&(this.response=this.responseText+=d)}l.done?Ao(this):Ro(this),this.readyState==3&&W_(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,Ao(this))},n.Qa=function(l){this.g&&(this.response=l,Ao(this))},n.ga=function(){this.g&&Ao(this)};function Ao(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Ro(l)}n.setRequestHeader=function(l,d){this.u.append(l,d)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],d=this.h.entries();for(var m=d.next();!m.done;)m=m.value,l.push(m[0]+": "+m[1]),m=d.next();return l.join(`\r
`)};function Ro(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Ml.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function K_(l){let d="";return V(l,function(m,I){d+=I,d+=":",d+=m,d+=`\r
`}),d}function gh(l,d,m){e:{for(I in m){var I=!1;break e}I=!0}I||(m=K_(m),typeof l=="string"?m!=null&&encodeURIComponent(String(m)):be(l,d,m))}function Fe(l){vt.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(Fe,vt);var Kk=/^https?$/i,Gk=["POST","PUT"];n=Fe.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,d,m,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);d=d?d.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():uh.g(),this.v=this.o?x_(this.o):x_(uh),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(d,String(l),!0),this.B=!1}catch(j){G_(this,j);return}if(l=m||"",m=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var D in I)m.set(D,I[D]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(const j of I.keys())m.set(j,I.get(j));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(m.keys()).find(j=>j.toLowerCase()=="content-type"),D=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Gk,d,void 0))||I||D||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[j,q]of m)this.g.setRequestHeader(j,q);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{J_(this),this.u=!0,this.g.send(l),this.u=!1}catch(j){G_(this,j)}};function G_(l,d){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=d,l.m=5,H_(l),Ll(l)}function H_(l){l.A||(l.A=!0,Pt(l,"complete"),Pt(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Pt(this,"complete"),Pt(this,"abort"),Ll(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ll(this,!0)),Fe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Q_(this):this.bb())},n.bb=function(){Q_(this)};function Q_(l){if(l.h&&typeof o<"u"&&(!l.v[1]||zn(l)!=4||l.Z()!=2)){if(l.u&&zn(l)==4)__(l.Ea,0,l);else if(Pt(l,"readystatechange"),zn(l)==4){l.h=!1;try{const q=l.Z();e:switch(q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var d=!0;break e;default:d=!1}var m;if(!(m=d)){var I;if(I=q===0){var D=String(l.D).match(F_)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),I=!Kk.test(D?D.toLowerCase():"")}m=I}if(m)Pt(l,"complete"),Pt(l,"success");else{l.m=6;try{var j=2<zn(l)?l.g.statusText:""}catch{j=""}l.l=j+" ["+l.Z()+"]",H_(l)}}finally{Ll(l)}}}}function Ll(l,d){if(l.g){J_(l);const m=l.g,I=l.v[0]?()=>{}:null;l.g=null,l.v=null,d||Pt(l,"ready");try{m.onreadystatechange=I}catch{}}}function J_(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function zn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<zn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var d=this.g.responseText;return l&&d.indexOf(l)==0&&(d=d.substring(l.length)),bk(d)}};function X_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function Hk(l){const d={};l=(l.g&&2<=zn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<l.length;I++){if(x(l[I]))continue;var m=b(l[I]);const D=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const j=d[D]||[];d[D]=j,j.push(m)}y(d,function(I){return I.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Po(l,d,m){return m&&m.internalChannelParams&&m.internalChannelParams[l]||d}function Y_(l){this.Aa=0,this.i=[],this.j=new Io,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Po("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Po("baseRetryDelayMs",5e3,l),this.cb=Po("retryDelaySeedMs",1e4,l),this.Wa=Po("forwardChannelMaxRetries",2,l),this.wa=Po("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new D_(l&&l.concurrentRequestLimit),this.Da=new qk,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Y_.prototype,n.la=8,n.G=1,n.connect=function(l,d,m,I){Ct(0),this.W=l,this.H=d||{},m&&I!==void 0&&(this.H.OSID=m,this.H.OAID=I),this.F=this.X,this.I=ay(this,null,this.W),Fl(this)};function _h(l){if(Z_(l),l.G==3){var d=l.U++,m=Bn(l.I);if(be(m,"SID",l.K),be(m,"RID",d),be(m,"TYPE","terminate"),Co(l,m),d=new fr(l,l.j,d),d.L=2,d.v=Vl(Bn(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(d.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=d.v,m=!0),m||(d.g=ly(d.j,null),d.g.ea(d.v)),d.F=Date.now(),Cl(d)}oy(l)}function jl(l){l.g&&(vh(l),l.g.cancel(),l.g=null)}function Z_(l){jl(l),l.u&&(a.clearTimeout(l.u),l.u=null),Ul(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Fl(l){if(!V_(l.h)&&!l.s){l.s=!0;var d=l.Ga;J||se(),U||(J(),U=!0),ne.add(d,l),l.B=0}}function Qk(l,d){return O_(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=d.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Eo(p(l.Ga,l,d),iy(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const D=new fr(this,this.j,l);let j=this.o;if(this.S&&(j?(j=_(j),E(j,this.S)):j=this.S),this.m!==null||this.O||(D.H=j,j=null),this.P)e:{for(var d=0,m=0;m<this.i.length;m++){t:{var I=this.i[m];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(d+=I,4096<d){d=m;break e}if(d===4096||m===this.i.length-1){d=m+1;break e}}d=1e3}else d=1e3;d=ty(this,D,d),m=Bn(this.I),be(m,"RID",l),be(m,"CVER",22),this.D&&be(m,"X-HTTP-Session-Id",this.D),Co(this,m),j&&(this.O?d="headers="+encodeURIComponent(String(K_(j)))+"&"+d:this.m&&gh(m,this.m,j)),ph(this.h,D),this.Ua&&be(m,"TYPE","init"),this.P?(be(m,"$req",d),be(m,"SID","null"),D.T=!0,dh(D,m,null)):dh(D,m,d),this.G=2}}else this.G==3&&(l?ey(this,l):this.i.length==0||V_(this.h)||ey(this))};function ey(l,d){var m;d?m=d.l:m=l.U++;const I=Bn(l.I);be(I,"SID",l.K),be(I,"RID",m),be(I,"AID",l.T),Co(l,I),l.m&&l.o&&gh(I,l.m,l.o),m=new fr(l,l.j,m,l.B+1),l.m===null&&(m.H=l.o),d&&(l.i=d.D.concat(l.i)),d=ty(l,m,1e3),m.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),ph(l.h,m),dh(m,I,d)}function Co(l,d){l.H&&V(l.H,function(m,I){be(d,I,m)}),l.l&&j_({},function(m,I){be(d,I,m)})}function ty(l,d,m){m=Math.min(l.i.length,m);var I=l.l?p(l.l.Na,l.l,l):null;e:{var D=l.i;let j=-1;for(;;){const q=["count="+m];j==-1?0<m?(j=D[0].g,q.push("ofs="+j)):j=0:q.push("ofs="+j);let Ie=!0;for(let at=0;at<m;at++){let _e=D[at].g;const wt=D[at].map;if(_e-=j,0>_e)j=Math.max(0,D[at].g-100),Ie=!1;else try{Wk(wt,q,"req"+_e+"_")}catch{I&&I(wt)}}if(Ie){I=q.join("&");break e}}}return l=l.i.splice(0,m),d.D=l,I}function ny(l){if(!l.g&&!l.u){l.Y=1;var d=l.Fa;J||se(),U||(J(),U=!0),ne.add(d,l),l.v=0}}function yh(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Eo(p(l.Fa,l),iy(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,ry(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Eo(p(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ct(10),jl(this),ry(this))};function vh(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function ry(l){l.g=new fr(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var d=Bn(l.qa);be(d,"RID","rpc"),be(d,"SID",l.K),be(d,"AID",l.T),be(d,"CI",l.F?"0":"1"),!l.F&&l.ja&&be(d,"TO",l.ja),be(d,"TYPE","xmlhttp"),Co(l,d),l.m&&l.o&&gh(d,l.m,l.o),l.L&&(l.g.I=l.L);var m=l.g;l=l.ia,m.L=1,m.v=Vl(Bn(d)),m.m=null,m.P=!0,P_(m,l)}n.Za=function(){this.C!=null&&(this.C=null,jl(this),yh(this),Ct(19))};function Ul(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function sy(l,d){var m=null;if(l.g==d){Ul(l),vh(l),l.g=null;var I=2}else if(mh(l.h,d))m=d.D,M_(l.h,d),I=1;else return;if(l.G!=0){if(d.o)if(I==1){m=d.m?d.m.length:0,d=Date.now()-d.F;var D=l.B;I=Al(),Pt(I,new S_(I,m)),Fl(l)}else ny(l);else if(D=d.s,D==3||D==0&&0<d.X||!(I==1&&Qk(l,d)||I==2&&yh(l)))switch(m&&0<m.length&&(d=l.h,d.i=d.i.concat(m)),D){case 1:cs(l,5);break;case 4:cs(l,10);break;case 3:cs(l,6);break;default:cs(l,2)}}}function iy(l,d){let m=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(m*=2),m*d}function cs(l,d){if(l.j.info("Error code "+d),d==2){var m=p(l.fb,l),I=l.Xa;const D=!I;I=new us(I||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Nl(I,"https"),Vl(I),D?Bk(I.toString(),m):zk(I.toString(),m)}else Ct(2);l.G=0,l.l&&l.l.sa(d),oy(l),Z_(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),Ct(2)):(this.j.info("Failed to ping google.com"),Ct(1))};function oy(l){if(l.G=0,l.ka=[],l.l){const d=L_(l.h);(d.length!=0||l.i.length!=0)&&(C(l.ka,d),C(l.ka,l.i),l.h.i.length=0,S(l.i),l.i.length=0),l.l.ra()}}function ay(l,d,m){var I=m instanceof us?Bn(m):new us(m);if(I.g!="")d&&(I.g=d+"."+I.g),Dl(I,I.s);else{var D=a.location;I=D.protocol,d=d?d+"."+D.hostname:D.hostname,D=+D.port;var j=new us(null);I&&Nl(j,I),d&&(j.g=d),D&&Dl(j,D),m&&(j.l=m),I=j}return m=l.D,d=l.ya,m&&d&&be(I,m,d),be(I,"VER",l.la),Co(l,I),I}function ly(l,d,m){if(d&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return d=l.Ca&&!l.pa?new Fe(new Ol({eb:m})):new Fe(l.pa),d.Ha(l.J),d}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function uy(){}n=uy.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $l(){}$l.prototype.g=function(l,d){return new Qt(l,d)};function Qt(l,d){vt.call(this),this.g=new Y_(d),this.l=l,this.h=d&&d.messageUrlParams||null,l=d&&d.messageHeaders||null,d&&d.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=d&&d.initMessageHeaders||null,d&&d.messageContentType&&(l?l["X-WebChannel-Content-Type"]=d.messageContentType:l={"X-WebChannel-Content-Type":d.messageContentType}),d&&d.va&&(l?l["X-WebChannel-Client-Profile"]=d.va:l={"X-WebChannel-Client-Profile":d.va}),this.g.S=l,(l=d&&d.Sb)&&!x(l)&&(this.g.m=l),this.v=d&&d.supportsCrossDomainXhr||!1,this.u=d&&d.sendRawJson||!1,(d=d&&d.httpSessionIdParam)&&!x(d)&&(this.g.D=d,l=this.h,l!==null&&d in l&&(l=this.h,d in l&&delete l[d])),this.j=new ei(this)}k(Qt,vt),Qt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Qt.prototype.close=function(){_h(this.g)},Qt.prototype.o=function(l){var d=this.g;if(typeof l=="string"){var m={};m.__data__=l,l=m}else this.u&&(m={},m.__data__=ih(l),l=m);d.i.push(new Nk(d.Ya++,l)),d.G==3&&Fl(d)},Qt.prototype.N=function(){this.g.l=null,delete this.j,_h(this.g),delete this.g,Qt.aa.N.call(this)};function cy(l){ah.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var d=l.__sm__;if(d){e:{for(const m in d){l=m;break e}l=void 0}(this.i=l)&&(l=this.i,d=d!==null&&l in d?d[l]:void 0),this.data=d}else this.data=l}k(cy,ah);function dy(){lh.call(this),this.status=1}k(dy,lh);function ei(l){this.g=l}k(ei,uy),ei.prototype.ua=function(){Pt(this.g,"a")},ei.prototype.ta=function(l){Pt(this.g,new cy(l))},ei.prototype.sa=function(l){Pt(this.g,new dy)},ei.prototype.ra=function(){Pt(this.g,"b")},$l.prototype.createWebChannel=$l.prototype.g,Qt.prototype.send=Qt.prototype.o,Qt.prototype.open=Qt.prototype.m,Qt.prototype.close=Qt.prototype.close,zI=function(){return new $l},BI=function(){return Al()},$I=as,mm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Rl.NO_ERROR=0,Rl.TIMEOUT=8,Rl.HTTP_ERROR=6,Mu=Rl,k_.COMPLETE="complete",UI=k_,E_.EventType=wo,wo.OPEN="a",wo.CLOSE="b",wo.ERROR="c",wo.MESSAGE="d",vt.prototype.listen=vt.prototype.K,Jo=E_,Fe.prototype.listenOnce=Fe.prototype.L,Fe.prototype.getLastError=Fe.prototype.Ka,Fe.prototype.getLastErrorCode=Fe.prototype.Ba,Fe.prototype.getStatus=Fe.prototype.Z,Fe.prototype.getResponseJson=Fe.prototype.Oa,Fe.prototype.getResponseText=Fe.prototype.oa,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Ha,FI=Fe}).apply(typeof au<"u"?au:typeof self<"u"?self:typeof window<"u"?window:{});const Q0="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}dt.UNAUTHENTICATED=new dt(null),dt.GOOGLE_CREDENTIALS=new dt("google-credentials-uid"),dt.FIRST_PARTY=new dt("first-party-uid"),dt.MOCK_USER=new dt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ho="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js=new qp("@firebase/firestore");function ci(){return js.logLevel}function B(n,...e){if(js.logLevel<=he.DEBUG){const t=e.map(tg);js.debug(`Firestore (${ho}): ${n}`,...t)}}function Vt(n,...e){if(js.logLevel<=he.ERROR){const t=e.map(tg);js.error(`Firestore (${ho}): ${n}`,...t)}}function Fs(n,...e){if(js.logLevel<=he.WARN){const t=e.map(tg);js.warn(`Firestore (${ho}): ${n}`,...t)}}function tg(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X(n="Unexpected state"){const e=`FIRESTORE (${ho}) INTERNAL ASSERTION FAILED: `+n;throw Vt(e),new Error(e)}function Y(n,e){n||X()}function oe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class K extends dr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class eD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(dt.UNAUTHENTICATED))}shutdown(){}}class tD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class nD{constructor(e){this.t=e,this.currentUser=dt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Y(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new jn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new jn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},a=u=>{B("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?a(u):(B("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new jn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(B("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Y(typeof r.accessToken=="string"),new qI(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string"),new dt(e)}}class rD{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=dt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class sD{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new rD(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(dt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class iD{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class oD{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Y(this.o===void 0);const r=i=>{i.error!=null&&B("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,B("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{B("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):B("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Y(typeof t.token=="string"),this.R=t.token,new iD(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aD(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=aD(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function le(n,e){return n<e?-1:n>e?1:0}function Ji(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function KI(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new K(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new K(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new K(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new K(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Le.fromMillis(Date.now())}static fromDate(e){return Le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Le(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?le(this.nanoseconds,e.nanoseconds):le(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new te(e)}static min(){return new te(new Le(0,0))}static max(){return new te(new Le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(e,t,r){t===void 0?t=0:t>e.length&&X(),r===void 0?r=e.length-t:r>e.length-t&&X(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ga.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ga?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ye extends Ga{construct(e,t,r){return new ye(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new K(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ye(t)}static emptyPath(){return new ye([])}}const lD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Oe extends Ga{construct(e,t,r){return new Oe(e,t,r)}static isValidIdentifier(e){return lD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Oe.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Oe(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new K(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new K(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new K(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new K(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Oe(t)}static emptyPath(){return new Oe([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(e){this.path=e}static fromPath(e){return new G(ye.fromString(e))}static fromName(e){return new G(ye.fromString(e).popFirst(5))}static empty(){return new G(ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new G(new ye(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function pm(n){return n.fields.find(e=>e.kind===2)}function ps(n){return n.fields.filter(e=>e.kind!==2)}Nc.UNKNOWN_ID=-1;class Lu{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ha{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ha(0,sn.min())}}function uD(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=te.fromTimestamp(r===1e9?new Le(t+1,0):new Le(t,r));return new sn(s,G.empty(),e)}function GI(n){return new sn(n.readTime,n.key,-1)}class sn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new sn(te.min(),G.empty(),-1)}static max(){return new sn(te.max(),G.empty(),-1)}}function ng(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=G.comparator(n.documentKey,e.documentKey),t!==0?t:le(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class QI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qs(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==HI)throw n;B("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wd{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new jn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new wa(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=rg(r.target.error);this.V.reject(new wa(e,s))}}static open(e,t,r,s){try{return new wd(t,e.transaction(s,r))}catch(i){throw new wa(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(B("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new dD(t)}}class Kr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Kr.S(Ze())===12.2&&Vt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return B("SimpleDb","Removing database:",e),_s(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!YE())return!1;if(Kr.v())return!0;const e=Ze(),t=Kr.S(e),r=0<t&&t<10,s=JI(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(B("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new wa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new K(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new K(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new wa(e,o))},s.onupgradeneeded=i=>{B("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{B("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=wd.open(this.db,e,i?"readonly":"readwrite",r),u=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),O.reject(c))).toPromise();return u.catch(()=>{}),await a.m,u}catch(a){const u=a,c=u.name!=="FirebaseError"&&o<3;if(B("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}function JI(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class cD{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return _s(this.B.delete())}}class wa extends K{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ss(n){return n.name==="IndexedDbTransactionError"}class dD{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(B("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(B("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),_s(r)}add(e){return B("SimpleDb","ADD",this.store.name,e,e),_s(this.store.add(e))}get(e){return _s(this.store.get(e)).next(t=>(t===void 0&&(t=null),B("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return B("SimpleDb","DELETE",this.store.name,e),_s(this.store.delete(e))}count(){return B("SimpleDb","COUNT",this.store.name),_s(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((o,a)=>{i.onerror=u=>{a(u.target.error)},i.onsuccess=u=>{o(u.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){B("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const o=rg(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new O((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new cD(a),c=t(a.primaryKey,a.value,u);if(c instanceof O){const h=c.catch(f=>(u.done(),O.reject(f)));r.push(h)}u.isDone?s():u.K===null?a.continue():a.continue(u.K)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function _s(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=rg(r.target.error);t(s)}})}let J0=!1;function rg(n){const e=Kr.S(Ze());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new K("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return J0||(J0=!0,setTimeout(()=>{throw r},0)),r}}return n}class hD{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){B("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{B("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){ss(t)?B("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Qs(t)}await this.X(6e4)})}}class fD{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return B("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(B("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=GI(i);ng(o,r)>0&&(r=o)}),new sn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}dn.oe=-1;function xd(n){return n==null}function Qa(n){return n===0&&1/n==-1/0}function mD(n){return typeof n=="number"&&Number.isInteger(n)&&!Qa(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=X0(e)),e=pD(n.get(t),e);return X0(e)}function pD(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function X0(n){return n+""}function Cn(n){const e=n.length;if(Y(e>=2),e===2)return Y(n.charAt(0)===""&&n.charAt(1)===""),ye.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&X(),n.charAt(o+1)){case"":const a=n.substring(i,o);let u;s.length===0?u=a:(s+=a,u=s,s=""),r.push(u);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:X()}i=o+2}return new ye(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y0=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ju(n,e){return[n,Mt(e)]}function XI(n,e,t){return[n,Mt(e),t]}const gD={},_D=["prefixPath","collectionGroup","readTime","documentId"],yD=["prefixPath","collectionGroup","documentId"],vD=["collectionGroup","readTime","prefixPath","documentId"],wD=["canonicalId","targetId"],xD=["targetId","path"],ED=["path","targetId"],ID=["collectionId","parent"],TD=["indexId","uid"],bD=["uid","sequenceNumber"],SD=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],kD=["indexId","uid","orderedDocumentKey"],AD=["userId","collectionPath","documentId"],RD=["userId","collectionPath","largestBatchId"],PD=["userId","collectionGroup","largestBatchId"],YI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],CD=[...YI,"documentOverlays"],ZI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],eT=ZI,sg=[...eT,"indexConfiguration","indexState","indexEntries"],ND=sg,DD=[...sg,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm extends QI{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function et(n,e){const t=oe(n);return Kr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z0(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Js(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function tT(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ne{constructor(e,t){this.comparator=e,this.root=t||ht.EMPTY}insert(e,t){return new Ne(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ht.BLACK,null,null))}remove(e){return new Ne(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ht.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new lu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new lu(this.root,e,this.comparator,!1)}getReverseIterator(){return new lu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new lu(this.root,e,this.comparator,!0)}}class lu{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ht{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??ht.RED,this.left=s??ht.EMPTY,this.right=i??ht.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ht(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ht.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return ht.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ht.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ht.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw X();const e=this.left.check();if(e!==this.right.check())throw X();return e+(this.isRed()?0:1)}}ht.EMPTY=null,ht.RED=!0,ht.BLACK=!1;ht.EMPTY=new class{constructor(){this.size=0}get key(){throw X()}get value(){throw X()}get color(){throw X()}get left(){throw X()}get right(){throw X()}copy(e,t,r,s,i){return this}insert(e,t,r){return new ht(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{constructor(e){this.comparator=e,this.data=new Ne(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ev(this.data.getIterator())}getIteratorFrom(e){return new ev(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof xe)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new xe(this.comparator);return t.data=e,t}}class ev{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ri(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.fields=e,e.sort(Oe.comparator)}static empty(){return new Wt([])}unionWith(e){let t=new xe(Oe.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Wt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ji(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new nT("Invalid base64 string: "+i):i}}(e);return new Ke(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Ke(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return le(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ke.EMPTY_BYTE_STRING=new Ke("");const VD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ur(n){if(Y(!!n),typeof n=="string"){let e=0;const t=VD.exec(n);if(Y(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Pe(n.seconds),nanos:Pe(n.nanos)}}function Pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Yr(n){return typeof n=="string"?Ke.fromBase64String(n):Ke.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ig(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function og(n){const e=n.mapValue.fields.__previous_value__;return ig(e)?og(e):e}function Ja(n){const e=ur(n.mapValue.fields.__local_write_time__.timestampValue);return new Le(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t,r,s,i,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class Us{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Us("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Us&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Fu={nullValue:"NULL_VALUE"};function $s(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ig(n)?4:rT(n)?9007199254740991:Ed(n)?10:11:X()}function Fn(n,e){if(n===e)return!0;const t=$s(n);if(t!==$s(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ja(n).isEqual(Ja(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ur(s.timestampValue),a=ur(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Yr(s.bytesValue).isEqual(Yr(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Pe(s.geoPointValue.latitude)===Pe(i.geoPointValue.latitude)&&Pe(s.geoPointValue.longitude)===Pe(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Pe(s.integerValue)===Pe(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Pe(s.doubleValue),a=Pe(i.doubleValue);return o===a?Qa(o)===Qa(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ji(n.arrayValue.values||[],e.arrayValue.values||[],Fn);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Z0(o)!==Z0(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Fn(o[u],a[u])))return!1;return!0}(n,e);default:return X()}}function Xa(n,e){return(n.values||[]).find(t=>Fn(t,e))!==void 0}function Zr(n,e){if(n===e)return 0;const t=$s(n),r=$s(e);if(t!==r)return le(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return le(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Pe(i.integerValue||i.doubleValue),u=Pe(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return tv(n.timestampValue,e.timestampValue);case 4:return tv(Ja(n),Ja(e));case 5:return le(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Yr(i),u=Yr(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const h=le(a[c],u[c]);if(h!==0)return h}return le(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=le(Pe(i.latitude),Pe(o.latitude));return a!==0?a:le(Pe(i.longitude),Pe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return nv(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,u,c,h;const f=i.fields||{},p=o.fields||{},w=(a=f.value)===null||a===void 0?void 0:a.arrayValue,k=(u=p.value)===null||u===void 0?void 0:u.arrayValue,S=le(((c=w==null?void 0:w.values)===null||c===void 0?void 0:c.length)||0,((h=k==null?void 0:k.values)===null||h===void 0?void 0:h.length)||0);return S!==0?S:nv(w,k)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Dr.mapValue&&o===Dr.mapValue)return 0;if(i===Dr.mapValue)return 1;if(o===Dr.mapValue)return-1;const a=i.fields||{},u=Object.keys(a),c=o.fields||{},h=Object.keys(c);u.sort(),h.sort();for(let f=0;f<u.length&&f<h.length;++f){const p=le(u[f],h[f]);if(p!==0)return p;const w=Zr(a[u[f]],c[h[f]]);if(w!==0)return w}return le(u.length,h.length)}(n.mapValue,e.mapValue);default:throw X()}}function tv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return le(n,e);const t=ur(n),r=ur(e),s=le(t.seconds,r.seconds);return s!==0?s:le(t.nanos,r.nanos)}function nv(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Zr(t[s],r[s]);if(i)return i}return le(t.length,r.length)}function Xi(n){return _m(n)}function _m(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ur(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Yr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return G.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=_m(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${_m(t.fields[o])}`;return s+"}"}(n.mapValue):X()}function Ya(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ym(n){return!!n&&"integerValue"in n}function Za(n){return!!n&&"arrayValue"in n}function rv(n){return!!n&&"nullValue"in n}function sv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Uu(n){return!!n&&"mapValue"in n}function Ed(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function xa(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Js(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=xa(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xa(n.arrayValue.values[t]);return e}return Object.assign({},n)}function rT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const sT={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function MD(n){return"nullValue"in n?Fu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ya(Us.empty(),G.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Ed(n)?sT:{mapValue:{}}:X()}function LD(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ya(Us.empty(),G.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?sT:"mapValue"in n?Ed(n)?{mapValue:{}}:Dr:X()}function iv(n,e){const t=Zr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ov(n,e){const t=Zr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e){this.value=e}static empty(){return new St({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Uu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xa(t)}setAll(e){let t=Oe.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=xa(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Uu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Fn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Uu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Js(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new St(xa(this.value))}}function iT(n){const e=[];return Js(n.fields,(t,r)=>{const s=new Oe([t]);if(Uu(r)){const i=iT(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Wt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new $e(e,0,te.min(),te.min(),te.min(),St.empty(),0)}static newFoundDocument(e,t,r,s){return new $e(e,1,t,te.min(),r,s,0)}static newNoDocument(e,t){return new $e(e,2,t,te.min(),te.min(),St.empty(),0)}static newUnknownDocument(e,t){return new $e(e,3,t,te.min(),te.min(),St.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=St.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=St.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $e&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,t){this.position=e,this.inclusive=t}}function av(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=G.comparator(G.fromName(o.referenceValue),t.key):r=Zr(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function lv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Fn(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e,t="asc"){this.field=e,this.dir=t}}function jD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{}class fe extends oT{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new FD(e,t,r):t==="array-contains"?new BD(e,r):t==="in"?new hT(e,r):t==="not-in"?new zD(e,r):t==="array-contains-any"?new qD(e,r):new fe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new UD(e,r):new $D(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Zr(t,this.value)):t!==null&&$s(this.value)===$s(t)&&this.matchesComparison(Zr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return X()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ve extends oT{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ve(e,t)}matches(e){return Zi(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Zi(n){return n.op==="and"}function vm(n){return n.op==="or"}function ag(n){return aT(n)&&Zi(n)}function aT(n){for(const e of n.filters)if(e instanceof ve)return!1;return!0}function wm(n){if(n instanceof fe)return n.field.canonicalString()+n.op.toString()+Xi(n.value);if(ag(n))return n.filters.map(e=>wm(e)).join(",");{const e=n.filters.map(t=>wm(t)).join(",");return`${n.op}(${e})`}}function lT(n,e){return n instanceof fe?function(r,s){return s instanceof fe&&r.op===s.op&&r.field.isEqual(s.field)&&Fn(r.value,s.value)}(n,e):n instanceof ve?function(r,s){return s instanceof ve&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&lT(o,s.filters[a]),!0):!1}(n,e):void X()}function uT(n,e){const t=n.filters.concat(e);return ve.create(t,n.op)}function cT(n){return n instanceof fe?function(t){return`${t.field.canonicalString()} ${t.op} ${Xi(t.value)}`}(n):n instanceof ve?function(t){return t.op.toString()+" {"+t.getFilters().map(cT).join(" ,")+"}"}(n):"Filter"}class FD extends fe{constructor(e,t,r){super(e,t,r),this.key=G.fromName(r.referenceValue)}matches(e){const t=G.comparator(e.key,this.key);return this.matchesComparison(t)}}class UD extends fe{constructor(e,t){super(e,"in",t),this.keys=dT("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class $D extends fe{constructor(e,t){super(e,"not-in",t),this.keys=dT("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function dT(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>G.fromName(r.referenceValue))}class BD extends fe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Za(t)&&Xa(t.arrayValue,this.value)}}class hT extends fe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Xa(this.value.arrayValue,t)}}class zD extends fe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Xa(this.value.arrayValue,t)}}class qD extends fe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Za(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Xa(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function xm(n,e=null,t=[],r=[],s=null,i=null,o=null){return new WD(n,e,t,r,s,i,o)}function Bs(n){const e=oe(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>wm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),xd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Xi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Xi(r)).join(",")),e.ue=t}return e.ue}function ml(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!jD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!lT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!lv(n.startAt,e.startAt)&&lv(n.endAt,e.endAt)}function Dc(n){return G.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Vc(n,e){return n.filters.filter(t=>t instanceof fe&&t.field.isEqual(e))}function uv(n,e,t){let r=Fu,s=!0;for(const i of Vc(n,e)){let o=Fu,a=!0;switch(i.op){case"<":case"<=":o=MD(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Fu}iv({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];iv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function cv(n,e,t){let r=Dr,s=!0;for(const i of Vc(n,e)){let o=Dr,a=!0;switch(i.op){case">=":case">":o=LD(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Dr}ov({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];ov({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fo{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function KD(n,e,t,r,s,i,o,a){return new fo(n,e,t,r,s,i,o,a)}function pl(n){return new fo(n)}function dv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function fT(n){return n.collectionGroup!==null}function Ea(n){const e=oe(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new xe(Oe.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new el(i,r))}),t.has(Oe.keyField().canonicalString())||e.ce.push(new el(Oe.keyField(),r))}return e.ce}function mn(n){const e=oe(n);return e.le||(e.le=GD(e,Ea(n))),e.le}function GD(n,e){if(n.limitType==="F")return xm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new el(s.field,i)});const t=n.endAt?new Yi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Yi(n.startAt.position,n.startAt.inclusive):null;return xm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Em(n,e){const t=n.filters.concat([e]);return new fo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Im(n,e,t){return new fo(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Id(n,e){return ml(mn(n),mn(e))&&n.limitType===e.limitType}function mT(n){return`${Bs(mn(n))}|lt:${n.limitType}`}function di(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>cT(s)).join(", ")}]`),xd(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Xi(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Xi(s)).join(",")),`Target(${r})`}(mn(n))}; limitType=${n.limitType})`}function gl(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):G.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Ea(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,u){const c=av(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Ea(r),s)||r.endAt&&!function(o,a,u){const c=av(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Ea(r),s))}(n,e)}function HD(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function pT(n){return(e,t)=>{let r=!1;for(const s of Ea(n)){const i=QD(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function QD(n,e,t){const r=n.field.isKeyField()?G.comparator(e.key,t.key):function(i,o,a){const u=o.data.field(i),c=a.data.field(i);return u!==null&&c!==null?Zr(u,c):X()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return X()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Js(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return tT(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD=new Ne(G.comparator);function tn(){return JD}const gT=new Ne(G.comparator);function Xo(...n){let e=gT;for(const t of n)e=e.insert(t.key,t);return e}function _T(n){let e=gT;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Nn(){return Ia()}function yT(){return Ia()}function Ia(){return new is(n=>n.toString(),(n,e)=>n.isEqual(e))}const XD=new Ne(G.comparator),YD=new xe(G.comparator);function ce(...n){let e=YD;for(const t of n)e=e.add(t);return e}const ZD=new xe(le);function e2(){return ZD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qa(e)?"-0":e}}function vT(n){return{integerValue:""+n}}function t2(n,e){return mD(e)?vT(e):lg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td{constructor(){this._=void 0}}function n2(n,e,t){return n instanceof eo?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&ig(i)&&(i=og(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof to?xT(n,e):n instanceof no?ET(n,e):function(s,i){const o=wT(s,i),a=hv(o)+hv(s.Pe);return ym(o)&&ym(s.Pe)?vT(a):lg(s.serializer,a)}(n,e)}function r2(n,e,t){return n instanceof to?xT(n,e):n instanceof no?ET(n,e):t}function wT(n,e){return n instanceof tl?function(r){return ym(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class eo extends Td{}class to extends Td{constructor(e){super(),this.elements=e}}function xT(n,e){const t=IT(e);for(const r of n.elements)t.some(s=>Fn(s,r))||t.push(r);return{arrayValue:{values:t}}}class no extends Td{constructor(e){super(),this.elements=e}}function ET(n,e){let t=IT(e);for(const r of n.elements)t=t.filter(s=>!Fn(s,r));return{arrayValue:{values:t}}}class tl extends Td{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function hv(n){return Pe(n.integerValue||n.doubleValue)}function IT(n){return Za(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{constructor(e,t){this.field=e,this.transform=t}}function s2(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof to&&s instanceof to||r instanceof no&&s instanceof no?Ji(r.elements,s.elements,Fn):r instanceof tl&&s instanceof tl?Fn(r.Pe,s.Pe):r instanceof eo&&s instanceof eo}(n.transform,e.transform)}class i2{constructor(e,t){this.version=e,this.transformResults=t}}class kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new kt}static exists(e){return new kt(void 0,e)}static updateTime(e){return new kt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $u(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class bd{}function bT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Sd(n.key,kt.none()):new mo(n.key,n.data,kt.none());{const t=n.data,r=St.empty();let s=new xe(Oe.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new hr(n.key,r,new Wt(s.toArray()),kt.none())}}function o2(n,e,t){n instanceof mo?function(s,i,o){const a=s.value.clone(),u=mv(s.fieldTransforms,i,o.transformResults);a.setAll(u),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof hr?function(s,i,o){if(!$u(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=mv(s.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(ST(s)),u.setAll(a),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ta(n,e,t,r){return n instanceof mo?function(i,o,a,u){if(!$u(i.precondition,o))return a;const c=i.value.clone(),h=pv(i.fieldTransforms,u,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof hr?function(i,o,a,u){if(!$u(i.precondition,o))return a;const c=pv(i.fieldTransforms,u,o),h=o.data;return h.setAll(ST(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return $u(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function a2(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=wT(r.transform,s||null);i!=null&&(t===null&&(t=St.empty()),t.set(r.field,i))}return t||null}function fv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ji(r,s,(i,o)=>s2(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class mo extends bd{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class hr extends bd{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ST(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function mv(n,e,t){const r=new Map;Y(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,r2(o,a,t[s]))}return r}function pv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,n2(i,o,e))}return r}class Sd extends bd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class kT extends bd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&o2(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ta(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ta(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=yT();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const u=bT(o,a);u!==null&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ce())}isEqual(e){return this.batchId===e.batchId&&Ji(this.mutations,e.mutations,(t,r)=>fv(t,r))&&Ji(this.baseMutations,e.baseMutations,(t,r)=>fv(t,r))}}class cg{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Y(e.mutations.length===r.length);let s=function(){return XD}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new cg(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l2{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qe,me;function u2(n){switch(n){default:return X();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}function AT(n){if(n===void 0)return Vt("GRPC error has no .code"),F.UNKNOWN;switch(n){case qe.OK:return F.OK;case qe.CANCELLED:return F.CANCELLED;case qe.UNKNOWN:return F.UNKNOWN;case qe.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case qe.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case qe.INTERNAL:return F.INTERNAL;case qe.UNAVAILABLE:return F.UNAVAILABLE;case qe.UNAUTHENTICATED:return F.UNAUTHENTICATED;case qe.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case qe.NOT_FOUND:return F.NOT_FOUND;case qe.ALREADY_EXISTS:return F.ALREADY_EXISTS;case qe.PERMISSION_DENIED:return F.PERMISSION_DENIED;case qe.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case qe.ABORTED:return F.ABORTED;case qe.OUT_OF_RANGE:return F.OUT_OF_RANGE;case qe.UNIMPLEMENTED:return F.UNIMPLEMENTED;case qe.DATA_LOSS:return F.DATA_LOSS;default:return X()}}(me=qe||(qe={}))[me.OK=0]="OK",me[me.CANCELLED=1]="CANCELLED",me[me.UNKNOWN=2]="UNKNOWN",me[me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",me[me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",me[me.NOT_FOUND=5]="NOT_FOUND",me[me.ALREADY_EXISTS=6]="ALREADY_EXISTS",me[me.PERMISSION_DENIED=7]="PERMISSION_DENIED",me[me.UNAUTHENTICATED=16]="UNAUTHENTICATED",me[me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",me[me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",me[me.ABORTED=10]="ABORTED",me[me.OUT_OF_RANGE=11]="OUT_OF_RANGE",me[me.UNIMPLEMENTED=12]="UNIMPLEMENTED",me[me.INTERNAL=13]="INTERNAL",me[me.UNAVAILABLE=14]="UNAVAILABLE",me[me.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c2(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d2=new Rs([4294967295,4294967295],0);function gv(n){const e=c2().encode(n),t=new jI;return t.update(e),new Uint8Array(t.digest())}function _v(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Rs([t,r],0),new Rs([s,i],0)]}class hg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Yo(`Invalid padding: ${t}`);if(r<0)throw new Yo(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Yo(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Yo(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Rs.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Rs.fromNumber(r)));return s.compare(d2)===1&&(s=new Rs([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=gv(e),[r,s]=_v(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new hg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=gv(e),[r,s]=_v(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Yo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,_l.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new kd(te.min(),s,new Ne(le),tn(),ce())}}class _l{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new _l(r,t,ce(),ce(),ce())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bu{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class RT{constructor(e,t){this.targetId=e,this.me=t}}class PT{constructor(e,t,r=Ke.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class yv{constructor(){this.fe=0,this.ge=wv(),this.pe=Ke.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ce(),t=ce(),r=ce();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:X()}}),new _l(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=wv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Y(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class h2{constructor(e){this.Le=e,this.Be=new Map,this.ke=tn(),this.qe=vv(),this.Qe=new Ne(le)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:X()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Dc(i))if(r===0){const o=new G(i.path);this.Ue(t,o,$e.newNoDocument(o,te.min()))}else Y(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);const c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Yr(r).toUint8Array()}catch(u){if(u instanceof nT)return Fs("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new hg(o,s,i)}catch(u){return Fs(u instanceof Yo?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&Dc(a.target)){const u=new G(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,$e.newNoDocument(u,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=ce();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new kd(e,t,this.Qe,this.ke,r);return this.ke=tn(),this.qe=vv(),this.Qe=new Ne(le),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new yv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new xe(le),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||B("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new yv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function vv(){return new Ne(G.comparator)}function wv(){return new Ne(G.comparator)}const f2={asc:"ASCENDING",desc:"DESCENDING"},m2={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},p2={and:"AND",or:"OR"};class g2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Tm(n,e){return n.useProto3Json||xd(e)?e:{value:e}}function ro(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function CT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function _2(n,e){return ro(n,e.toTimestamp())}function Lt(n){return Y(!!n),te.fromTimestamp(function(t){const r=ur(t);return new Le(r.seconds,r.nanos)}(n))}function fg(n,e){return bm(n,e).canonicalString()}function bm(n,e){const t=function(s){return new ye(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function NT(n){const e=ye.fromString(n);return Y($T(e)),e}function Oc(n,e){return fg(n.databaseId,e.path)}function Ps(n,e){const t=NT(e);if(t.get(1)!==n.databaseId.projectId)throw new K(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new K(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new G(OT(t))}function DT(n,e){return fg(n.databaseId,e)}function VT(n){const e=NT(n);return e.length===4?ye.emptyPath():OT(e)}function Sm(n){return new ye(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function OT(n){return Y(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function xv(n,e,t){return{name:Oc(n,e),fields:t.value.mapValue.fields}}function y2(n,e,t){const r=Ps(n,e.name),s=Lt(e.updateTime),i=e.createTime?Lt(e.createTime):te.min(),o=new St({mapValue:{fields:e.fields}}),a=$e.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function v2(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:X()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Y(h===void 0||typeof h=="string"),Ke.fromBase64String(h||"")):(Y(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Ke.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?F.UNKNOWN:AT(c.code);return new K(h,c.message||"")}(o);t=new PT(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ps(n,r.document.name),i=Lt(r.document.updateTime),o=r.document.createTime?Lt(r.document.createTime):te.min(),a=new St({mapValue:{fields:r.document.fields}}),u=$e.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new Bu(c,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ps(n,r.document),i=r.readTime?Lt(r.readTime):te.min(),o=$e.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Bu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ps(n,r.document),i=r.removedTargetIds||[];t=new Bu([],i,s,null)}else{if(!("filter"in e))return X();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new l2(s,i),a=r.targetId;t=new RT(a,o)}}return t}function Mc(n,e){let t;if(e instanceof mo)t={update:xv(n,e.key,e.value)};else if(e instanceof Sd)t={delete:Oc(n,e.key)};else if(e instanceof hr)t={update:xv(n,e.key,e.data),updateMask:b2(e.fieldMask)};else{if(!(e instanceof kT))return X();t={verify:Oc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof eo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof to)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof no)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof tl)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw X()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:_2(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:X()}(n,e.precondition)),t}function km(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?kt.updateTime(Lt(i.updateTime)):i.exists!==void 0?kt.exists(i.exists):kt.none()}(e.currentDocument):kt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let u=null;if("setToServerValue"in a)Y(a.setToServerValue==="REQUEST_TIME"),u=new eo;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];u=new to(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];u=new no(h)}else"increment"in a?u=new tl(o,a.increment):X();const c=Oe.fromServerFormat(a.fieldPath);return new TT(c,u)}(n,s)):[];if(e.update){e.update.name;const s=Ps(n,e.update.name),i=new St({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(u){const c=u.fieldPaths||[];return new Wt(c.map(h=>Oe.fromServerFormat(h)))}(e.updateMask);return new hr(s,i,o,t,r)}return new mo(s,i,t,r)}if(e.delete){const s=Ps(n,e.delete);return new Sd(s,t)}if(e.verify){const s=Ps(n,e.verify);return new kT(s,t)}return X()}function w2(n,e){return n&&n.length>0?(Y(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Lt(s.updateTime):Lt(i);return o.isEqual(te.min())&&(o=Lt(i)),new i2(o,s.transformResults||[])}(t,e))):[]}function MT(n,e){return{documents:[DT(n,e.path)]}}function LT(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=DT(n,s);const i=function(c){if(c.length!==0)return UT(ve.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(p){return{field:hi(p.field),direction:E2(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Tm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function jT(n){let e=VT(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Y(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const p=FT(f);return p instanceof ve&&ag(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(k){return new el(fi(k.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,xd(p)?null:p}(t.limit));let u=null;t.startAt&&(u=function(f){const p=!!f.before,w=f.values||[];return new Yi(w,p)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const p=!f.before,w=f.values||[];return new Yi(w,p)}(t.endAt)),KD(e,s,o,i,a,"F",u,c)}function x2(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return X()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function FT(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=fi(t.unaryFilter.field);return fe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=fi(t.unaryFilter.field);return fe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=fi(t.unaryFilter.field);return fe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=fi(t.unaryFilter.field);return fe.create(o,"!=",{nullValue:"NULL_VALUE"});default:return X()}}(n):n.fieldFilter!==void 0?function(t){return fe.create(fi(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return X()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ve.create(t.compositeFilter.filters.map(r=>FT(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return X()}}(t.compositeFilter.op))}(n):X()}function E2(n){return f2[n]}function I2(n){return m2[n]}function T2(n){return p2[n]}function hi(n){return{fieldPath:n.canonicalString()}}function fi(n){return Oe.fromServerFormat(n.fieldPath)}function UT(n){return n instanceof fe?function(t){if(t.op==="=="){if(sv(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NAN"}};if(rv(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sv(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NOT_NAN"}};if(rv(t.value))return{unaryFilter:{field:hi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hi(t.field),op:I2(t.op),value:t.value}}}(n):n instanceof ve?function(t){const r=t.getFilters().map(s=>UT(s));return r.length===1?r[0]:{compositeFilter:{op:T2(t.op),filters:r}}}(n):X()}function b2(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function $T(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e,t,r,s,i=te.min(),o=te.min(),a=Ke.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new er(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new er(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new er(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new er(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BT{constructor(e){this.ct=e}}function S2(n,e){let t;if(e.document)t=y2(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=G.fromSegments(e.noDocument.path),s=qs(e.noDocument.readTime);t=$e.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return X();{const r=G.fromSegments(e.unknownDocument.path),s=qs(e.unknownDocument.version);t=$e.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Le(s[0],s[1]);return te.fromTimestamp(i)}(e.readTime)),t}function Ev(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Lc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Oc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:ro(i,o.version.toTimestamp()),createTime:ro(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:zs(e.version)};else{if(!e.isUnknownDocument())return X();r.unknownDocument={path:t.path.toArray(),version:zs(e.version)}}return r}function Lc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function zs(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function qs(n){const e=new Le(n.seconds,n.nanoseconds);return te.fromTimestamp(e)}function ys(n,e){const t=(e.baseMutations||[]).map(i=>km(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>km(n.ct,i)),s=Le.fromMillis(e.localWriteTimeMs);return new ug(e.batchId,s,t,r)}function Zo(n){const e=qs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?qs(n.lastLimboFreeSnapshotVersion):te.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Y(i.documents.length===1),mn(pl(VT(i.documents[0])))}(n.query):function(i){return mn(jT(i))}(n.query),new er(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ke.fromBase64String(n.resumeToken))}function zT(n,e){const t=zs(e.snapshotVersion),r=zs(e.lastLimboFreeSnapshotVersion);let s;s=Dc(e.target)?MT(n.ct,e.target):LT(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Bs(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function qT(n){const e=jT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Im(e,e.limit,"L"):e}function ef(n,e){return new dg(e.largestBatchId,km(n.ct,e.overlayMutation))}function Iv(n,e){const t=e.path.lastSegment();return[n,Mt(e.path.popLast()),t]}function Tv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:zs(r.readTime),documentKey:Mt(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2{getBundleMetadata(e,t){return bv(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:qs(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return bv(e).put(function(s){return{bundleId:s.id,createTime:zs(Lt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Sv(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:qT(i.bundledQuery),readTime:qs(i.readTime)}}(r)})}saveNamedQuery(e,t){return Sv(e).put(function(s){return{name:s.name,readTime:zs(Lt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function bv(n){return et(n,"bundles")}function Sv(n){return et(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ad{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Ad(e,r)}getOverlay(e,t){return Uo(e).get(Iv(this.userId,t)).next(r=>r?ef(this.serializer,r):null)}getOverlays(e,t){const r=Nn();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new dg(t,o);s.push(this.ht(e,a))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Mt(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Uo(e).j("collectionPathOverlayIndex",a))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Nn(),i=Mt(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Uo(e).U("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=ef(this.serializer,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Nn();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Uo(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,h)=>{const f=ef(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return Uo(e).put(function(s,i,o){const[a,u,c]=Iv(i,o.mutation.key);return{userId:i,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Mc(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Uo(n){return et(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A2{Pt(e){return et(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Ke.fromUint8Array(r):Ke.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Pe(e.integerValue));else if("doubleValue"in e){const r=Pe(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Qa(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ur(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Yr(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?rT(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Ed(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):X()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Pe(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),G.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}vs.vt=new vs;function R2(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function kv(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=R2(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class P2{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=kv(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=kv(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class C2{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class N2{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class $o{constructor(){this.jt=new P2,this.Ht=new C2(this.jt),this.Jt=new N2(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new ws(this.indexId,this.documentKey,this.arrayValue,r)}}function yr(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Av(n.arrayValue,e.arrayValue),t!==0?t:(t=Av(n.directionalValue,e.directionalValue),t!==0?t:G.comparator(n.documentKey,e.documentKey)))}function Av(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e){this.Xt=new xe((t,r)=>Oe.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Y(e.collectionGroup===this.collectionId),this.nn)return!1;const t=pm(e);if(t!==void 0&&!this.sn(t))return!1;const r=ps(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const u=r[i];if(!this.on(a,u)||!this._n(this.en[o++],u))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new xe(Oe.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Lu(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Lu(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Lu(r.field,r.dir==="asc"?0:1)));return new Nc(Nc.UNKNOWN_ID,this.collectionId,t,Ha.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WT(n){var e,t;if(Y(n instanceof fe||n instanceof ve),n instanceof fe){if(n instanceof hT){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>fe.create(n.field,"==",i)))||[];return ve.create(s,"or")}return n}const r=n.filters.map(s=>WT(s));return ve.create(r,n.op)}function D2(n){if(n.getFilters().length===0)return[];const e=Pm(WT(n));return Y(KT(e)),Am(e)||Rm(e)?[e]:e.getFilters()}function Am(n){return n instanceof fe}function Rm(n){return n instanceof ve&&ag(n)}function KT(n){return Am(n)||Rm(n)||function(t){if(t instanceof ve&&vm(t)){for(const r of t.getFilters())if(!Am(r)&&!Rm(r))return!1;return!0}return!1}(n)}function Pm(n){if(Y(n instanceof fe||n instanceof ve),n instanceof fe)return n;if(n.filters.length===1)return Pm(n.filters[0]);const e=n.filters.map(r=>Pm(r));let t=ve.create(e,n.op);return t=jc(t),KT(t)?t:(Y(t instanceof ve),Y(Zi(t)),Y(t.filters.length>1),t.filters.reduce((r,s)=>mg(r,s)))}function mg(n,e){let t;return Y(n instanceof fe||n instanceof ve),Y(e instanceof fe||e instanceof ve),t=n instanceof fe?e instanceof fe?function(s,i){return ve.create([s,i],"and")}(n,e):Pv(n,e):e instanceof fe?Pv(e,n):function(s,i){if(Y(s.filters.length>0&&i.filters.length>0),Zi(s)&&Zi(i))return uT(s,i.getFilters());const o=vm(s)?s:i,a=vm(s)?i:s,u=o.filters.map(c=>mg(c,a));return ve.create(u,"or")}(n,e),jc(t)}function Pv(n,e){if(Zi(e))return uT(e,n.getFilters());{const t=e.filters.map(r=>mg(n,r));return ve.create(t,"or")}}function jc(n){if(Y(n instanceof fe||n instanceof ve),n instanceof fe)return n;const e=n.getFilters();if(e.length===1)return jc(e[0]);if(aT(n))return n;const t=e.map(s=>jc(s)),r=[];return t.forEach(s=>{s instanceof fe?r.push(s):s instanceof ve&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ve.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{constructor(){this.un=new pg}addToCollectionParentIndex(e,t){return this.un.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(sn.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(sn.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class pg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new xe(ye.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new xe(ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu=new Uint8Array(0);class O2{constructor(e,t){this.databaseId=t,this.cn=new pg,this.ln=new is(r=>Bs(r),(r,s)=>ml(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Mt(s)};return Cv(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[KI(t),""],!1,!0);return Cv(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Cn(o.parent))}return r})}addFieldIndex(e,t){const r=Bo(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=ii(e);return i.next(a=>{o.put(Tv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Bo(e),s=ii(e),i=si(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Bo(e),r=si(e),s=ii(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return O.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Rv(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=si(e);let s=!0;const i=new Map;return O.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=ce();const a=[];return O.forEach(i,(u,c)=>{B("IndexedDbIndexManager",`Using index ${function(T){return`id=${T.indexId}|cg=${T.collectionGroup}|f=${T.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(u)} to execute ${Bs(t)}`);const h=function(T,P){const M=pm(P);if(M===void 0)return null;for(const V of Vc(T,M.fieldPath))switch(V.op){case"array-contains-any":return V.value.arrayValue.values||[];case"array-contains":return[V.value]}return null}(c,u),f=function(T,P){const M=new Map;for(const V of ps(P))for(const y of Vc(T,V.fieldPath))switch(y.op){case"==":case"in":M.set(V.fieldPath.canonicalString(),y.value);break;case"not-in":case"!=":return M.set(V.fieldPath.canonicalString(),y.value),Array.from(M.values())}return null}(c,u),p=function(T,P){const M=[];let V=!0;for(const y of ps(P)){const _=y.kind===0?uv(T,y.fieldPath,T.startAt):cv(T,y.fieldPath,T.startAt);M.push(_.value),V&&(V=_.inclusive)}return new Yi(M,V)}(c,u),w=function(T,P){const M=[];let V=!0;for(const y of ps(P)){const _=y.kind===0?cv(T,y.fieldPath,T.endAt):uv(T,y.fieldPath,T.endAt);M.push(_.value),V&&(V=_.inclusive)}return new Yi(M,V)}(c,u),k=this.In(u,c,p),S=this.In(u,c,w),C=this.Tn(u,c,f),A=this.En(u.indexId,h,k,p.inclusive,S,w.inclusive,C);return O.forEach(A,x=>r.G(x,t.limit).next(T=>{T.forEach(P=>{const M=G.fromSegments(P.documentKey);o.has(M)||(o=o.add(M),a.push(M))})}))}).next(()=>a)}return O.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=D2(ve.create(e.filters,"and")).map(r=>xm(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const u=(t!=null?t.length:1)*Math.max(r.length,i.length),c=u/(t!=null?t.length:1),h=[];for(let f=0;f<u;++f){const p=t?this.dn(t[f/c]):uu,w=this.An(e,p,r[f%c],s),k=this.Rn(e,p,i[f%c],o),S=a.map(C=>this.An(e,p,C,!0));h.push(...this.createRange(w,k,S))}return h}An(e,t,r,s){const i=new ws(e,G.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new ws(e,G.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Rv(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return O.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new xe(Oe.comparator),h=!1;for(const f of u.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:c=c.add(p.field));for(const f of u.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new $o;for(const s of ps(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);vs.vt.It(i,o)}return r.zt()}dn(e){const t=new $o;return vs.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new $o;return vs.vt.It(Ya(this.databaseId,t),r.Yt(function(i){const o=ps(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new $o);let i=0;for(const o of ps(e)){const a=r[i++];for(const u of s)if(this.fn(t,o.fieldPath)&&Za(a))s=this.gn(s,o,a);else{const c=u.Yt(o.kind);vs.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const u=new $o;u.seed(a.zt()),vs.vt.It(o,u.Yt(t.kind)),i.push(u)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof fe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Bo(e),s=ii(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return O.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(h,f){const p=f?new Ha(f.sequenceNumber,new sn(qs(f.readTime),new G(Cn(f.documentKey)),f.largestBatchId)):Ha.empty(),w=h.fields.map(([k,S])=>new Lu(Oe.fromServerFormat(k),S));return new Nc(h.indexId,h.collectionGroup,w,p)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:le(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Bo(e),i=ii(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>O.forEach(a,u=>i.put(Tv(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?O.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),O.forEach(a,u=>this.wn(e,s,u).next(c=>{const h=this.Sn(i,u);return c.isEqual(h)?O.resolve():this.bn(e,i,u,c,h)}))))})}Dn(e,t,r,s){return si(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return si(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=si(e);let i=new xe(yr);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new ws(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new xe(yr);const s=this.Vn(t,e);if(s==null)return r;const i=pm(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Za(o))for(const a of o.arrayValue.values||[])r=r.add(new ws(t.indexId,e.key,this.dn(a),s))}else r=r.add(new ws(t.indexId,e.key,uu,s));return r}bn(e,t,r,s,i){B("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,h,f,p){const w=u.getIterator(),k=c.getIterator();let S=ri(w),C=ri(k);for(;S||C;){let A=!1,x=!1;if(S&&C){const T=h(S,C);T<0?x=!0:T>0&&(A=!0)}else S!=null?x=!0:A=!0;A?(f(C),C=ri(k)):x?(p(S),S=ri(w)):(S=ri(w),C=ri(k))}}(s,i,yr,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),O.waitFor(o)}yn(e){let t=1;return ii(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>yr(o,a)).filter((o,a,u)=>!a||yr(o,u[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=yr(o,e),u=yr(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&u<0)s.push(o),s.push(o.Zt());else if(u>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,uu,[]],u=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,uu,[]];i.push(IDBKeyRange.bound(a,u))}return i}Cn(e,t){return yr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Nv)}getMinOffset(e,t){return O.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||X())).next(Nv)}}function Cv(n){return et(n,"collectionParents")}function si(n){return et(n,"indexEntries")}function Bo(n){return et(n,"indexConfiguration")}function ii(n){return et(n,"indexState")}function Nv(n){Y(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;ng(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new sn(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class $t{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new $t(e,$t.DEFAULT_COLLECTION_PERCENTILE,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GT(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.J({range:o},(h,f,p)=>(a++,p.delete()));i.push(u.next(()=>{Y(a===1)}));const c=[];for(const h of t.mutations){const f=XI(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return O.waitFor(i).next(()=>c)}function Fc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw X();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$t.DEFAULT_COLLECTION_PERCENTILE=10,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$t.DEFAULT=new $t(41943040,$t.DEFAULT_COLLECTION_PERCENTILE,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$t.DISABLED=new $t(-1,0,0);class Rd{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Y(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Rd(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vr(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=mi(e),o=vr(e);return o.add({}).next(a=>{Y(typeof a=="number");const u=new ug(a,t,r,s),c=function(w,k,S){const C=S.baseMutations.map(x=>Mc(w.ct,x)),A=S.mutations.map(x=>Mc(w.ct,x));return{userId:k,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:C,mutations:A}}(this.serializer,this.userId,u),h=[];let f=new xe((p,w)=>le(p.canonicalString(),w.canonicalString()));for(const p of s){const w=XI(this.userId,p.key.path,a);f=f.add(p.key.path.popLast()),h.push(o.put(c)),h.push(i.put(w,gD))}return f.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[a]=u.keys()}),O.waitFor(h).next(()=>u)})}lookupMutationBatch(e,t){return vr(e).get(t).next(r=>r?(Y(r.userId===this.userId),ys(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?O.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return vr(e).J({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(Y(a.batchId>=r),i=ys(this.serializer,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return vr(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vr(e).U("userMutationsIndex",t).next(r=>r.map(s=>ys(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=ju(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return mi(e).J({range:s},(o,a,u)=>{const[c,h,f]=o,p=Cn(h);if(c===this.userId&&t.path.isEqual(p))return vr(e).get(f).next(w=>{if(!w)throw X();Y(w.userId===this.userId),i.push(ys(this.serializer,w))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new xe(le);const s=[];return t.forEach(i=>{const o=ju(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=mi(e).J({range:a},(c,h,f)=>{const[p,w,k]=c,S=Cn(w);p===this.userId&&i.path.isEqual(S)?r=r.add(k):f.done()});s.push(u)}),O.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=ju(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new xe(le);return mi(e).J({range:o},(u,c,h)=>{const[f,p,w]=u,k=Cn(p);f===this.userId&&r.isPrefixOf(k)?k.length===s&&(a=a.add(w)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(vr(e).get(i).next(o=>{if(o===null)throw X();Y(o.userId===this.userId),r.push(ys(this.serializer,o))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return GT(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return mi(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Cn(i[1]);s.push(u)}else a.done()}).next(()=>{Y(s.length===0)})})}containsKey(e,t){return HT(e,this.userId,t)}Nn(e){return QT(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function HT(n,e,t){const r=ju(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return mi(n).J({range:i,H:!0},(a,u,c)=>{const[h,f,p]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function vr(n){return et(n,"mutations")}function mi(n){return et(n,"documentMutations")}function QT(n){return et(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ws(0)}static kn(){return new Ws(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Ws(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>te.fromTimestamp(new Le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>oi(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Y(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return oi(e).J((o,a)=>{const u=Zo(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return oi(e).J((r,s)=>{const i=Zo(s);t(i)})}qn(e){return Vv(e).get("targetGlobalKey").next(t=>(Y(t!==null),t))}Qn(e,t){return Vv(e).put("targetGlobalKey",t)}Kn(e,t){return oi(e).put(zT(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Bs(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return oi(e).J({range:s,index:"queryTargetsIndex"},(o,a,u)=>{const c=Zo(a);ml(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Pr(e);return t.forEach(o=>{const a=Mt(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=Pr(e);return O.forEach(t,i=>{const o=Mt(i.path);return O.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Pr(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Pr(e);let i=ce();return s.J({range:r,H:!0},(o,a,u)=>{const c=Cn(o[1]),h=new G(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Mt(t.path),s=IDBKeyRange.bound([r],[KI(r)],!1,!0);let i=0;return Pr(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],u,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return oi(e).get(t).next(r=>r?Zo(r):null)}}function oi(n){return et(n,"targets")}function Vv(n){return et(n,"targetGlobal")}function Pr(n){return et(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ov([n,e],[t,r]){const s=le(n,t);return s===0?le(e,r):s}class L2{constructor(e){this.Un=e,this.buffer=new xe(Ov),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Ov(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class j2{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){B("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ss(t)?B("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Qs(t)}await this.Hn(3e5)})}}class F2{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(dn.oe);const r=new L2(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(B("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(Dv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Dv):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,u,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(B("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),ci()<=he.DEBUG&&B("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(u-a)+`ms
	Removed ${f} documents in `+(c-u)+`ms
Total Duration: ${c-h}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function U2(n,e){return new F2(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e,t){this.db=e,this.garbageCollector=U2(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return cu(e,r)}removeReference(e,t,r){return cu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return cu(e,t)}nr(e,t){return function(s,i){let o=!1;return QT(s).Y(a=>HT(s,a,i).next(u=>(u&&(o=!0),O.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const u=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,te.min()),Pr(e).delete(function(f){return[0,Mt(f.path)]}(o))))});s.push(u)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return cu(e,t)}tr(e,t){const r=Pr(e);let s,i=dn.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(i!==dn.oe&&t(new G(Cn(s)),i),i=c,s=u):i=dn.oe}).next(()=>{i!==dn.oe&&t(new G(Cn(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function cu(n,e){return Pr(n).put(function(r,s){return{targetId:0,path:Mt(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JT{constructor(){this.changes=new is(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$e.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ds(e).put(r)}removeEntry(e,t,r){return ds(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Lc(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=$e.newInvalidDocument(t);return ds(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(zo(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:$e.newInvalidDocument(t)};return ds(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(zo(t))},(s,i)=>{r={document:this.ir(t,i),size:Fc(i)}}).next(()=>r)}getEntries(e,t){let r=tn();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=tn(),s=new Ne(G.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Fc(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return O.resolve();let s=new xe(jv);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(zo(s.first()),zo(s.last())),o=s.getIterator();let a=o.getNext();return ds(e).J({index:"documentKeyIndex",range:i},(u,c,h)=>{const f=G.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&jv(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(zo(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Lc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ds(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=tn();for(const f of c){const p=this.ir(G.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(gl(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=tn();const o=Lv(t,r),a=Lv(t,sn.max());return ds(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,h)=>{const f=this.ir(G.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new z2(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Mv(e).get("remoteDocumentGlobalKey").next(t=>(Y(!!t),t))}rr(e,t){return Mv(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=S2(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(te.min())))return r}return $e.newInvalidDocument(e)}}function XT(n){return new B2(n)}class z2 extends JT{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new is(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new xe((i,o)=>le(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const u=Ev(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Fc(u);r+=c-a.size,t.push(this.cr.addEntry(e,i,u))}else if(r-=a.size,this.trackRemovals){const u=Ev(this.cr.serializer,o.convertToNoDocument(te.min()));t.push(this.cr.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Mv(n){return et(n,"remoteDocumentGlobal")}function ds(n){return et(n,"remoteDocumentsV14")}function zo(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Lv(n,e){const t=e.documentKey.path.toArray();return[n,Lc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jv(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=le(t[i],r[i]),s)return s;return s=le(t.length,r.length),s||(s=le(t[t.length-2],r[r.length-2]),s||le(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YT{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Ta(r.mutation,s,Wt.empty(),Le.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ce()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ce()){const s=Nn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Xo();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Nn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ce()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=tn();const o=Ia(),a=function(){return Ia()}();return t.forEach((u,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof hr)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),Ta(h.mutation,c,h.mutation.getFieldMask(),Le.now())):o.set(c.key,Wt.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new q2(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Ia();let s=new Ne((o,a)=>o-a),i=ce();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(c===null)return;let h=r.get(u)||Wt.empty();h=a.applyToLocalView(c,h),r.set(u,h);const f=(s.get(a.batchId)||ce()).add(u);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,h=u.value,f=yT();h.forEach(p=>{if(!i.has(p)){const w=bT(t.get(p),r.get(p));w!==null&&f.set(p,w),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return O.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return G.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):fT(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(Nn());let a=-1,u=i;return o.next(c=>O.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?O.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{u=u.insert(h,p)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,u,c,ce())).next(h=>({batchId:a,changes:_T(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new G(t)).next(r=>{let s=Xo();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Xo();return this.indexManager.getCollectionParents(e,i).next(a=>O.forEach(a,u=>{const c=function(f,p){return new fo(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((u,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,$e.newInvalidDocument(h)))});let a=Xo();return o.forEach((u,c)=>{const h=i.get(u);h!==void 0&&Ta(h.mutation,c,Wt.empty(),Le.now()),gl(t,c)&&(a=a.insert(u,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W2{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return O.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Lt(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:qT(s.bundledQuery),readTime:Lt(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K2{constructor(){this.overlays=new Ne(G.comparator),this.Ir=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Nn();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=Nn(),i=t.length+1,o=new G(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ne((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=Nn(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=Nn(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return O.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new dg(t,r));let i=this.Ir.get(t);i===void 0&&(i=ce(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(){this.sessionToken=Ke.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(){this.Tr=new xe(rt.Er),this.dr=new xe(rt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new rt(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new rt(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new G(new ye([])),r=new rt(t,e),s=new rt(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new G(new ye([])),r=new rt(t,e),s=new rt(t,e+1);let i=ce();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new rt(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class rt{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return G.comparator(e.key,t.key)||le(e.wr,t.wr)}static Ar(e,t){return le(e.wr,t.wr)||G.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new xe(rt.Er)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ug(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new rt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return O.resolve(o)}lookupMutationBatch(e,t){return O.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new rt(t,0),s=new rt(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new xe(le);return t.forEach(s=>{const i=new rt(s,0),o=new rt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),O.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;G.isDocumentKey(i)||(i=i.child(""));const o=new rt(new G(i),0);let a=new xe(le);return this.br.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.wr)),!0)},o),O.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Y(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return O.forEach(t.mutations,s=>{const i=new rt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new rt(t,0),s=this.br.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(e){this.Mr=e,this.docs=function(){return new Ne(G.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():$e.newInvalidDocument(t))}getEntries(e,t){let r=tn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():$e.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=tn();const o=t.path,a=new G(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:h}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||ng(GI(h),r)<=0||(s.has(h.key)||gl(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){X()}Or(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new J2(this)}getSize(e){return O.resolve(this.size)}}class J2 extends JT{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(e){this.persistence=e,this.Nr=new is(t=>Bs(t),ml),this.lastRemoteSnapshotVersion=te.min(),this.highestTargetId=0,this.Lr=0,this.Br=new gg,this.targetCount=0,this.kr=Ws.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),O.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Ws(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Kn(t),O.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{constructor(e,t){this.qr={},this.overlays={},this.Qr=new dn(0),this.Kr=!1,this.Kr=!0,this.$r=new G2,this.referenceDelegate=e(this),this.Ur=new X2(this),this.indexManager=new V2,this.remoteDocumentCache=function(s){return new Q2(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new BT(t),this.Gr=new W2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new K2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new H2(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){B("MemoryPersistence","Starting transaction:",e);const s=new Y2(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return O.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class Y2 extends QI{constructor(e){super(),this.currentSequenceNumber=e}}class Pd{constructor(e){this.persistence=e,this.Jr=new gg,this.Yr=null}static Zr(e){return new Pd(e)}get Xr(){if(this.Yr)return this.Yr;throw X()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),O.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.Xr,r=>{const s=G.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,te.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return O.or([()=>O.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z2{constructor(e){this.serializer=e}O(e,t,r,s){const i=new wd("createOrUpgrade",t);r<1&&s>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Y0,{unique:!0}),u.createObjectStore("documentMutations")}(e),Fv(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=O.resolve();return r<3&&s>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Fv(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:te.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(h=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Y0,{unique:!0});const f=c.store("mutations"),p=h.map(w=>f.put(w));return O.waitFor(p)})}(e,i))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(u){const c=u.createObjectStore("documentOverlays",{keyPath:AD});c.createIndex("collectionPathOverlayIndex",RD,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",PD,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:_D});c.createIndex("documentKeyIndex",yD),c.createIndex("collectionGroupIndex",vD)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:TD}).createIndex("sequenceNumberIndex",bD,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:SD}).createIndex("documentKeyIndex",kD,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Fc(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>O.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>O.forEach(a,u=>{Y(u.userId===i.userId);const c=ys(this.serializer,u);return GT(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const u=new ye(o),c=function(f){return[0,Mt(f)]}(u);i.push(t.get(c).next(h=>h?O.resolve():(f=>t.put({targetId:0,path:Mt(f),sequenceNumber:s.highestListenSequenceNumber}))(u)))}).next(()=>O.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:ID});const r=t.store("collectionParents"),s=new pg,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Mt(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const u=new ye(o);return i(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{const h=Cn(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Zo(s),o=zT(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),u=function(f){return f.document?new G(ye.fromString(f.document.name).popFirst(5)):f.noDocument?G.fromSegments(f.noDocument.path):f.unknownDocument?G.fromSegments(f.unknownDocument.path):X()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>O.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=XT(this.serializer),i=new ZT(Pd.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(u=>{var c;let h=(c=a.get(u.userId))!==null&&c!==void 0?c:ce();ys(this.serializer,u).keys().forEach(f=>h=h.add(f)),a.set(u.userId,h)}),O.forEach(a,(u,c)=>{const h=new dt(c),f=Ad.lt(this.serializer,h),p=i.getIndexManager(h),w=Rd.lt(h,this.serializer,p,i.referenceDelegate);return new YT(s,w,f,p).recalculateAndSaveOverlaysForDocumentKeys(new gm(t,dn.oe),u).next()})})}}function Fv(n){n.createObjectStore("targetDocuments",{keyPath:xD}).createIndex("documentTargetsIndex",ED,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",wD,{unique:!0}),n.createObjectStore("targetGlobal")}const tf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class _g{constructor(e,t,r,s,i,o,a,u,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!_g.D())throw new K(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new $2(this,s),this.Ai=t+"main",this.serializer=new BT(u),this.Ri=new Kr(this.Ai,this.hi,new Z2(this.serializer)),this.$r=new A2,this.Ur=new M2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=XT(this.serializer),this.Gr=new k2,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&Vt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new K(F.FAILED_PRECONDITION,tf);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new dn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>du(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ss(e))return B("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return B("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return qo(e).get("owner").next(t=>O.resolve(this.vi(t)))}Ci(e){return du(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=et(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return O.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?O.resolve(!0):qo(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new K(F.FAILED_PRECONDITION,tf);return!1}}return!(!this.networkEnabled||!this.inForeground)||du(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&B("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new gm(e,dn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>du(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Rd.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new O2(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ad.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){B("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(u){return u===17?DD:u===16?ND:u===15?sg:u===14?eT:u===13?ZI:u===12?CD:u===11?YI:void X()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new gm(a,this.Qr?this.Qr.next():dn.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw Vt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new K(F.FAILED_PRECONDITION,HI);return r(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return qo(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new K(F.FAILED_PRECONDITION,tf)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return qo(e).put("owner",t)}static D(){return Kr.D()}bi(e){const t=qo(e);return t.get("owner").next(r=>this.vi(r)?(B("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):O.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Vt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;XE()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return B("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Vt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Vt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function qo(n){return et(n,"owner")}function du(n){return et(n,"clientMetadata")}function eV(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=ce(),s=ce();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new yg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return XE()?8:JI(Ze())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new tV;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(ci()<=he.DEBUG&&B("QueryEngine","SDK will not create cache indexes for query:",di(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),O.resolve()):(ci()<=he.DEBUG&&B("QueryEngine","Query:",di(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(ci()<=he.DEBUG&&B("QueryEngine","The SDK decides to create cache indexes for query:",di(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mn(t))):O.resolve())}Yi(e,t){if(dv(t))return O.resolve(null);let r=mn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Im(t,null,"F"),r=mn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ce(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.ts(t,a);return this.ns(t,c,o,u.readTime)?this.Yi(e,Im(t,null,"F")):this.rs(e,c,t,u)}))})))}Zi(e,t,r,s){return dv(t)||s.isEqual(te.min())?O.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?O.resolve(null):(ci()<=he.DEBUG&&B("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),di(t)),this.rs(e,o,t,uD(s,-1)).next(a=>a))})}ts(e,t){let r=new xe(pT(e));return t.forEach((s,i)=>{gl(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return ci()<=he.DEBUG&&B("QueryEngine","Using full collection scan to execute query:",di(t)),this.Ji.getDocumentsMatchingQuery(e,t,sn.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nV{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ne(le),this._s=new is(i=>Bs(i),ml),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new YT(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function tb(n,e,t,r){return new nV(n,e,t,r)}async function nb(n,e){const t=oe(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=ce();for(const c of s){o.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)u=u.add(h.key)}return t.localDocuments.getDocuments(r,u).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function rV(n,e){const t=oe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,u,c,h){const f=c.batch,p=f.keys();let w=O.resolve();return p.forEach(k=>{w=w.next(()=>h.getEntry(u,k)).next(S=>{const C=c.docVersions.get(k);Y(C!==null),S.version.compareTo(C)<0&&(f.applyToRemoteDocument(S,c),S.isValidDocument()&&(S.setReadTime(c.commitVersion),h.addEntry(S)))})}),w.next(()=>a.mutationQueue.removeMutationBatch(u,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=ce();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function rb(n){const e=oe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function sV(n,e){const t=oe(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const p=s.get(f);if(!p)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let w=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?w=w.withResumeToken(Ke.EMPTY_BYTE_STRING,te.min()).withLastLimboFreeSnapshotVersion(te.min()):h.resumeToken.approximateByteSize()>0&&(w=w.withResumeToken(h.resumeToken,r)),s=s.insert(f,w),function(S,C,A){return S.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:A.addedDocuments.size+A.modifiedDocuments.size+A.removedDocuments.size>0}(p,w,h)&&a.push(t.Ur.updateTargetData(i,w))});let u=tn(),c=ce();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(iV(i,o,e.documentUpdates).next(h=>{u=h.Ps,c=h.Is})),!r.isEqual(te.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return O.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(t.os=s,i))}function iV(n,e,t){let r=ce(),s=ce();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=tn();return t.forEach((a,u)=>{const c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(te.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):B("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Ps:o,Is:s}})}function oV(n,e){const t=oe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function aV(n,e){const t=oe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new er(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Cm(n,e,t){const r=oe(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!ss(o))throw o;B("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Uv(n,e,t){const r=oe(n);let s=te.min(),i=ce();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,h){const f=oe(u),p=f._s.get(h);return p!==void 0?O.resolve(f.os.get(p)):f.Ur.getTargetData(c,h)}(r,o,mn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:te.min(),t?i:ce())).next(a=>(lV(r,HD(e),a),{documents:a,Ts:i})))}function lV(n,e,t){let r=n.us.get(e)||te.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}class $v{constructor(){this.activeTargetIds=e2()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sb{constructor(){this.so=new $v,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new $v,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){B("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){B("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hu=null;function nf(){return hu===null?hu=function(){return 268435456+Math.round(2147483648*Math.random())}():hu++,"0x"+hu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt="WebChannelConnection";class hV extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=nf(),u=this.xo(t,r.toUriEncodedString());B("RestConnection",`Sending RPC '${t}' ${a}:`,u,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,u,c,s).then(h=>(B("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Fs("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",u,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ho}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=cV[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=nf();return new Promise((o,a)=>{const u=new FI;u.setWithCredentials(!0),u.listenOnce(UI.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Mu.NO_ERROR:const h=u.getResponseJson();B(Tt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case Mu.TIMEOUT:B(Tt,`RPC '${e}' ${i} timed out`),a(new K(F.DEADLINE_EXCEEDED,"Request time out"));break;case Mu.HTTP_ERROR:const f=u.getStatus();if(B(Tt,`RPC '${e}' ${i} failed with status:`,f,"response text:",u.getResponseText()),f>0){let p=u.getResponseJson();Array.isArray(p)&&(p=p[0]);const w=p==null?void 0:p.error;if(w&&w.status&&w.message){const k=function(C){const A=C.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(A)>=0?A:F.UNKNOWN}(w.status);a(new K(k,w.message))}else a(new K(F.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new K(F.UNAVAILABLE,"Connection failed."));break;default:X()}}finally{B(Tt,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);B(Tt,`RPC '${e}' ${i} sending request:`,s),u.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=nf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=zI(),a=BI(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const h=i.join("");B(Tt,`Creating RPC '${e}' stream ${s}: ${h}`,u);const f=o.createWebChannel(h,u);let p=!1,w=!1;const k=new dV({Io:C=>{w?B(Tt,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(p||(B(Tt,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),B(Tt,`RPC '${e}' stream ${s} sending:`,C),f.send(C))},To:()=>f.close()}),S=(C,A,x)=>{C.listen(A,T=>{try{x(T)}catch(P){setTimeout(()=>{throw P},0)}})};return S(f,Jo.EventType.OPEN,()=>{w||(B(Tt,`RPC '${e}' stream ${s} transport opened.`),k.yo())}),S(f,Jo.EventType.CLOSE,()=>{w||(w=!0,B(Tt,`RPC '${e}' stream ${s} transport closed`),k.So())}),S(f,Jo.EventType.ERROR,C=>{w||(w=!0,Fs(Tt,`RPC '${e}' stream ${s} transport errored:`,C),k.So(new K(F.UNAVAILABLE,"The operation could not be completed")))}),S(f,Jo.EventType.MESSAGE,C=>{var A;if(!w){const x=C.data[0];Y(!!x);const T=x,P=T.error||((A=T[0])===null||A===void 0?void 0:A.error);if(P){B(Tt,`RPC '${e}' stream ${s} received error:`,P);const M=P.status;let V=function(v){const E=qe[v];if(E!==void 0)return AT(E)}(M),y=P.message;V===void 0&&(V=F.INTERNAL,y="Unknown error status: "+M+" with message "+P.message),w=!0,k.So(new K(V,y)),f.close()}else B(Tt,`RPC '${e}' stream ${s} received:`,x),k.bo(x)}}),S(a,$I.STAT_EVENT,C=>{C.stat===mm.PROXY?B(Tt,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===mm.NOPROXY&&B(Tt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fV(){return typeof window<"u"?window:null}function zu(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cd(n){return new g2(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ib{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&B("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(e,t,r,s,i,o,a,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ib(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(Vt(t.toString()),Vt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new K(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return B("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(B("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class mV extends ob{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=v2(this.serializer,e),r=function(i){if(!("targetChange"in i))return te.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?te.min():o.readTime?Lt(o.readTime):te.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Sm(this.serializer),t.addTarget=function(i,o){let a;const u=o.target;if(a=Dc(u)?{documents:MT(i,u)}:{query:LT(i,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=CT(i,o.resumeToken);const c=Tm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(te.min())>0){a.readTime=ro(i,o.snapshotVersion.toTimestamp());const c=Tm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=x2(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Sm(this.serializer),t.removeTarget=e,this.a_(t)}}class pV extends ob{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Y(!!e.streamToken),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Y(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=w2(e.writeResults,e.commitTime),r=Lt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Sm(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Mc(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gV extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new K(F.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,bm(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new K(F.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,bm(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new K(F.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class _V{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Vt(t),this.D_=!1):B("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Xs(this)&&(B("RemoteStore","Restarting streams for network reachability change."),await async function(u){const c=oe(u);c.L_.add(4),await yl(c),c.q_.set("Unknown"),c.L_.delete(4),await Nd(c)}(this))})}),this.q_=new _V(r,s)}}async function Nd(n){if(Xs(n))for(const e of n.B_)await e(!0)}async function yl(n){for(const e of n.B_)await e(!1)}function ab(n,e){const t=oe(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Eg(t)?xg(t):po(t).r_()&&wg(t,e))}function vg(n,e){const t=oe(n),r=po(t);t.N_.delete(e),r.r_()&&lb(t,e),t.N_.size===0&&(r.r_()?r.o_():Xs(t)&&t.q_.set("Unknown"))}function wg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(te.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}po(n).A_(e)}function lb(n,e){n.Q_.xe(e),po(n).R_(e)}function xg(n){n.Q_=new h2({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),po(n).start(),n.q_.v_()}function Eg(n){return Xs(n)&&!po(n).n_()&&n.N_.size>0}function Xs(n){return oe(n).L_.size===0}function ub(n){n.Q_=void 0}async function vV(n){n.q_.set("Online")}async function wV(n){n.N_.forEach((e,t)=>{wg(n,e)})}async function xV(n,e){ub(n),Eg(n)?(n.q_.M_(e),xg(n)):n.q_.set("Unknown")}async function EV(n,e,t){if(n.q_.set("Online"),e instanceof PT&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){B("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Uc(n,r)}else if(e instanceof Bu?n.Q_.Ke(e):e instanceof RT?n.Q_.He(e):n.Q_.We(e),!t.isEqual(te.min()))try{const r=await rb(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const h=i.N_.get(u);if(!h)return;i.N_.set(u,h.withResumeToken(Ke.EMPTY_BYTE_STRING,h.snapshotVersion)),lb(i,u);const f=new er(h.target,u,c,h.sequenceNumber);wg(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){B("RemoteStore","Failed to raise snapshot:",r),await Uc(n,r)}}async function Uc(n,e,t){if(!ss(e))throw e;n.L_.add(1),await yl(n),n.q_.set("Offline"),t||(t=()=>rb(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{B("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Nd(n)})}function cb(n,e){return e().catch(t=>Uc(n,t,e))}async function vl(n){const e=oe(n),t=es(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;IV(e);)try{const s=await oV(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,TV(e,s)}catch(s){await Uc(e,s)}db(e)&&hb(e)}function IV(n){return Xs(n)&&n.O_.length<10}function TV(n,e){n.O_.push(e);const t=es(n);t.r_()&&t.V_&&t.m_(e.mutations)}function db(n){return Xs(n)&&!es(n).n_()&&n.O_.length>0}function hb(n){es(n).start()}async function bV(n){es(n).p_()}async function SV(n){const e=es(n);for(const t of n.O_)e.m_(t.mutations)}async function kV(n,e,t){const r=n.O_.shift(),s=cg.from(r,e,t);await cb(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await vl(n)}async function AV(n,e){e&&es(n).V_&&await async function(r,s){if(function(o){return u2(o)&&o!==F.ABORTED}(s.code)){const i=r.O_.shift();es(r).s_(),await cb(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await vl(r)}}(n,e),db(n)&&hb(n)}async function zv(n,e){const t=oe(n);t.asyncQueue.verifyOperationInProgress(),B("RemoteStore","RemoteStore received new credentials");const r=Xs(t);t.L_.add(3),await yl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Nd(t)}async function RV(n,e){const t=oe(n);e?(t.L_.delete(2),await Nd(t)):e||(t.L_.add(2),await yl(t),t.q_.set("Unknown"))}function po(n){return n.K_||(n.K_=function(t,r,s){const i=oe(t);return i.w_(),new mV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:vV.bind(null,n),Ro:wV.bind(null,n),mo:xV.bind(null,n),d_:EV.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Eg(n)?xg(n):n.q_.set("Unknown")):(await n.K_.stop(),ub(n))})),n.K_}function es(n){return n.U_||(n.U_=function(t,r,s){const i=oe(t);return i.w_(),new pV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:bV.bind(null,n),mo:AV.bind(null,n),f_:SV.bind(null,n),g_:kV.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await vl(n)):(await n.U_.stop(),n.O_.length>0&&(B("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new jn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Ig(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new K(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Tg(n,e){if(Vt("AsyncQueue",`${e}: ${n}`),ss(n))return new K(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e){this.comparator=e?(t,r)=>e(t,r)||G.comparator(t.key,r.key):(t,r)=>G.comparator(t.key,r.key),this.keyedMap=Xo(),this.sortedSet=new Ne(this.comparator)}static emptySet(e){return new $i(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $i)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new $i;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(){this.W_=new Ne(G.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):X():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class so{constructor(e,t,r,s,i,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new so(e,t,$i.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Id(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class CV{constructor(){this.queries=Wv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=oe(t),i=s.queries;s.queries=Wv(),i.forEach((o,a)=>{for(const u of a.j_)u.onError(r)})})(this,new K(F.ABORTED,"Firestore shutting down"))}}function Wv(){return new is(n=>mT(n),Id)}async function bg(n,e){const t=oe(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new PV,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Tg(o,`Initialization of query '${di(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&kg(t)}async function Sg(n,e){const t=oe(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function NV(n,e){const t=oe(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&kg(t)}function DV(n,e,t){const r=oe(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function kg(n){n.Y_.forEach(e=>{e.next()})}var Nm,Kv;(Kv=Nm||(Nm={})).ea="default",Kv.Cache="cache";class Ag{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new so(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=so.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Nm.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(e){this.key=e}}class mb{constructor(e){this.key=e}}class VV{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ce(),this.mutatedKeys=ce(),this.Aa=pT(e),this.Ra=new $i(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new qv,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const p=s.get(h),w=gl(this.query,f)?f:null,k=!!p&&this.mutatedKeys.has(p.key),S=!!w&&(w.hasLocalMutations||this.mutatedKeys.has(w.key)&&w.hasCommittedMutations);let C=!1;p&&w?p.data.isEqual(w.data)?k!==S&&(r.track({type:3,doc:w}),C=!0):this.ga(p,w)||(r.track({type:2,doc:w}),C=!0,(u&&this.Aa(w,u)>0||c&&this.Aa(w,c)<0)&&(a=!0)):!p&&w?(r.track({type:0,doc:w}),C=!0):p&&!w&&(r.track({type:1,doc:p}),C=!0,(u||c)&&(a=!0)),C&&(w?(o=o.add(w),i=S?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(w,k){const S=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return X()}};return S(w)-S(k)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,c=u!==this.Ea;return this.Ea=u,o.length!==0||c?{snapshot:new so(this.query,e.Ra,i,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new qv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ce(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new mb(r))}),this.da.forEach(r=>{e.has(r)||t.push(new fb(r))}),t}ba(e){this.Ta=e.Ts,this.da=ce();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return so.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class OV{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class MV{constructor(e){this.key=e,this.va=!1}}class LV{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new is(a=>mT(a),Id),this.Ma=new Map,this.xa=new Set,this.Oa=new Ne(G.comparator),this.Na=new Map,this.La=new gg,this.Ba={},this.ka=new Map,this.qa=Ws.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function jV(n,e,t=!0){const r=wb(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await pb(r,e,t,!0),s}async function FV(n,e){const t=wb(n);await pb(t,e,!0,!1)}async function pb(n,e,t,r){const s=await aV(n.localStore,mn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await UV(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&ab(n.remoteStore,s),a}async function UV(n,e,t,r,s){n.Ka=(f,p,w)=>async function(S,C,A,x){let T=C.view.ma(A);T.ns&&(T=await Uv(S.localStore,C.query,!1).then(({documents:y})=>C.view.ma(y,T)));const P=x&&x.targetChanges.get(C.targetId),M=x&&x.targetMismatches.get(C.targetId)!=null,V=C.view.applyChanges(T,S.isPrimaryClient,P,M);return Hv(S,C.targetId,V.wa),V.snapshot}(n,f,p,w);const i=await Uv(n.localStore,e,!0),o=new VV(e,i.Ts),a=o.ma(i.documents),u=_l.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,u);Hv(n,t,c.wa);const h=new OV(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function $V(n,e,t){const r=oe(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Id(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Cm(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&vg(r.remoteStore,s.targetId),Dm(r,s.targetId)}).catch(Qs)):(Dm(r,s.targetId),await Cm(r.localStore,s.targetId,!0))}async function BV(n,e){const t=oe(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),vg(t.remoteStore,r.targetId))}async function zV(n,e,t){const r=xb(n);try{const s=await function(o,a){const u=oe(o),c=Le.now(),h=a.reduce((w,k)=>w.add(k.key),ce());let f,p;return u.persistence.runTransaction("Locally write mutations","readwrite",w=>{let k=tn(),S=ce();return u.cs.getEntries(w,h).next(C=>{k=C,k.forEach((A,x)=>{x.isValidDocument()||(S=S.add(A))})}).next(()=>u.localDocuments.getOverlayedDocuments(w,k)).next(C=>{f=C;const A=[];for(const x of a){const T=a2(x,f.get(x.key).overlayedDocument);T!=null&&A.push(new hr(x.key,T,iT(T.value.mapValue),kt.exists(!0)))}return u.mutationQueue.addMutationBatch(w,c,A,a)}).next(C=>{p=C;const A=C.applyToLocalDocumentSet(f,S);return u.documentOverlayCache.saveOverlays(w,C.batchId,A)})}).then(()=>({batchId:p.batchId,changes:_T(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,u){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ne(le)),c=c.insert(a,u),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await wl(r,s.changes),await vl(r.remoteStore)}catch(s){const i=Tg(s,"Failed to persist write");t.reject(i)}}async function gb(n,e){const t=oe(n);try{const r=await sV(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Y(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Y(o.va):s.removedDocuments.size>0&&(Y(o.va),o.va=!1))}),await wl(t,r,e)}catch(r){await Qs(r)}}function Gv(n,e,t){const r=oe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const u=oe(o);u.onlineState=a;let c=!1;u.queries.forEach((h,f)=>{for(const p of f.j_)p.Z_(a)&&(c=!0)}),c&&kg(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function qV(n,e,t){const r=oe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ne(G.comparator);o=o.insert(i,$e.newNoDocument(i,te.min()));const a=ce().add(i),u=new kd(te.min(),new Map,new Ne(le),o,a);await gb(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),Rg(r)}else await Cm(r.localStore,e,!1).then(()=>Dm(r,e,t)).catch(Qs)}async function WV(n,e){const t=oe(n),r=e.batch.batchId;try{const s=await rV(t.localStore,e);yb(t,r,null),_b(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await wl(t,s)}catch(s){await Qs(s)}}async function KV(n,e,t){const r=oe(n);try{const s=await function(o,a){const u=oe(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return u.mutationQueue.lookupMutationBatch(c,a).next(f=>(Y(f!==null),h=f.keys(),u.mutationQueue.removeMutationBatch(c,f))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>u.localDocuments.getDocuments(c,h))})}(r.localStore,e);yb(r,e,t),_b(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await wl(r,s)}catch(s){await Qs(s)}}function _b(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function yb(n,e,t){const r=oe(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Dm(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||vb(n,r)})}function vb(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(vg(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Rg(n))}function Hv(n,e,t){for(const r of t)r instanceof fb?(n.La.addReference(r.key,e),GV(n,r)):r instanceof mb?(B("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||vb(n,r.key)):X()}function GV(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(B("SyncEngine","New document in limbo: "+t),n.xa.add(r),Rg(n))}function Rg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new G(ye.fromString(e)),r=n.qa.next();n.Na.set(r,new MV(t)),n.Oa=n.Oa.insert(t,r),ab(n.remoteStore,new er(mn(pl(t.path)),r,"TargetPurposeLimboResolution",dn.oe))}}async function wl(n,e,t){const r=oe(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,u)=>{o.push(r.Ka(u,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(u.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(c){s.push(c);const f=yg.Wi(u.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(u,c){const h=oe(u);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>O.forEach(c,p=>O.forEach(p.$i,w=>h.persistence.referenceDelegate.addReference(f,p.targetId,w)).next(()=>O.forEach(p.Ui,w=>h.persistence.referenceDelegate.removeReference(f,p.targetId,w)))))}catch(f){if(!ss(f))throw f;B("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const p=f.targetId;if(!f.fromCache){const w=h.os.get(p),k=w.snapshotVersion,S=w.withLastLimboFreeSnapshotVersion(k);h.os=h.os.insert(p,S)}}}(r.localStore,i))}async function HV(n,e){const t=oe(n);if(!t.currentUser.isEqual(e)){B("SyncEngine","User change. New user:",e.toKey());const r=await nb(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(u=>{u.reject(new K(F.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await wl(t,r.hs)}}function QV(n,e){const t=oe(n),r=t.Na.get(e);if(r&&r.va)return ce().add(r.key);{let s=ce();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}function wb(n){const e=oe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=gb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=QV.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qV.bind(null,e),e.Ca.d_=NV.bind(null,e.eventManager),e.Ca.$a=DV.bind(null,e.eventManager),e}function xb(n){const e=oe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=WV.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=KV.bind(null,e),e}class nl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Cd(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return tb(this.persistence,new eb,e.initialUser,this.serializer)}Ga(e){return new ZT(Pd.Zr,this.serializer)}Wa(e){return new sb}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}nl.provider={build:()=>new nl};class JV extends nl{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await xb(this.Ja.syncEngine),await vl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return tb(this.persistence,new eb,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new j2(r,e.asyncQueue,t)}Ha(e,t){const r=new fD(t,this.persistence);return new hD(e.asyncQueue,r)}Ga(e){const t=eV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?$t.withCacheSize(this.cacheSizeBytes):$t.DEFAULT;return new _g(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,fV(),zu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new sb}}class $c{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Gv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=HV.bind(null,this.syncEngine),await RV(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new CV}()}createDatastore(e){const t=Cd(e.databaseInfo.databaseId),r=function(i){return new hV(i)}(e.databaseInfo);return function(i,o,a,u){return new gV(i,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new yV(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Gv(this.syncEngine,t,0),function(){return Bv.D()?new Bv:new uV}())}createSyncEngine(e,t){return function(s,i,o,a,u,c,h){const f=new LV(s,i,o,a,u,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=oe(s);B("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await yl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}$c.provider={build:()=>new $c};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Vt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=dt.UNAUTHENTICATED,this.clientId=WI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{B("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(B("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Tg(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function rf(n,e){n.asyncQueue.verifyOperationInProgress(),B("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await nb(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Qv(n,e){n.asyncQueue.verifyOperationInProgress();const t=await YV(n);B("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>zv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>zv(e.remoteStore,s)),n._onlineComponents=e}async function YV(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){B("FirestoreClient","Using user provided OfflineComponentProvider");try{await rf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Fs("Error using user provided cache. Falling back to memory cache: "+t),await rf(n,new nl)}}else B("FirestoreClient","Using default OfflineComponentProvider"),await rf(n,new nl);return n._offlineComponents}async function Eb(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(B("FirestoreClient","Using user provided OnlineComponentProvider"),await Qv(n,n._uninitializedComponentsProvider._online)):(B("FirestoreClient","Using default OnlineComponentProvider"),await Qv(n,new $c))),n._onlineComponents}function ZV(n){return Eb(n).then(e=>e.syncEngine)}async function Bc(n){const e=await Eb(n),t=e.eventManager;return t.onListen=jV.bind(null,e.syncEngine),t.onUnlisten=$V.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=FV.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=BV.bind(null,e.syncEngine),t}function eO(n,e,t={}){const r=new jn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,u,c){const h=new Pg({next:p=>{h.Za(),o.enqueueAndForget(()=>Sg(i,f));const w=p.docs.has(a);!w&&p.fromCache?c.reject(new K(F.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&p.fromCache&&u&&u.source==="server"?c.reject(new K(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),f=new Ag(pl(a.path),h,{includeMetadataChanges:!0,_a:!0});return bg(i,f)}(await Bc(n),n.asyncQueue,e,t,r)),r.promise}function tO(n,e,t={}){const r=new jn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,u,c){const h=new Pg({next:p=>{h.Za(),o.enqueueAndForget(()=>Sg(i,f)),p.fromCache&&u.source==="server"?c.reject(new K(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),f=new Ag(a,h,{includeMetadataChanges:!0,_a:!0});return bg(i,f)}(await Bc(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ib(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jv=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tb(n,e,t){if(!t)throw new K(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function nO(n,e,t,r){if(e===!0&&r===!0)throw new K(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Xv(n){if(!G.isDocumentKey(n))throw new K(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Yv(n){if(G.isDocumentKey(n))throw new K(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Dd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":X()}function jt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new K(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Dd(n);throw new K(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zv{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new K(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new K(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ib((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new K(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new K(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new K(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Vd{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Zv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new K(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new K(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Zv(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new eD;switch(r.type){case"firstParty":return new sD(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new K(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Jv.get(t);r&&(B("ComponentProvider","Removing Datastore"),Jv.delete(t),r.terminate())}(this),Promise.resolve()}}function rO(n,e,t,r={}){var s;const i=(n=jt(n,Vd))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Fs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=dt.MOCK_USER;else{a=CP(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new K(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new dt(c)}n._authCredentials=new tD(new qI(a,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new os(this.firestore,e,this._query)}}class At{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new At(this.firestore,e,this._key)}}class Gr extends os{constructor(e,t,r){super(e,t,pl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new At(this.firestore,null,new G(e))}withConverter(e){return new Gr(this.firestore,e,this._path)}}function Ve(n,e,...t){if(n=pt(n),Tb("collection","path",e),n instanceof Vd){const r=ye.fromString(e,...t);return Yv(r),new Gr(n,null,r)}{if(!(n instanceof At||n instanceof Gr))throw new K(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ye.fromString(e,...t));return Yv(r),new Gr(n.firestore,null,r)}}function ze(n,e,...t){if(n=pt(n),arguments.length===1&&(e=WI.newId()),Tb("doc","path",e),n instanceof Vd){const r=ye.fromString(e,...t);return Xv(r),new At(n,null,new G(r))}{if(!(n instanceof At||n instanceof Gr))throw new K(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ye.fromString(e,...t));return Xv(r),new At(n.firestore,n instanceof Gr?n.converter:null,new G(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ib(this,"async_queue_retry"),this.Vu=()=>{const r=zu();r&&B("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=zu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=zu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new jn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ss(e))throw e;B("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Vt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Ig.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&X()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function tw(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Un extends Vd{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ew,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ew(e),this._firestoreClient=void 0,await e}}}function sO(n,e){const t=typeof n=="object"?n:nI(),r=typeof n=="string"?n:"(default)",s=Kp(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=RP("firestore");i&&rO(s,...i)}return s}function Od(n){if(n._terminated)throw new K(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||bb(n),n._firestoreClient}function bb(n){var e,t,r;const s=n._freezeSettings(),i=function(a,u,c,h){return new OD(a,u,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,Ib(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new XV(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const u=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(u),_online:u}}(n._componentsProvider))}function iO(n,e){Fs("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return oO(n,$c.provider,{build:r=>new JV(r,t.cacheSizeBytes,void 0)}),Promise.resolve()}function oO(n,e,t){if((n=jt(n,Un))._firestoreClient||n._terminated)throw new K(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new K(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},bb(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(e){this._byteString=e}static fromBase64String(e){try{return new io(Ke.fromBase64String(e))}catch(t){throw new K(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new io(Ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new K(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new K(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new K(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return le(this._lat,e._lat)||le(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aO=/^__.*__$/;class lO{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new hr(e,this.data,this.fieldMask,t,this.fieldTransforms):new mo(e,this.data,t,this.fieldTransforms)}}class Sb{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new hr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function kb(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw X()}}class Dg{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Dg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return zc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(kb(this.Cu)&&aO.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class uO{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Cd(e)}Qu(e,t,r,s=!1){return new Dg({Cu:e,methodName:t,qu:r,path:Oe.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function jd(n){const e=n._freezeSettings(),t=Cd(n._databaseId);return new uO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ab(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);Og("Data must be an object, but it was:",o,r);const a=Rb(r,o);let u,c;if(i.merge)u=new Wt(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const p=Vm(e,f,t);if(!o.contains(p))throw new K(F.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Cb(h,p)||h.push(p)}u=new Wt(h),c=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,c=o.fieldTransforms;return new lO(new St(a),u,c)}class Fd extends Ld{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Fd}}class Vg extends Ld{_toFieldTransform(e){return new TT(e.path,new eo)}isEqual(e){return e instanceof Vg}}function cO(n,e,t,r){const s=n.Qu(1,e,t);Og("Data must be an object, but it was:",s,r);const i=[],o=St.empty();Js(r,(u,c)=>{const h=Mg(e,u,t);c=pt(c);const f=s.Nu(h);if(c instanceof Fd)i.push(h);else{const p=xl(c,f);p!=null&&(i.push(h),o.set(h,p))}});const a=new Wt(i);return new Sb(o,a,s.fieldTransforms)}function dO(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Vm(e,r,t)],u=[s];if(i.length%2!=0)throw new K(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(Vm(e,i[p])),u.push(i[p+1]);const c=[],h=St.empty();for(let p=a.length-1;p>=0;--p)if(!Cb(c,a[p])){const w=a[p];let k=u[p];k=pt(k);const S=o.Nu(w);if(k instanceof Fd)c.push(w);else{const C=xl(k,S);C!=null&&(c.push(w),h.set(w,C))}}const f=new Wt(c);return new Sb(h,f,o.fieldTransforms)}function hO(n,e,t,r=!1){return xl(t,n.Qu(r?4:3,e))}function xl(n,e){if(Pb(n=pt(n)))return Og("Unsupported field value:",e,n),Rb(n,e);if(n instanceof Ld)return function(r,s){if(!kb(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let u=xl(a,s.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=pt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return t2(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Le.fromDate(r);return{timestampValue:ro(s.serializer,i)}}if(r instanceof Le){const i=new Le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ro(s.serializer,i)}}if(r instanceof Cg)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof io)return{bytesValue:CT(s.serializer,r._byteString)};if(r instanceof At){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:fg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ng)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Bu("VectorValues must only contain numeric values.");return lg(a.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Dd(r)}`)}(n,e)}function Rb(n,e){const t={};return tT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Js(n,(r,s)=>{const i=xl(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Pb(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Le||n instanceof Cg||n instanceof io||n instanceof At||n instanceof Ld||n instanceof Ng)}function Og(n,e,t){if(!Pb(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Dd(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Vm(n,e,t){if((e=pt(e))instanceof Md)return e._internalPath;if(typeof e=="string")return Mg(n,e);throw zc("Field path arguments must be of type string or ",n,!1,void 0,t)}const fO=new RegExp("[~\\*/\\[\\]]");function Mg(n,e,t){if(e.search(fO)>=0)throw zc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Md(...e.split("."))._internalPath}catch{throw zc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function zc(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new K(F.INVALID_ARGUMENT,a+n+u)}function Cb(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new At(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new mO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Lg("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class mO extends Nb{data(){return super.data()}}function Lg(n,e){return typeof e=="string"?Mg(n,e):e instanceof Md?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Db(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new K(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class jg{}class Vb extends jg{}function pO(n,e,...t){let r=[];e instanceof jg&&r.push(e),r=r.concat(t),function(i){const o=i.filter(u=>u instanceof Ug).length,a=i.filter(u=>u instanceof Fg).length;if(o>1||o>0&&a>0)throw new K(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Fg extends Vb{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Fg(e,t,r)}_apply(e){const t=this._parse(e);return Ob(e._query,t),new os(e.firestore,e.converter,Em(e._query,t))}_parse(e){const t=jd(e.firestore);return function(i,o,a,u,c,h,f){let p;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new K(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){rw(f,h);const w=[];for(const k of f)w.push(nw(u,i,k));p={arrayValue:{values:w}}}else p=nw(u,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||rw(f,h),p=hO(a,o,f,h==="in"||h==="not-in");return fe.create(c,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Ug extends jg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ug(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ve.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const u of a)Ob(o,u),o=Em(o,u)}(e._query,t),new os(e.firestore,e.converter,Em(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class $g extends Vb{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new $g(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new K(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new K(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new el(i,o)}(e._query,this._field,this._direction);return new os(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new fo(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function gO(n,e="asc"){const t=e,r=Lg("orderBy",n);return $g._create(r,t)}function nw(n,e,t){if(typeof(t=pt(t))=="string"){if(t==="")throw new K(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fT(e)&&t.indexOf("/")!==-1)throw new K(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ye.fromString(t));if(!G.isDocumentKey(r))throw new K(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ya(n,new G(r))}if(t instanceof At)return Ya(n,t._key);throw new K(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Dd(t)}.`)}function rw(n,e){if(!Array.isArray(n)||n.length===0)throw new K(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ob(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new K(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new K(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class _O{convertValue(e,t="none"){switch($s(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Yr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw X()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Js(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Pe(o.doubleValue));return new Ng(i)}convertGeoPoint(e){return new Cg(Pe(e.latitude),Pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=og(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Ja(e));default:return null}}convertTimestamp(e){const t=ur(e);return new Le(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ye.fromString(e);Y($T(r));const s=new Us(r.get(1),r.get(3)),i=new G(r.popFirst(5));return s.isEqual(t)||Vt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mb(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Lb extends Nb{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Lg("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class qu extends Lb{data(e={}){return super.data(e)}}class jb{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ea(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new qu(this._firestore,this._userDataWriter,r.key,r,new ea(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new K(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const u=new qu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ea(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const u=new qu(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ea(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:yO(a.type),doc:u,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function yO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return X()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bg(n){n=jt(n,At);const e=jt(n.firestore,Un);return eO(Od(e),n._key).then(t=>Fb(e,n,t))}class zg extends _O{constructor(e){super(),this.firestore=e}convertBytes(e){return new io(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}function vO(n){n=jt(n,os);const e=jt(n.firestore,Un),t=Od(e),r=new zg(e);return Db(n._query),tO(t,n._query).then(s=>new jb(e,r,n,s))}function Om(n,e,t){n=jt(n,At);const r=jt(n.firestore,Un),s=Mb(n.converter,e,t);return $d(r,[Ab(jd(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,kt.none())])}function Hr(n,e,t,...r){n=jt(n,At);const s=jt(n.firestore,Un),i=jd(s);let o;return o=typeof(e=pt(e))=="string"||e instanceof Md?dO(i,"updateDoc",n._key,e,t,r):cO(i,"updateDoc",n._key,e),$d(s,[o.toMutation(n._key,kt.exists(!0))])}function Ud(n){return $d(jt(n.firestore,Un),[new Sd(n._key,kt.none())])}function go(n,e){const t=jt(n.firestore,Un),r=ze(n),s=Mb(n.converter,e);return $d(t,[Ab(jd(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,kt.exists(!1))]).then(()=>r)}function Xe(n,...e){var t,r,s;n=pt(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||tw(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(tw(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let u,c,h;if(n instanceof At)c=jt(n.firestore,Un),h=pl(n._key.path),u={next:f=>{e[o]&&e[o](Fb(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=jt(n,os);c=jt(f.firestore,Un),h=f._query;const p=new zg(c);u={next:w=>{e[o]&&e[o](new jb(c,p,f,w))},error:e[o+1],complete:e[o+2]},Db(n._query)}return function(p,w,k,S){const C=new Pg(S),A=new Ag(w,C,k);return p.asyncQueue.enqueueAndForget(async()=>bg(await Bc(p),A)),()=>{C.Za(),p.asyncQueue.enqueueAndForget(async()=>Sg(await Bc(p),A))}}(Od(c),h,a,u)}function $d(n,e){return function(r,s){const i=new jn;return r.asyncQueue.enqueueAndForget(async()=>zV(await ZV(r),s,i)),i.promise}(Od(n),e)}function Fb(n,e,t){const r=t.docs.get(e._key),s=new zg(n);return new Lb(n,s,e._key,r,new ea(t.hasPendingWrites,t.fromCache),e.converter)}function wO(){return new Vg("serverTimestamp")}(function(e,t=!0){(function(s){ho=s})(uo),Qi(new Ms("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Un(new nD(r.getProvider("auth-internal")),new oD(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new K(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Us(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),qr(Q0,"4.7.3",e),qr(Q0,"4.7.3","esm2017")})();const Ub=W.createContext(void 0);function xO({children:n}){const[e,t]=W.useState(()=>localStorage.getItem("theme")||"light");W.useEffect(()=>{localStorage.setItem("theme",e);const s=document.documentElement;e==="dark"?s.classList.add("dark"):s.classList.remove("dark")},[e]);const r=()=>{t(s=>s==="light"?"dark":"light")};return g.jsx(Ub.Provider,{value:{theme:e,toggleTheme:r},children:n})}function EO(){const n=W.useContext(Ub);if(!n)throw new Error("useTheme must be used within ThemeProvider");return n}function IO({db:n,role:e}){const t={PROJECT_WORK_VALUE:11e4,TOTAL_SCHEDULED_DRAWS:127400,MONTHLY_INTEREST:2900,PROJECT_DURATION_MONTHS:6,PROPERTY_ADDRESS:"4821 Briscoe St & 4829 Briscoe St, Houston, TX 77033",PROJECT_NAME:"RED CARPET CONTRACTORS Project: Tech Camp 1"},[r,s]=W.useState([]),[i,o]=W.useState({}),[a,u]=W.useState([]),[c,h]=W.useState(t);W.useEffect(()=>{if(!n)return;(async()=>{try{const T=await Bg(ze(n,"config","prd"));T.exists()&&h(T.data())}catch(T){console.error("Error loading PRD config:",T)}})();const C=Xe(Ve(n,"tasks"),T=>{const P=[];T.forEach(M=>P.push({id:M.id,...M.data()})),s(P)}),A=Xe(ze(n,"budget","totals"),T=>{o(T.exists()?T.data():{})}),x=Xe(Ve(n,"draws"),T=>{const P=[];T.forEach(M=>P.push({id:M.id,...M.data()})),u(P)});return()=>{C(),A(),x()}},[n]);const f=c.PROJECT_WORK_VALUE||11e4,p=r.reduce((S,C)=>S+(C.status==="pm_approved"&&C.approvedValue||0),0),w=f>0?p/f*100:0,k=a.reduce((S,C)=>S+(C.amount||0),0);return g.jsxs("div",{className:"grid gap-4 sm:gap-8",children:[g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6",children:[g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow p-4 sm:p-6",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("span",{className:"text-xs sm:text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Budget"}),g.jsx("span",{className:"text-xl sm:text-2xl",children:""})]}),g.jsxs("div",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white",children:["$",f.toLocaleString()]}),g.jsx("div",{className:"mt-2 h-1 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full"})]}),g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow p-4 sm:p-6",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("span",{className:"text-xs sm:text-sm font-medium text-slate-600 dark:text-slate-400",children:"Approved Work"}),g.jsx("span",{className:"text-xl sm:text-2xl",children:""})]}),g.jsxs("div",{className:"text-2xl sm:text-3xl font-bold text-green-600 dark:text-green-400",children:["$",p.toLocaleString()]}),g.jsx("div",{className:"mt-2 h-1 bg-gradient-to-r from-green-500 to-green-600 rounded-full"})]}),g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow p-4 sm:p-6",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("span",{className:"text-xs sm:text-sm font-medium text-slate-600 dark:text-slate-400",children:"Completed Work %"}),g.jsx("span",{className:"text-xl sm:text-2xl",children:""})]}),g.jsxs("div",{className:"text-2xl sm:text-3xl font-bold text-blue-600 dark:text-blue-400",children:[w.toFixed(1),"%"]}),g.jsx("div",{className:"mt-2 h-1 bg-gradient-to-r from-blue-400 to-blue-500 rounded-full",style:{width:`${Math.min(w,100)}%`}})]}),g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-shadow p-4 sm:p-6",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("span",{className:"text-xs sm:text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Draws"}),g.jsx("span",{className:"text-xl sm:text-2xl",children:""})]}),g.jsxs("div",{className:"text-2xl sm:text-3xl font-bold text-purple-600 dark:text-purple-400",children:["$",k.toLocaleString()]}),g.jsx("div",{className:"mt-2 h-1 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full"})]})]}),g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-4 sm:p-8",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4 sm:mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-900 dark:text-white",children:"Completed Work Progress"}),g.jsxs("p",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400 mt-1",children:[w.toFixed(1),"% of $110,000 work approved"]})]}),g.jsx("span",{className:"text-2xl sm:text-3xl flex-shrink-0",children:""})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("div",{className:"flex h-3 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:g.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-500",style:{width:`${Math.min(w,100)}%`}})}),g.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400 font-medium",children:[g.jsx("span",{children:"0%"}),g.jsx("span",{children:"70% (Draw Eligible)"}),g.jsx("span",{children:"100%"})]})]})]})]})}function TO({db:n,role:e}){const[t,r]=W.useState([]),[s,i]=W.useState(!1),[o,a]=W.useState(null),[u,c]=W.useState(""),[h,f]=W.useState(""),[p,w]=W.useState(""),[k,S]=W.useState("pending");W.useEffect(()=>{if(!n)return;const _=Xe(Ve(n,"tasks"),v=>{const E=[];v.forEach(b=>E.push({id:b.id,...b.data()})),r(E)});return()=>_()},[n]);const C=W.useMemo(()=>{const _={};return t.forEach(v=>{const E=v.phase||"Unassigned";_[E]||(_[E]=[]),_[E].push(v)}),_},[t]),A=(_,v)=>e==="site_manager"?_==="pending"&&v==="site_completed":e==="project_manager"?_==="pending"&&v==="site_completed"||_==="site_completed"&&v==="pm_approved":!1,x=async(_,v,E)=>{const b=t.find(R=>R.id===_);if(!b)return;const N=(b.subtasks||[]).map(R=>R.id===v?{...R,status:E}:R);n&&await Hr(ze(n,"tasks",_),{subtasks:N})},T=async(_,v)=>{e!=="portfolio_manager"&&n&&await Hr(ze(n,"tasks",_),{status:v})},P=async()=>{!n||!u||!h||(o?(await Hr(ze(n,"tasks",o),{title:u,phase:h,contractor:p,status:k}),a(null)):await go(Ve(n,"tasks"),{title:u,phase:h,contractor:p,status:k,subtasks:[]}),c(""),f(""),w(""),S("pending"),i(!1))},M=_=>{c(_.title||""),f(_.phase||""),w(_.contractor||""),S(_.status||"pending"),a(_.id),i(!0)},V=async _=>{!n||!window.confirm("Are you sure you want to delete this task?")||await Ud(ze(n,"tasks",_))},y=()=>{i(!1),a(null),c(""),f(""),w(""),S("pending")};return g.jsxs("div",{className:"grid gap-4 sm:gap-8",children:[g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg p-4 sm:p-8",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4 sm:mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-slate-900 dark:text-white",children:"Add New Task"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Create and manage project tasks"})]}),g.jsx("span",{className:"text-3xl sm:text-4xl flex-shrink-0",children:""})]}),!s&&g.jsx("button",{className:"w-full px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-lg hover:shadow-xl hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:()=>i(!0),children:"+ Add New Task"}),s&&g.jsxs("div",{className:"space-y-4 sm:space-y-5 bg-slate-50 dark:bg-slate-700 rounded-lg sm:rounded-xl p-4 sm:p-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Task Title *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Enter task title",value:u,onChange:_=>c(_.target.value)})]}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-5",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Phase *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"e.g., Phase 1",value:h,onChange:_=>f(_.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Contractor"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Contractor name",value:p,onChange:_=>w(_.target.value)})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Status"}),g.jsxs("select",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 font-medium transition-all text-sm sm:text-base",value:k,onChange:_=>S(_.target.value),children:[g.jsx("option",{value:"pending",children:" Pending"}),g.jsx("option",{value:"site_completed",children:" Site Completed"}),g.jsx("option",{value:"pm_approved",children:" PM Approved"})]})]}),g.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2 sm:pt-4",children:[g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:shadow-lg hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:P,children:o?"Update Task":"Create Task"}),g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:bg-slate-100 dark:hover:bg-slate-600 transition-all",onClick:y,children:"Cancel"})]})]})]}),g.jsx("div",{className:"space-y-3 sm:space-y-4",children:Object.entries(C).map(([_,v])=>g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[g.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-slate-50 dark:from-slate-700 to-blue-50 dark:to-slate-700",children:g.jsxs("h4",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2 text-sm sm:text-base",children:[g.jsx("span",{children:""})," ",_]})}),g.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:v.map(E=>g.jsxs("div",{className:"p-4 sm:p-6 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-start justify-between gap-3 mb-3 sm:mb-4",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("h5",{className:"font-semibold text-slate-900 dark:text-white text-sm sm:text-base break-words",children:E.title||E.id}),g.jsxs("div",{className:"flex gap-2 flex-wrap mt-2",children:[E.isNonDependency&&g.jsx("span",{className:"inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300",children:" Non-Dependency"}),E.lineItem&&g.jsxs("span",{className:"inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300",children:[" ",E.lineItem]}),E.contractor&&g.jsxs("span",{className:"inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300",children:[" ",E.contractor]}),E.approvedValue?g.jsxs("span",{className:"inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300",children:[" $",E.approvedValue.toLocaleString()]}):null,E.status&&g.jsx("span",{className:`inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium ${E.status==="pm_approved"?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":E.status==="site_completed"?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:E.status==="pm_approved"?" PM Approved":E.status==="site_completed"?" Site Completed":" Pending"})]})]}),g.jsxs("div",{className:"flex gap-2 w-full sm:w-auto flex-shrink-0",children:[g.jsx("button",{onClick:()=>M(E),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Edit task",children:" Edit"}),g.jsx("button",{onClick:()=>V(E.id),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Delete task",children:" Delete"})]})]}),g.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[(E.subtasks||[]).length===0&&g.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e!=="portfolio_manager"&&g.jsxs(g.Fragment,{children:[g.jsx("button",{className:"flex-1 px-3 sm:px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-xs sm:text-sm font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-all",onClick:()=>T(E.id,"site_completed"),children:"Mark Site Completed"}),e==="project_manager"&&g.jsx("button",{className:"flex-1 px-3 sm:px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-xs sm:text-sm font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-all",onClick:()=>T(E.id,"pm_approved"),children:"Approve"})]})}),(E.subtasks||[]).length>0&&g.jsx("div",{className:"space-y-2 bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4",children:(E.subtasks||[]).map(b=>g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3 bg-white dark:bg-slate-800 p-2 sm:p-3 rounded",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-xs sm:text-sm font-medium text-slate-900 dark:text-white break-words",children:b.title||b.id}),g.jsx("span",{className:"inline-block text-xs px-2 py-1 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 rounded mt-1",children:b.status||"pending"})]}),g.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-shrink-0",children:[A(b.status||"pending","site_completed")&&g.jsx("button",{className:"px-2 sm:px-3 py-1 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded text-xs font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-all",onClick:()=>x(E.id,b.id,"site_completed"),children:"Complete"}),A(b.status||"pending","pm_approved")&&g.jsx("button",{className:"px-2 sm:px-3 py-1 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded text-xs font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-all",onClick:()=>x(E.id,b.id,"pm_approved"),children:"Approve"})]})]},b.id))})]})]},E.id))})]},_))})]})}function bO({db:n,role:e}){const t={PROJECT_WORK_VALUE:11e4,TOTAL_SCHEDULED_DRAWS:127400,MONTHLY_INTEREST:2900,PROJECT_DURATION_MONTHS:6,PROPERTY_ADDRESS:"4821 Briscoe St & 4829 Briscoe St, Houston, TX 77033",PROJECT_NAME:"RED CARPET CONTRACTORS Project: Tech Camp 1"},[r,s]=W.useState({}),[i,o]=W.useState([]),[a,u]=W.useState([]),[c,h]=W.useState([]),[f,p]=W.useState(t),[w,k]=W.useState(!1),[S,C]=W.useState(!1),[A,x]=W.useState(null),[T,P]=W.useState(""),[M,V]=W.useState("");W.useEffect(()=>{if(!n)return;(async()=>{try{const ae=await Bg(ze(n,"config","prd"));ae.exists()&&p(ae.data())}catch(ae){console.error("Error loading PRD config:",ae)}})();const U=Xe(ze(n,"budget","totals"),ae=>{s(ae.exists()?ae.data():{})}),ne=Xe(Ve(n,"draws"),ae=>{const ge=[];ae.forEach(Re=>ge.push({id:Re.id,...Re.data()})),o(ge.sort((Re,_t)=>(Re.drawNumber||0)-(_t.drawNumber||0)))}),se=Xe(Ve(n,"tasks"),ae=>{const ge=[];ae.forEach(Re=>ge.push({id:Re.id,...Re.data()})),u(ge)}),Ee=Xe(Ve(n,"budgetLineItems"),ae=>{const ge=[];ae.forEach(Re=>ge.push({id:Re.id,...Re.data()})),h(ge.sort((Re,_t)=>(Re.name||"").localeCompare(_t.name||"")))});return()=>{U(),ne(),se(),Ee()}},[n]);const y=f.PROJECT_WORK_VALUE||11e4,_=a.reduce((J,U)=>J+(U.status==="pm_approved"&&U.approvedValue||0),0),v=y>0?_/y*100:0,E=v>=70;Math.max(...i.map(J=>J.drawNumber||0),0)+1;const b=async J=>{var _t;if(e!=="portfolio_manager"||!n)return;await Hr(ze(n,"draws",J.id),{status:"scheduled"}),J.taskAllocation&&J.taskAllocation*y;const U=a.filter(yt=>yt.status==="pm_approved"&&(yt.approvedValue||0)>0),ne=J.drawNumber||"?",se=((_t=J.amount)==null?void 0:_t.toLocaleString("en-US",{style:"currency",currency:"USD"}))||"$0",Ee=U.map(yt=>`- ${yt.name||`Task (${yt.phase})`}: $${(yt.approvedValue||0).toLocaleString()}`).join(`
`),ae=`Draw #${ne} Request - ${se}`,ge=`
Draw #${ne} Submission
Amount: ${se}
Completed Work Percentage: ${v.toFixed(1)}%

Approved Tasks:
${Ee||"None"}

Project Value: $${y.toLocaleString()}
Total Scheduled Draws: $${(f.TOTAL_SCHEDULED_DRAWS||127400).toLocaleString()}
Property: ${f.PROPERTY_ADDRESS||"4821 Briscoe St & 4829 Briscoe St, Houston, TX 77033"}
Project: ${f.PROJECT_NAME||"RED CARPET CONTRACTORS - Tech Camp 1"}
    `.trim(),Re=`mailto:bmegacoach1@gmail.com?subject=${encodeURIComponent(ae)}&body=${encodeURIComponent(ge)}`;window.location.href=Re},N=async J=>{e==="portfolio_manager"&&n&&await Hr(ze(n,"draws",J),{status:"disbursed"})},R=async()=>{!n||!T||(A?(await Hr(ze(n,"draws",A),{amount:parseFloat(T)}),x(null)):await go(Ve(n,"draws"),{amount:parseFloat(T),status:"pending"}),P(""),k(!1))},Ae=J=>{var U;P(((U=J.amount)==null?void 0:U.toString())||""),x(J.id),k(!0)},ot=async J=>{!n||!window.confirm("Are you sure you want to delete this draw request?")||await Ud(ze(n,"draws",J))},tt=()=>{k(!1),x(null),P("")};return g.jsxs("div",{className:"grid gap-4 sm:gap-8",children:[g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg p-4 sm:p-8",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4 sm:mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-slate-900 dark:text-white",children:"Add Draw Request"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Request project fund draws"})]}),g.jsx("span",{className:"text-3xl sm:text-4xl flex-shrink-0",children:""})]}),!w&&g.jsx("button",{className:"w-full px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-lg hover:shadow-xl hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:()=>k(!0),children:"+ Add Draw Request"}),w&&g.jsxs("div",{className:"space-y-4 sm:space-y-5 bg-slate-50 dark:bg-slate-700 rounded-lg sm:rounded-xl p-4 sm:p-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Draw Amount ($) *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",type:"number",placeholder:"Enter draw amount",value:T,onChange:J=>P(J.target.value)})]}),g.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2 sm:pt-4",children:[g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:shadow-lg hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:R,children:A?"Update Draw":"Create Draw"}),g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:bg-slate-100 dark:hover:bg-slate-600 transition-all",onClick:tt,children:"Cancel"})]})]})]}),g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[g.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-slate-50 dark:from-slate-700 to-blue-50 dark:to-slate-700",children:g.jsxs("h4",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2 text-sm sm:text-base",children:[g.jsx("span",{children:""})," Draw Requests"]})}),g.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:i.length===0?g.jsx("div",{className:"p-4 sm:p-6 text-xs sm:text-sm text-slate-500 dark:text-slate-400 text-center",children:"No draw requests yet"}):i.map(J=>{var U;return g.jsxs("div",{className:"p-4 sm:p-6 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-start justify-between gap-3 sm:gap-4 mb-3",children:[g.jsxs("div",{className:"flex-1",children:[g.jsx("h5",{className:"font-semibold text-slate-900 dark:text-white text-sm sm:text-base",children:"Draw Request"}),g.jsxs("p",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400 mt-1",children:["$",((U=J.amount)==null?void 0:U.toLocaleString())||0]})]}),g.jsxs("div",{className:"w-full sm:w-auto flex flex-col items-start sm:items-end gap-2 sm:gap-3",children:[g.jsx("span",{className:`inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs font-medium ${J.status==="disbursed"?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300":J.status==="scheduled"?"bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:J.status==="disbursed"?" Disbursed":J.status==="scheduled"?" Scheduled":" Pending"}),g.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[g.jsx("button",{onClick:()=>Ae(J),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Edit draw",children:" Edit"}),g.jsx("button",{onClick:()=>ot(J.id),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Delete draw",children:" Delete"})]})]})]}),e==="portfolio_manager"&&g.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[g.jsx("button",{className:"flex-1 px-3 sm:px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-xs font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",disabled:!E,onClick:()=>b(J),children:"Schedule Draw"}),g.jsx("button",{className:"flex-1 px-3 sm:px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-xs font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-all",onClick:()=>N(J.id),children:"Mark Disbursed"})]})]},J.id)})})]}),g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg p-4 sm:p-8",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4 sm:mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-slate-900 dark:text-white",children:"Budget Line Items"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Project budget breakdown and spending tracking"})]}),g.jsx("span",{className:"text-3xl sm:text-4xl flex-shrink-0",children:""})]}),c.length===0?g.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400 text-sm",children:"No budget line items yet. Run migration to populate."}):g.jsx("div",{className:"space-y-3 sm:space-y-4",children:c.map(J=>{const U=J.value&&J.value>0?(J.spent||0)/J.value*100:0;return g.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg sm:rounded-xl p-3 sm:p-4 hover:shadow-md transition-shadow",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3 mb-2",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("h5",{className:"font-semibold text-slate-900 dark:text-white text-xs sm:text-sm break-words",children:J.name}),g.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:["Spent: $",(J.spent||0).toLocaleString()," / $",(J.value||0).toLocaleString()]})]}),g.jsx("div",{className:"text-right flex-shrink-0",children:g.jsxs("span",{className:`text-sm sm:text-base font-bold ${U<=50?"text-green-600 dark:text-green-400":U<=90?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:[U.toFixed(1),"%"]})})]}),g.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2 sm:h-2.5 overflow-hidden",children:g.jsx("div",{className:`h-full rounded-full transition-all ${U<=50?"bg-gradient-to-r from-green-500 to-green-600":U<=90?"bg-gradient-to-r from-yellow-500 to-yellow-600":"bg-gradient-to-r from-red-500 to-red-600"}`,style:{width:`${Math.min(U,100)}%`}})}),g.jsxs("div",{className:"flex justify-between text-xs text-slate-600 dark:text-slate-400 mt-2",children:[g.jsxs("span",{children:["Remaining: $",((J.value||0)-(J.spent||0)).toLocaleString()]}),g.jsxs("span",{children:["Budget: $",(J.value||0).toLocaleString()]})]})]},J.id)})}),c.length>0&&g.jsx("div",{className:"mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-slate-200 dark:border-slate-700",children:g.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4",children:[g.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4",children:[g.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-medium",children:"Total Budget"}),g.jsxs("p",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-white mt-1",children:["$",c.reduce((J,U)=>J+(U.value||0),0).toLocaleString()]})]}),g.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4",children:[g.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-medium",children:"Total Spent"}),g.jsxs("p",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-white mt-1",children:["$",c.reduce((J,U)=>J+(U.spent||0),0).toLocaleString()]})]}),g.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4",children:[g.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-medium",children:"Remaining"}),g.jsxs("p",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-white mt-1",children:["$",(c.reduce((J,U)=>J+(U.value||0),0)-c.reduce((J,U)=>J+(U.spent||0),0)).toLocaleString()]})]})]})})]})]})}function SO({db:n,role:e}){const[t,r]=W.useState([]),[s,i]=W.useState(!1),[o,a]=W.useState(null),[u,c]=W.useState(""),[h,f]=W.useState(""),[p,w]=W.useState(""),[k,S]=W.useState(""),[C,A]=W.useState("");W.useEffect(()=>{if(!n)return;const y=Xe(Ve(n,"reports"),_=>{const v=[];_.forEach(E=>v.push({id:E.id,...E.data()})),r(v.sort((E,b)=>(b.createdAt||0)-(E.createdAt||0)))});return()=>y()},[n]);const x=y=>{var E;const _=(E=y.target.files)==null?void 0:E[0];if(!_)return;const v=new FileReader;v.onload=()=>S(String(v.result||"")),v.readAsDataURL(_)},T=async()=>{n&&(o?(await Hr(ze(n,"reports",o),{contractor:u,notes:h,materials:p,photoBase64:k,checklist:C,updatedAt:Date.now()}),a(null)):await go(Ve(n,"reports"),{contractor:u,notes:h,materials:p,photoBase64:k,checklist:C,createdAt:Date.now()}),c(""),f(""),w(""),S(""),A(""),i(!1))},P=y=>{c(y.contractor||""),f(y.notes||""),w(y.materials||""),S(y.photoBase64||""),A(y.checklist||""),a(y.id||null),i(!0)},M=async y=>{!n||!window.confirm("Are you sure you want to delete this report?")||await Ud(ze(n,"reports",y))},V=()=>{i(!1),a(null),c(""),f(""),w(""),S(""),A("")};return g.jsxs("div",{className:"grid gap-4 sm:gap-8",children:[g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg p-4 sm:p-8",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4 sm:mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-slate-900 dark:text-white",children:"Submit Daily Report"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Document site progress with photos and notes"})]}),g.jsx("span",{className:"text-3xl sm:text-4xl flex-shrink-0",children:""})]}),!s&&g.jsx("button",{className:"w-full px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-lg hover:shadow-xl hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:()=>i(!0),children:"+ New Report"}),s&&g.jsxs("div",{className:"space-y-4 sm:space-y-5 bg-slate-50 dark:bg-slate-700 rounded-lg sm:rounded-xl p-4 sm:p-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Contractor *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Contractor name",value:u,onChange:y=>c(y.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Daily Notes *"}),g.jsx("textarea",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 resize-none placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Daily notes and observations",rows:4,value:h,onChange:y=>f(y.target.value)})]}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-5",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Materials"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Materials used",value:p,onChange:y=>w(y.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Checklist"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Inspection checklist",value:C,onChange:y=>A(y.target.value)})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Photo"}),g.jsx("input",{type:"file",accept:"image/*",onChange:x,className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all file:mr-2 sm:file:mr-4 file:py-1 sm:file:py-2 file:px-2 sm:file:px-4 file:rounded-lg file:border-0 file:text-xs sm:file:text-sm file:font-semibold file:bg-blue-100 dark:file:bg-blue-900 file:text-blue-700 dark:file:text-blue-300 hover:file:bg-blue-200 dark:hover:file:bg-blue-800 text-xs sm:text-sm"})]}),g.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2 sm:pt-4",children:[g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:shadow-lg hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:T,children:o?"Update Report":"Submit Report"}),g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:bg-slate-100 dark:hover:bg-slate-600 transition-all",onClick:V,children:"Cancel"})]})]})]}),g.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-4 sm:mb-6",children:[g.jsx("span",{className:"text-2xl sm:text-3xl",children:""}),g.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-900 dark:text-white",children:"Recent Reports"})]}),t.length===0?g.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-6 sm:p-8 text-center text-slate-500 dark:text-slate-400 text-sm sm:text-base",children:"No reports yet"}):t.map(y=>g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[g.jsxs("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-slate-50 dark:from-slate-700 to-blue-50 dark:to-slate-700 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3",children:[g.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white text-sm sm:text-base",children:y.contractor||"Unknown"}),g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[g.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:y.createdAt?new Date(y.createdAt).toLocaleString():""}),g.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[g.jsx("button",{onClick:()=>P(y),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Edit report",children:" Edit"}),g.jsx("button",{onClick:()=>M(y.id||""),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Delete report",children:" Delete"})]})]})]}),g.jsxs("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:[y.photoBase64&&g.jsx("div",{className:"rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700",children:g.jsx("img",{src:y.photoBase64,alt:"report photo",className:"w-full h-40 sm:h-64 object-cover"})}),y.notes&&g.jsxs("div",{children:[g.jsx("p",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Notes"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-700 dark:text-slate-300",children:y.notes})]}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[y.materials&&g.jsxs("div",{children:[g.jsx("p",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Materials"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-700 dark:text-slate-300",children:y.materials})]}),y.checklist&&g.jsxs("div",{children:[g.jsx("p",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mb-1",children:"Checklist"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-700 dark:text-slate-300",children:y.checklist})]})]})]})]},y.id))]})]})}function kO({db:n}){const[e,t]=W.useState([]),[r,s]=W.useState([]),[i,o]=W.useState(!1),[a,u]=W.useState(null),[c,h]=W.useState(""),[f,p]=W.useState(""),[w,k]=W.useState(""),[S,C]=W.useState(""),[A,x]=W.useState("");W.useEffect(()=>{if(!n)return;const v=Xe(Ve(n,"contractors"),b=>{const N=[];b.forEach(R=>N.push({id:R.id,...R.data()})),t(N)}),E=Xe(Ve(n,"tasks"),b=>{const N=[];b.forEach(R=>N.push({id:R.id,...R.data()})),s(N)});return()=>{v(),E()}},[n]);const T=W.useMemo(()=>{const v={};return e.forEach(E=>{const b=E.phase||"Unassigned";v[b]||(v[b]=[]),v[b].push(E)}),v},[e]),P=v=>{const E=r.filter(N=>N.contractor===v);if(E.length===0)return 0;const b=E.filter(N=>N.status==="pm_approved").length;return Math.round(b/E.length*100)},M=async()=>{!n||!c||!w||(a?(await Hr(ze(n,"contractors",a),{name:c,description:f,phase:w,phone:S,email:A}),u(null)):await go(Ve(n,"contractors"),{name:c,description:f,phase:w,phone:S,email:A,status:"active"}),h(""),p(""),k(""),C(""),x(""),o(!1))},V=v=>{h(v.name||""),p(v.description||""),k(v.phase||""),C(v.phone||""),x(v.email||""),u(v.id),o(!0)},y=async v=>{!n||!window.confirm("Are you sure you want to delete this contractor?")||await Ud(ze(n,"contractors",v))},_=()=>{o(!1),u(null),h(""),p(""),k(""),C(""),x("")};return g.jsxs("div",{className:"grid gap-4 sm:gap-8",children:[g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg p-4 sm:p-8",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4 sm:mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-slate-900 dark:text-white",children:"Add New Contractor"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Manage project contractors and teams"})]}),g.jsx("span",{className:"text-3xl sm:text-4xl flex-shrink-0",children:""})]}),!i&&g.jsx("button",{className:"w-full px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-lg hover:shadow-xl hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:()=>o(!0),children:"+ Add New Contractor"}),i&&g.jsxs("div",{className:"space-y-4 sm:space-y-5 bg-slate-50 dark:bg-slate-700 rounded-lg sm:rounded-xl p-4 sm:p-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Name *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Contractor name",value:c,onChange:v=>h(v.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Description"}),g.jsx("textarea",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Brief description of contractor services",value:f,onChange:v=>p(v.target.value),rows:2})]}),g.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-5",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Phase *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"e.g., Phase 1",value:w,onChange:v=>k(v.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Phone"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Phone number",value:S,onChange:v=>C(v.target.value)})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Email"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"Email address",value:A,onChange:v=>x(v.target.value)})]}),g.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2 sm:pt-4",children:[g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:shadow-lg hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:M,children:a?"Update Contractor":"Create Contractor"}),g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:bg-slate-100 dark:hover:bg-slate-600 transition-all",onClick:_,children:"Cancel"})]})]})]}),g.jsx("div",{className:"space-y-3 sm:space-y-4",children:Object.entries(T).map(([v,E])=>g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[g.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-slate-50 dark:from-slate-700 to-blue-50 dark:to-slate-700",children:g.jsxs("h4",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2 text-sm sm:text-base",children:[g.jsx("span",{children:""})," ",v]})}),g.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:E.length===0?g.jsx("div",{className:"p-4 sm:p-6 text-xs sm:text-sm text-slate-500 dark:text-slate-400",children:"No contractors in this phase"}):E.map(b=>g.jsxs("div",{className:"p-4 sm:p-6 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-start justify-between gap-3 sm:gap-4 mb-3 sm:mb-4",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("h5",{className:"font-semibold text-slate-900 dark:text-white text-sm sm:text-base break-words",children:b.name||b.id}),b.description&&g.jsx("p",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400 mt-1",children:b.description}),g.jsxs("div",{className:"flex flex-col gap-1 mt-2 text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:[b.phone&&g.jsxs("span",{children:[" ",b.phone]}),b.email&&g.jsxs("span",{children:[" ",b.email]})]})]}),g.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3 flex-shrink-0",children:[g.jsxs("div",{className:"text-right",children:[g.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400",children:[P(b.name),"%"]}),g.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:"Completed"})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("button",{onClick:()=>V(b),className:"px-2 sm:px-3 py-1 sm:py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Edit contractor",children:" Edit"}),g.jsx("button",{onClick:()=>y(b.id),className:"px-2 sm:px-3 py-1 sm:py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Delete contractor",children:" Delete"})]})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("div",{className:"flex h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:g.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 transition-all",style:{width:`${P(b.name)}%`}})}),g.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400",children:[g.jsx("span",{children:"Progress"}),g.jsxs("span",{children:[P(b.name),"%"]})]})]})]},b.id))})]},v))})]})}function AO({db:n}){const[e,t]=W.useState([]),[r,s]=W.useState(!1),[i,o]=W.useState(null),[a,u]=W.useState(""),[c,h]=W.useState("");W.useEffect(()=>{if(!n)return;const S=Xe(ze(n,"media","links"),C=>{var x;const A=((x=C.data())==null?void 0:x.items)||[];t(Array.isArray(A)?A:[])});return()=>S()},[n]);const f=async()=>{if(!(!n||!a||!c))try{let S;if(i!==null)S=e.map(C=>C.id===i?{...C,name:a,link:c}:C),o(null);else{const C=Date.now().toString();S=[...e,{id:C,name:a,link:c}]}await Om(ze(n,"media","links"),{items:S},{merge:!0}),u(""),h(""),s(!1)}catch(S){console.error("Error adding media:",S)}},p=S=>{u(S.name),h(S.link),o(S.id),s(!0)},w=async S=>{if(!(!n||!window.confirm("Are you sure you want to delete this media?")))try{const C=e.filter(A=>A.id!==S);await Om(ze(n,"media","links"),{items:C},{merge:!0})}catch(C){console.error("Error removing media:",C)}},k=()=>{s(!1),o(null),u(""),h("")};return g.jsxs("div",{className:"grid gap-4 sm:gap-8",children:[g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg p-4 sm:p-8",children:[g.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-4 sm:mb-6",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-slate-900 dark:text-white",children:"Add Media Link"}),g.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Share project documents and resources"})]}),g.jsx("span",{className:"text-3xl sm:text-4xl flex-shrink-0",children:""})]}),!r&&g.jsx("button",{className:"w-full px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-lg hover:shadow-xl hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:()=>s(!0),children:"+ Add Link"}),r&&g.jsxs("div",{className:"space-y-4 sm:space-y-5 bg-slate-50 dark:bg-slate-700 rounded-lg sm:rounded-xl p-4 sm:p-6",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Media Type/Name *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"e.g., Project Photos, Site Video, Budget Report",value:a,onChange:S=>u(S.target.value)})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs sm:text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"Link URL *"}),g.jsx("input",{className:"w-full border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-600 rounded-lg sm:rounded-xl px-3 sm:px-4 py-2 sm:py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-400 font-medium transition-all text-sm sm:text-base",placeholder:"https://example.com",value:c,onChange:S=>h(S.target.value)})]}),g.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2 sm:pt-4",children:[g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:shadow-lg hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95",onClick:f,children:i!==null?"Update Media":"Add Media"}),g.jsx("button",{className:"flex-1 px-4 sm:px-6 py-2 sm:py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg sm:rounded-xl font-bold text-sm sm:text-base hover:bg-slate-100 dark:hover:bg-slate-600 transition-all",onClick:k,children:"Cancel"})]})]})]}),g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg sm:rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[g.jsx("div",{className:"px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-slate-50 dark:from-slate-700 to-blue-50 dark:to-slate-700",children:g.jsxs("h4",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2 text-sm sm:text-base",children:[g.jsx("span",{children:""})," Media Library"]})}),g.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:e.length===0?g.jsx("div",{className:"p-4 sm:p-6 text-center text-xs sm:text-sm text-slate-500 dark:text-slate-400",children:"No media links yet"}):e.map(S=>g.jsxs("div",{className:"p-4 sm:p-6 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"font-semibold text-slate-900 dark:text-white text-sm sm:text-base mb-2",children:S.name}),g.jsx("a",{className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 underline break-all text-xs sm:text-sm",href:S.link,target:"_blank",rel:"noreferrer",children:S.link})]}),g.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[g.jsx("button",{onClick:()=>p(S),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Edit media",children:" Edit"}),g.jsx("button",{onClick:()=>w(S.id),className:"flex-1 sm:flex-none px-2 sm:px-3 py-1 sm:py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-lg font-medium transition-colors text-xs sm:text-sm",title:"Delete media",children:" Delete"})]})]},S.id))})]})]})}function re(n,e,t,r,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function L(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}let $b=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return $b=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function Mm(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const Lm=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class ee extends Error{}class gt extends ee{constructor(e,t,r,s){super(`${gt.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.requestID=s==null?void 0:s.get("x-request-id"),this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Bd({message:r,cause:Lm(t)});const i=t==null?void 0:t.error;return e===400?new Bb(e,i,r,s):e===401?new zb(e,i,r,s):e===403?new qb(e,i,r,s):e===404?new Wb(e,i,r,s):e===409?new Kb(e,i,r,s):e===422?new Gb(e,i,r,s):e===429?new Hb(e,i,r,s):e>=500?new Qb(e,i,r,s):new gt(e,i,r,s)}}class hn extends gt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Bd extends gt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class qg extends Bd{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Bb extends gt{}class zb extends gt{}class qb extends gt{}class Wb extends gt{}class Kb extends gt{}class Gb extends gt{}class Hb extends gt{}class Qb extends gt{}class Jb extends ee{constructor(){super("Could not parse response content as the length limit was reached")}}class Xb extends ee{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class ta extends Error{constructor(e){super(e)}}const RO=/^[a-z][a-z0-9+.-]*:/i,PO=n=>RO.test(n);let Bt=n=>(Bt=Array.isArray,Bt(n)),sw=Bt;function Yb(n){return typeof n!="object"?{}:n??{}}function CO(n){if(!n)return!0;for(const e in n)return!1;return!0}function NO(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function sf(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}const DO=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ee(`${n} must be an integer`);if(e<0)throw new ee(`${n} must be a positive integer`);return e},VO=n=>{try{return JSON.parse(n)}catch{return}},El=n=>new Promise(e=>setTimeout(e,n)),pi="6.9.0",OO=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function MO(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const LO=()=>{var t;const n=MO();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":ow(Deno.build.os),"X-Stainless-Arch":iw(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":ow(globalThis.process.platform??"unknown"),"X-Stainless-Arch":iw(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=jO();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":pi,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function jO(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${s}.${i}.${o}`}}}return null}const iw=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",ow=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let aw;const FO=()=>aw??(aw=LO());function UO(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Zb(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function eS(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return Zb({start(){},async pull(t){const{done:r,value:s}=await e.next();r?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function tS(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function $O(n){var r,s;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((s=(r=n[Symbol.asyncIterator]()).return)==null?void 0:s.call(r));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const BO=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),nS="RFC3986",rS=n=>String(n),lw={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:rS},zO="RFC1738";let jm=(n,e)=>(jm=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),jm(n,e));const kn=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),of=1024,qO=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let o="";for(let a=0;a<i.length;a+=of){const u=i.length>=of?i.slice(a,a+of):i,c=[];for(let h=0;h<u.length;++h){let f=u.charCodeAt(h);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||s===zO&&(f===40||f===41)){c[c.length]=u.charAt(h);continue}if(f<128){c[c.length]=kn[f];continue}if(f<2048){c[c.length]=kn[192|f>>6]+kn[128|f&63];continue}if(f<55296||f>=57344){c[c.length]=kn[224|f>>12]+kn[128|f>>6&63]+kn[128|f&63];continue}h+=1,f=65536+((f&1023)<<10|u.charCodeAt(h)&1023),c[c.length]=kn[240|f>>18]+kn[128|f>>12&63]+kn[128|f>>6&63]+kn[128|f&63]}o+=c.join("")}return o};function WO(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function uw(n,e){if(Bt(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const sS={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},iS=function(n,e){Array.prototype.push.apply(n,Bt(e)?e:[e])};let cw;const Qe={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:qO,encodeValuesOnly:!1,format:nS,formatter:rS,indices:!1,serializeDate(n){return(cw??(cw=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function KO(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const af={};function oS(n,e,t,r,s,i,o,a,u,c,h,f,p,w,k,S,C,A){let x=n,T=A,P=0,M=!1;for(;(T=T.get(af))!==void 0&&!M;){const E=T.get(n);if(P+=1,typeof E<"u"){if(E===P)throw new RangeError("Cyclic object value");M=!0}typeof T.get(af)>"u"&&(P=0)}if(typeof c=="function"?x=c(e,x):x instanceof Date?x=p==null?void 0:p(x):t==="comma"&&Bt(x)&&(x=uw(x,function(E){return E instanceof Date?p==null?void 0:p(E):E})),x===null){if(i)return u&&!S?u(e,Qe.encoder,C,"key",w):e;x=""}if(KO(x)||WO(x)){if(u){const E=S?e:u(e,Qe.encoder,C,"key",w);return[(k==null?void 0:k(E))+"="+(k==null?void 0:k(u(x,Qe.encoder,C,"value",w)))]}return[(k==null?void 0:k(e))+"="+(k==null?void 0:k(String(x)))]}const V=[];if(typeof x>"u")return V;let y;if(t==="comma"&&Bt(x))S&&u&&(x=uw(x,u)),y=[{value:x.length>0?x.join(",")||null:void 0}];else if(Bt(c))y=c;else{const E=Object.keys(x);y=h?E.sort(h):E}const _=a?String(e).replace(/\./g,"%2E"):String(e),v=r&&Bt(x)&&x.length===1?_+"[]":_;if(s&&Bt(x)&&x.length===0)return v+"[]";for(let E=0;E<y.length;++E){const b=y[E],N=typeof b=="object"&&typeof b.value<"u"?b.value:x[b];if(o&&N===null)continue;const R=f&&a?b.replace(/\./g,"%2E"):b,Ae=Bt(x)?typeof t=="function"?t(v,R):v:v+(f?"."+R:"["+R+"]");A.set(n,P);const ot=new WeakMap;ot.set(af,A),iS(V,oS(N,Ae,t,r,s,i,o,a,t==="comma"&&S&&Bt(x)?null:u,c,h,f,p,w,k,S,C,ot))}return V}function GO(n=Qe){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||Qe.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=nS;if(typeof n.format<"u"){if(!jm(lw,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=lw[t];let s=Qe.filter;(typeof n.filter=="function"||Bt(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in sS?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=Qe.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:Qe.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:Qe.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:Qe.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:Qe.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?Qe.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:Qe.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:Qe.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:Qe.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:Qe.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:Qe.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:Qe.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:Qe.strictNullHandling}}function HO(n,e={}){let t=n;const r=GO(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):Bt(r.filter)&&(i=r.filter,s=i);const o=[];if(typeof t!="object"||t===null)return"";const a=sS[r.arrayFormat],u=a==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const c=new WeakMap;for(let p=0;p<s.length;++p){const w=s[p];r.skipNulls&&t[w]===null||iS(o,oS(t[w],w,a,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const h=o.join(r.delimiter);let f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),h.length>0?f+h:""}function QO(n){let e=0;for(const s of n)e+=s.length;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.length;return t}let dw;function Wg(n){let e;return(dw??(e=new globalThis.TextEncoder,dw=e.encode.bind(e)))(n)}let hw;function fw(n){let e;return(hw??(e=new globalThis.TextDecoder,hw=e.decode.bind(e)))(n)}var Jt,Xt;class zd{constructor(){Jt.set(this,void 0),Xt.set(this,void 0),re(this,Jt,new Uint8Array),re(this,Xt,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Wg(e):e;re(this,Jt,QO([L(this,Jt,"f"),t]));const r=[];let s;for(;(s=JO(L(this,Jt,"f"),L(this,Xt,"f")))!=null;){if(s.carriage&&L(this,Xt,"f")==null){re(this,Xt,s.index);continue}if(L(this,Xt,"f")!=null&&(s.index!==L(this,Xt,"f")+1||s.carriage)){r.push(fw(L(this,Jt,"f").subarray(0,L(this,Xt,"f")-1))),re(this,Jt,L(this,Jt,"f").subarray(L(this,Xt,"f"))),re(this,Xt,null);continue}const i=L(this,Xt,"f")!==null?s.preceding-1:s.preceding,o=fw(L(this,Jt,"f").subarray(0,i));r.push(o),re(this,Jt,L(this,Jt,"f").subarray(s.index)),re(this,Xt,null)}return r}flush(){return L(this,Jt,"f").length?this.decode(`
`):[]}}Jt=new WeakMap,Xt=new WeakMap;zd.NEWLINE_CHARS=new Set([`
`,"\r"]);zd.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function JO(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function XO(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}const qc={off:0,error:200,warn:300,info:400,debug:500},mw=(n,e,t)=>{if(n){if(NO(qc,n))return n;ut(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(qc))}`)}};function na(){}function fu(n,e,t){return!e||qc[n]>qc[t]?na:e[n].bind(e)}const YO={error:na,warn:na,info:na,debug:na};let pw=new WeakMap;function ut(n){const e=n.logger,t=n.logLevel??"off";if(!e)return YO;const r=pw.get(e);if(r&&r[0]===t)return r[1];const s={error:fu("error",e,t),warn:fu("warn",e,t),info:fu("info",e,t),debug:fu("debug",e,t)};return pw.set(e,[t,s]),s}const gs=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var Wo;class Dn{constructor(e,t,r){this.iterator=e,Wo.set(this,void 0),this.controller=t,re(this,Wo,r)}static fromSSEResponse(e,t,r){let s=!1;const i=r?ut(r):console;async function*o(){if(s)throw new ee("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const u of ZO(e,t))if(!a){if(u.data.startsWith("[DONE]")){a=!0;continue}if(u.event===null||!u.event.startsWith("thread.")){let c;try{c=JSON.parse(u.data)}catch(h){throw i.error("Could not parse message into JSON:",u.data),i.error("From chunk:",u.raw),h}if(c&&c.error)throw new gt(void 0,c.error,void 0,e.headers);yield c}else{let c;try{c=JSON.parse(u.data)}catch(h){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),h}if(u.event=="error")throw new gt(void 0,c.error,c.message,void 0);yield{event:u.event,data:c}}}a=!0}catch(u){if(Mm(u))return;throw u}finally{a||t.abort()}}return new Dn(o,t,r)}static fromReadableStream(e,t,r){let s=!1;async function*i(){const a=new zd,u=tS(e);for await(const c of u)for(const h of a.decode(c))yield h;for(const c of a.flush())yield c}async function*o(){if(s)throw new ee("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const u of i())a||u&&(yield JSON.parse(u));a=!0}catch(u){if(Mm(u))return;throw u}finally{a||t.abort()}}return new Dn(o,t,r)}[(Wo=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new Dn(()=>s(e),this.controller,L(this,Wo,"f")),new Dn(()=>s(t),this.controller,L(this,Wo,"f"))]}toReadableStream(){const e=this;let t;return Zb({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:s,done:i}=await t.next();if(i)return r.close();const o=Wg(JSON.stringify(s)+`
`);r.enqueue(o)}catch(s){r.error(s)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*ZO(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new ee("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new ee("Attempted to iterate over a response with no body");const t=new tM,r=new zd,s=tS(n.body);for await(const i of eM(s))for(const o of r.decode(i)){const a=t.decode(o);a&&(yield a)}for(const i of r.flush()){const o=t.decode(i);o&&(yield o)}}async function*eM(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Wg(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=XO(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}class tM{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=nM(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function nM(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function aS(n,e){const{response:t,requestLogID:r,retryOfRequestLogID:s,startTime:i}=e,o=await(async()=>{var f;if(e.options.stream)return ut(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):Dn.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const a=t.headers.get("content-type"),u=(f=a==null?void 0:a.split(";")[0])==null?void 0:f.trim();if((u==null?void 0:u.includes("application/json"))||(u==null?void 0:u.endsWith("+json"))){const p=await t.json();return lS(p,t)}return await t.text()})();return ut(n).debug(`[${r}] response parsed`,gs({retryOfRequestLogID:s,url:t.url,status:t.status,body:o,durationMs:Date.now()-i})),o}function lS(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var ra;class qd extends Promise{constructor(e,t,r=aS){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=r,ra.set(this,void 0),re(this,ra,e)}_thenUnwrap(e){return new qd(L(this,ra,"f"),this.responsePromise,async(t,r)=>lS(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(L(this,ra,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}ra=new WeakMap;var mu;class Kg{constructor(e,t,r,s){mu.set(this,void 0),re(this,mu,e),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new ee("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await L(this,mu,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(mu=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class rM extends qd{constructor(e,t,r){super(e,t,async(s,i)=>new r(s,i.response,await aS(s,i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Wd extends Kg{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Ge extends Kg{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var r;const e=this.getPaginatedItems(),t=(r=e[e.length-1])==null?void 0:r.id;return t?{...this.options,query:{...Yb(this.options.query),after:t}}:null}}class Wc extends Kg{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...Yb(this.options.query),after:e}}:null}}const uS=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ba(n,e,t){return uS(),new File(n,e??"unknown_file",t)}function Wu(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const Gg=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",gw=async(n,e)=>Fm(n.body)?{...n,body:await cS(n.body,e)}:n,Ks=async(n,e)=>({...n,body:await cS(n.body,e)}),_w=new WeakMap;function sM(n){const e=typeof n=="function"?n:n.fetch,t=_w.get(e);if(t)return t;const r=(async()=>{try{const s="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new s(i).text()}catch{return!0}})();return _w.set(e,r),r}const cS=async(n,e)=>{if(!await sM(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,s])=>Um(t,r,s))),t},dS=n=>n instanceof Blob&&"name"in n,iM=n=>typeof n=="object"&&n!==null&&(n instanceof Response||Gg(n)||dS(n)),Fm=n=>{if(iM(n))return!0;if(Array.isArray(n))return n.some(Fm);if(n&&typeof n=="object"){for(const e in n)if(Fm(n[e]))return!0}return!1},Um=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,ba([await t.blob()],Wu(t)));else if(Gg(t))n.append(e,ba([await new Response(eS(t)).blob()],Wu(t)));else if(dS(t))n.append(e,t,Wu(t));else if(Array.isArray(t))await Promise.all(t.map(r=>Um(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Um(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},hS=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",oM=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&hS(n),aM=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function lM(n,e,t){if(uS(),n=await n,oM(n))return n instanceof File?n:ba([await n.arrayBuffer()],n.name);if(aM(n)){const s=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),ba(await $m(s),e,t)}const r=await $m(n);if(e||(e=Wu(n)),!(t!=null&&t.type)){const s=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof s=="string"&&(t={...t,type:s})}return ba(r,e,t)}async function $m(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(hS(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(Gg(n))for await(const r of n)e.push(...await $m(r));else{const r=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof n}${r?`; constructor: ${r}`:""}${uM(n)}`)}return e}function uM(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}class Z{constructor(e){this._client=e}}function fS(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const yw=Object.freeze(Object.create(null)),cM=(n=fS)=>function(t,...r){if(t.length===1)return t[0];let s=!1;const i=[],o=t.reduce((h,f,p)=>{var S;/[?#]/.test(f)&&(s=!0);const w=r[p];let k=(s?encodeURIComponent:n)(""+w);return p!==r.length&&(w==null||typeof w=="object"&&w.toString===((S=Object.getPrototypeOf(Object.getPrototypeOf(w.hasOwnProperty??yw)??yw))==null?void 0:S.toString))&&(k=w+"",i.push({start:h.length+f.length,length:k.length,error:`Value of type ${Object.prototype.toString.call(w).slice(8,-1)} is not a valid path parameter`})),h+f+(p===r.length?"":k)},""),a=o.split(/[?#]/,1)[0],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=u.exec(a))!==null;)i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(i.sort((h,f)=>h.start-f.start),i.length>0){let h=0;const f=i.reduce((p,w)=>{const k=" ".repeat(w.start-h),S="^".repeat(w.length);return h=w.start+w.length,p+k+S},"");throw new ee(`Path parameters result in path with invalid segments:
${i.map(p=>p.error).join(`
`)}
${o}
${f}`)}return o},$=cM(fS);let mS=class extends Z{list(e,t={},r){return this._client.getAPIList($`/chat/completions/${e}/messages`,Ge,{query:t,...r})}};function Kc(n){return n!==void 0&&"function"in n&&n.function!==void 0}function Hg(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function Il(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function dM(n,e){return!e||!pS(e)?{...n,choices:n.choices.map(t=>(gS(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Qg(n,e)}function Qg(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new Jb;if(r.finish_reason==="content_filter")throw new Xb;return gS(r.message.tool_calls),{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>fM(e,i)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?hM(e,r.message.content):null}}});return{...n,choices:t}}function hM(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function fM(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return Kc(s)&&((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Il(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function mM(n,e){var r;if(!n||!("tools"in n)||!n.tools)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return Kc(s)&&((i=s.function)==null?void 0:i.name)===e.function.name});return Kc(t)&&(Il(t)||(t==null?void 0:t.function.strict)||!1)}function pS(n){var e;return Hg(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>Il(t)||t.type==="function"&&t.function.strict===!0))??!1}function gS(n){for(const e of n||[])if(e.type!=="function")throw new ee(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function pM(n){for(const e of n??[]){if(e.type!=="function")throw new ee(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ee(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Gc=n=>(n==null?void 0:n.role)==="assistant",_S=n=>(n==null?void 0:n.role)==="tool";var Bm,Ku,Gu,sa,ia,Hu,oa,Wn,aa,Hc,Qc,gi,yS;class Jg{constructor(){Bm.add(this),this.controller=new AbortController,Ku.set(this,void 0),Gu.set(this,()=>{}),sa.set(this,()=>{}),ia.set(this,void 0),Hu.set(this,()=>{}),oa.set(this,()=>{}),Wn.set(this,{}),aa.set(this,!1),Hc.set(this,!1),Qc.set(this,!1),gi.set(this,!1),re(this,Ku,new Promise((e,t)=>{re(this,Gu,e,"f"),re(this,sa,t,"f")})),re(this,ia,new Promise((e,t)=>{re(this,Hu,e,"f"),re(this,oa,t,"f")})),L(this,Ku,"f").catch(()=>{}),L(this,ia,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},L(this,Bm,"m",yS).bind(this))},0)}_connected(){this.ended||(L(this,Gu,"f").call(this),this._emit("connect"))}get ended(){return L(this,aa,"f")}get errored(){return L(this,Hc,"f")}get aborted(){return L(this,Qc,"f")}abort(){this.controller.abort()}on(e,t){return(L(this,Wn,"f")[e]||(L(this,Wn,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=L(this,Wn,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(L(this,Wn,"f")[e]||(L(this,Wn,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{re(this,gi,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){re(this,gi,!0),await L(this,ia,"f")}_emit(e,...t){if(L(this,aa,"f"))return;e==="end"&&(re(this,aa,!0),L(this,Hu,"f").call(this));const r=L(this,Wn,"f")[e];if(r&&(L(this,Wn,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!L(this,gi,"f")&&!(r!=null&&r.length)&&Promise.reject(s),L(this,sa,"f").call(this,s),L(this,oa,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!L(this,gi,"f")&&!(r!=null&&r.length)&&Promise.reject(s),L(this,sa,"f").call(this,s),L(this,oa,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Ku=new WeakMap,Gu=new WeakMap,sa=new WeakMap,ia=new WeakMap,Hu=new WeakMap,oa=new WeakMap,Wn=new WeakMap,aa=new WeakMap,Hc=new WeakMap,Qc=new WeakMap,gi=new WeakMap,Bm=new WeakSet,yS=function(e){if(re(this,Hc,!0),e instanceof Error&&e.name==="AbortError"&&(e=new hn),e instanceof hn)return re(this,Qc,!0),this._emit("abort",e);if(e instanceof ee)return this._emit("error",e);if(e instanceof Error){const t=new ee(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ee(String(e)))};function gM(n){return typeof n.parse=="function"}var Nt,zm,Jc,qm,Wm,Km,vS,wS;const _M=10;class xS extends Jg{constructor(){super(...arguments),Nt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),_S(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Gc(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ee("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),L(this,Nt,"m",zm).call(this)}async finalMessage(){return await this.done(),L(this,Nt,"m",Jc).call(this)}async finalFunctionToolCall(){return await this.done(),L(this,Nt,"m",qm).call(this)}async finalFunctionToolCallResult(){return await this.done(),L(this,Nt,"m",Wm).call(this)}async totalUsage(){return await this.done(),L(this,Nt,"m",Km).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=L(this,Nt,"m",Jc).call(this);t&&this._emit("finalMessage",t);const r=L(this,Nt,"m",zm).call(this);r&&this._emit("finalContent",r);const s=L(this,Nt,"m",qm).call(this);s&&this._emit("finalFunctionToolCall",s);const i=L(this,Nt,"m",Wm).call(this);i!=null&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",L(this,Nt,"m",Km).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),L(this,Nt,"m",vS).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Qg(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){var w,k,S;const s="tool",{tool_choice:i="auto",stream:o,...a}=t,u=typeof i!="string"&&i.type==="function"&&((w=i==null?void 0:i.function)==null?void 0:w.name),{maxChatCompletions:c=_M}=r||{},h=t.tools.map(C=>{if(Il(C)){if(!C.$callback)throw new ee("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:C.$callback,name:C.function.name,description:C.function.description||"",parameters:C.function.parameters,parse:C.$parseRaw,strict:!0}}}return C}),f={};for(const C of h)C.type==="function"&&(f[C.function.name||C.function.function.name]=C.function);const p="tools"in t?h.map(C=>C.type==="function"?{type:"function",function:{name:C.function.name||C.function.function.name,parameters:C.function.parameters,description:C.function.description,strict:C.function.strict}}:C):void 0;for(const C of t.messages)this._addMessage(C,!1);for(let C=0;C<c;++C){const x=(k=(await this._createChatCompletion(e,{...a,tool_choice:i,tools:p,messages:[...this.messages]},r)).choices[0])==null?void 0:k.message;if(!x)throw new ee("missing message in ChatCompletion response");if(!((S=x.tool_calls)!=null&&S.length))return;for(const T of x.tool_calls){if(T.type!=="function")continue;const P=T.id,{name:M,arguments:V}=T.function,y=f[M];if(y){if(u&&u!==M){const b=`Invalid tool_call: ${JSON.stringify(M)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:P,content:b});continue}}else{const b=`Invalid tool_call: ${JSON.stringify(M)}. Available options are: ${Object.keys(f).map(N=>JSON.stringify(N)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:P,content:b});continue}let _;try{_=gM(y)?await y.parse(V):V}catch(b){const N=b instanceof Error?b.message:String(b);this._addMessage({role:s,tool_call_id:P,content:N});continue}const v=await y.function(_,this),E=L(this,Nt,"m",wS).call(this,v);if(this._addMessage({role:s,tool_call_id:P,content:E}),u)return}}}}Nt=new WeakSet,zm=function(){return L(this,Nt,"m",Jc).call(this).content??null},Jc=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Gc(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new ee("stream ended without producing a ChatCompletionMessage with role=assistant")},qm=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Gc(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.filter(i=>i.type==="function").at(-1))==null?void 0:t.function}},Wm=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(_S(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Km=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},vS=function(e){if(e.n!=null&&e.n>1)throw new ee("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},wS=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Xg extends xS{static runTools(e,t,r){const s=new Xg,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Gc(e)&&e.content&&this._emit("content",e.content)}}const ES=1,IS=2,TS=4,bS=8,SS=16,kS=32,AS=64,RS=128,PS=256,CS=RS|PS,NS=SS|kS|CS|AS,DS=ES|IS|NS,VS=TS|bS,yM=DS|VS,nt={STR:ES,NUM:IS,ARR:TS,OBJ:bS,NULL:SS,BOOL:kS,NAN:AS,INFINITY:RS,MINUS_INFINITY:PS,INF:CS,SPECIAL:NS,ATOM:DS,COLLECTION:VS,ALL:yM};class vM extends Error{}class wM extends Error{}function xM(n,e=nt.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return EM(n.trim(),e)}const EM=(n,e)=>{const t=n.length;let r=0;const s=p=>{throw new vM(`${p} at position ${r}`)},i=p=>{throw new wM(`${p} at position ${r}`)},o=()=>(f(),r>=t&&s("Unexpected end of input"),n[r]==='"'?a():n[r]==="{"?u():n[r]==="["?c():n.substring(r,r+4)==="null"||nt.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||nt.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||nt.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||nt.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||nt.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||nt.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):h()),a=()=>{const p=r;let w=!1;for(r++;r<t&&(n[r]!=='"'||w&&n[r-1]==="\\");)w=n[r]==="\\"?!w:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(p,++r-Number(w)))}catch(k){i(String(k))}else if(nt.STR&e)try{return JSON.parse(n.substring(p,r-Number(w))+'"')}catch{return JSON.parse(n.substring(p,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,f();const p={};try{for(;n[r]!=="}";){if(f(),r>=t&&nt.OBJ&e)return p;const w=a();f(),r++;try{const k=o();Object.defineProperty(p,w,{value:k,writable:!0,enumerable:!0,configurable:!0})}catch(k){if(nt.OBJ&e)return p;throw k}f(),n[r]===","&&r++}}catch{if(nt.OBJ&e)return p;s("Expected '}' at end of object")}return r++,p},c=()=>{r++;const p=[];try{for(;n[r]!=="]";)p.push(o()),f(),n[r]===","&&r++}catch{if(nt.ARR&e)return p;s("Expected ']' at end of array")}return r++,p},h=()=>{if(r===0){n==="-"&&nt.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(w){if(nt.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(w))}}const p=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(nt.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(p,r))}catch{n.substring(p,r)==="-"&&nt.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(p,n.lastIndexOf("e")))}catch(k){i(String(k))}}},f=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return o()},vw=n=>xM(n,nt.ALL^nt.NUM);var He,qn,ai,wr,lf,pu,uf,cf,df,gu,hf,ww;class rl extends xS{constructor(e){super(),He.add(this),qn.set(this,void 0),ai.set(this,void 0),wr.set(this,void 0),re(this,qn,e),re(this,ai,[])}get currentChatCompletionSnapshot(){return L(this,wr,"f")}static fromReadableStream(e){const t=new rl(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new rl(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var o;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),L(this,He,"m",lf).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const a of i)L(this,He,"m",uf).call(this,a);if((o=i.controller.signal)!=null&&o.aborted)throw new hn;return this._addChatCompletion(L(this,He,"m",gu).call(this))}async _fromReadableStream(e,t){var o;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),L(this,He,"m",lf).call(this),this._connected();const s=Dn.fromReadableStream(e,this.controller);let i;for await(const a of s)i&&i!==a.id&&this._addChatCompletion(L(this,He,"m",gu).call(this)),L(this,He,"m",uf).call(this,a),i=a.id;if((o=s.controller.signal)!=null&&o.aborted)throw new hn;return this._addChatCompletion(L(this,He,"m",gu).call(this))}[(qn=new WeakMap,ai=new WeakMap,wr=new WeakMap,He=new WeakSet,lf=function(){this.ended||re(this,wr,void 0)},pu=function(t){let r=L(this,ai,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},L(this,ai,"f")[t.index]=r,r)},uf=function(t){var s,i,o,a,u,c,h,f,p,w,k,S,C,A,x;if(this.ended)return;const r=L(this,He,"m",ww).call(this,t);this._emit("chunk",t,r);for(const T of t.choices){const P=r.choices[T.index];T.delta.content!=null&&((s=P.message)==null?void 0:s.role)==="assistant"&&((i=P.message)!=null&&i.content)&&(this._emit("content",T.delta.content,P.message.content),this._emit("content.delta",{delta:T.delta.content,snapshot:P.message.content,parsed:P.message.parsed})),T.delta.refusal!=null&&((o=P.message)==null?void 0:o.role)==="assistant"&&((a=P.message)!=null&&a.refusal)&&this._emit("refusal.delta",{delta:T.delta.refusal,snapshot:P.message.refusal}),((u=T.logprobs)==null?void 0:u.content)!=null&&((c=P.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(h=T.logprobs)==null?void 0:h.content,snapshot:((f=P.logprobs)==null?void 0:f.content)??[]}),((p=T.logprobs)==null?void 0:p.refusal)!=null&&((w=P.message)==null?void 0:w.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(k=T.logprobs)==null?void 0:k.refusal,snapshot:((S=P.logprobs)==null?void 0:S.refusal)??[]});const M=L(this,He,"m",pu).call(this,P);P.finish_reason&&(L(this,He,"m",df).call(this,P),M.current_tool_call_index!=null&&L(this,He,"m",cf).call(this,P,M.current_tool_call_index));for(const V of T.delta.tool_calls??[])M.current_tool_call_index!==V.index&&(L(this,He,"m",df).call(this,P),M.current_tool_call_index!=null&&L(this,He,"m",cf).call(this,P,M.current_tool_call_index)),M.current_tool_call_index=V.index;for(const V of T.delta.tool_calls??[]){const y=(C=P.message.tool_calls)==null?void 0:C[V.index];y!=null&&y.type&&((y==null?void 0:y.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(A=y.function)==null?void 0:A.name,index:V.index,arguments:y.function.arguments,parsed_arguments:y.function.parsed_arguments,arguments_delta:((x=V.function)==null?void 0:x.arguments)??""}):(y==null||y.type,void 0))}}},cf=function(t,r){var o,a,u;if(L(this,He,"m",pu).call(this,t).done_tool_calls.has(r))return;const i=(o=t.message.tool_calls)==null?void 0:o[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const c=(u=(a=L(this,qn,"f"))==null?void 0:a.tools)==null?void 0:u.find(h=>Kc(h)&&h.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:Il(c)?c.$parseRaw(i.function.arguments):c!=null&&c.function.strict?JSON.parse(i.function.arguments):null})}else i.type},df=function(t){var s,i;const r=L(this,He,"m",pu).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const o=L(this,He,"m",hf).call(this);this._emit("content.done",{content:t.message.content,parsed:o?o.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},gu=function(){if(this.ended)throw new ee("stream has ended, this shouldn't happen");const t=L(this,wr,"f");if(!t)throw new ee("request ended without sending any chunks");return re(this,wr,void 0),re(this,ai,[]),IM(t,L(this,qn,"f"))},hf=function(){var r;const t=(r=L(this,qn,"f"))==null?void 0:r.response_format;return Hg(t)?t:null},ww=function(t){var r,s,i,o;let a=L(this,wr,"f");const{choices:u,...c}=t;a?Object.assign(a,c):a=re(this,wr,{...c,choices:[]});for(const{delta:h,finish_reason:f,index:p,logprobs:w=null,...k}of t.choices){let S=a.choices[p];if(S||(S=a.choices[p]={finish_reason:f,index:p,message:{},logprobs:w,...k}),w)if(!S.logprobs)S.logprobs=Object.assign({},w);else{const{content:V,refusal:y,..._}=w;Object.assign(S.logprobs,_),V&&((r=S.logprobs).content??(r.content=[]),S.logprobs.content.push(...V)),y&&((s=S.logprobs).refusal??(s.refusal=[]),S.logprobs.refusal.push(...y))}if(f&&(S.finish_reason=f,L(this,qn,"f")&&pS(L(this,qn,"f")))){if(f==="length")throw new Jb;if(f==="content_filter")throw new Xb}if(Object.assign(S,k),!h)continue;const{content:C,refusal:A,function_call:x,role:T,tool_calls:P,...M}=h;if(Object.assign(S.message,M),A&&(S.message.refusal=(S.message.refusal||"")+A),T&&(S.message.role=T),x&&(S.message.function_call?(x.name&&(S.message.function_call.name=x.name),x.arguments&&((i=S.message.function_call).arguments??(i.arguments=""),S.message.function_call.arguments+=x.arguments)):S.message.function_call=x),C&&(S.message.content=(S.message.content||"")+C,!S.message.refusal&&L(this,He,"m",hf).call(this)&&(S.message.parsed=vw(S.message.content))),P){S.message.tool_calls||(S.message.tool_calls=[]);for(const{index:V,id:y,type:_,function:v,...E}of P){const b=(o=S.message.tool_calls)[V]??(o[V]={});Object.assign(b,E),y&&(b.id=y),_&&(b.type=_),v&&(b.function??(b.function={name:v.name??"",arguments:""})),v!=null&&v.name&&(b.function.name=v.name),v!=null&&v.arguments&&(b.function.arguments+=v.arguments,mM(L(this,qn,"f"),b)&&(b.function.parsed_arguments=vw(b.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Dn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function IM(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:o,...a}=n,u={...a,id:t,choices:r.map(({message:c,finish_reason:h,index:f,logprobs:p,...w})=>{if(!h)throw new ee(`missing finish_reason for choice ${f}`);const{content:k=null,function_call:S,tool_calls:C,...A}=c,x=c.role;if(!x)throw new ee(`missing role for choice ${f}`);if(S){const{arguments:T,name:P}=S;if(T==null)throw new ee(`missing function_call.arguments for choice ${f}`);if(!P)throw new ee(`missing function_call.name for choice ${f}`);return{...w,message:{content:k,function_call:{arguments:T,name:P},role:x,refusal:c.refusal??null},finish_reason:h,index:f,logprobs:p}}return C?{...w,index:f,finish_reason:h,logprobs:p,message:{...A,role:x,content:k,refusal:c.refusal??null,tool_calls:C.map((T,P)=>{const{function:M,type:V,id:y,..._}=T,{arguments:v,name:E,...b}=M||{};if(y==null)throw new ee(`missing choices[${f}].tool_calls[${P}].id
${_u(n)}`);if(V==null)throw new ee(`missing choices[${f}].tool_calls[${P}].type
${_u(n)}`);if(E==null)throw new ee(`missing choices[${f}].tool_calls[${P}].function.name
${_u(n)}`);if(v==null)throw new ee(`missing choices[${f}].tool_calls[${P}].function.arguments
${_u(n)}`);return{..._,id:y,type:V,function:{...b,name:E,arguments:v}}})}}:{...w,message:{...A,content:k,role:x,refusal:c.refusal??null},finish_reason:h,index:f,logprobs:p}}),created:s,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}};return dM(u,e)}function _u(n){return JSON.stringify(n)}class Xc extends rl{static fromReadableStream(e){const t=new Xc(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){const s=new Xc(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let Yg=class extends Z{constructor(){super(...arguments),this.messages=new mS(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get($`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post($`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",Ge,{query:e,...t})}delete(e,t){return this._client.delete($`/chat/completions/${e}`,t)}parse(e,t){return pM(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>Qg(r,e))}runTools(e,t){return e.stream?Xc.runTools(this._client,e,t):Xg.runTools(this._client,e,t)}stream(e,t){return rl.createChatCompletion(this._client,e,t)}};Yg.Messages=mS;class Zg extends Z{constructor(){super(...arguments),this.completions=new Yg(this._client)}}Zg.Completions=Yg;const OS=Symbol("brand.privateNullableHeaders");function*TM(n){if(!n)return;if(OS in n){const{values:r,nulls:s}=n;yield*r.entries();for(const i of s)yield[i,null];return}let e=!1,t;n instanceof Headers?t=n.entries():sw(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){const s=r[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const i=sw(r[1])?r[1]:[r[1]];let o=!1;for(const a of i)a!==void 0&&(e&&!o&&(o=!0,yield[s,null]),yield[s,a])}}const Q=n=>{const e=new Headers,t=new Set;for(const r of n){const s=new Set;for(const[i,o]of TM(r)){const a=i.toLowerCase();s.has(a)||(e.delete(i),s.add(a)),o===null?(e.delete(i),t.add(a)):(e.append(i,o),t.delete(a))}}return{[OS]:!0,values:e,nulls:t}};class MS extends Z{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:Q([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class LS extends Z{create(e,t){return this._client.post("/audio/transcriptions",Ks({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class jS extends Z{create(e,t){return this._client.post("/audio/translations",Ks({body:e,...t,__metadata:{model:e.model}},this._client))}}class Tl extends Z{constructor(){super(...arguments),this.transcriptions=new LS(this._client),this.translations=new jS(this._client),this.speech=new MS(this._client)}}Tl.Transcriptions=LS;Tl.Translations=jS;Tl.Speech=MS;class FS extends Z{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get($`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",Ge,{query:e,...t})}cancel(e,t){return this._client.post($`/batches/${e}/cancel`,t)}}class US extends Z{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get($`/assistants/${e}`,{...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post($`/assistants/${e}`,{body:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/assistants",Ge,{query:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete($`/assistants/${e}`,{...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}let $S=class extends Z{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}};class BS extends Z{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}let Kd=class extends Z{constructor(){super(...arguments),this.sessions=new $S(this._client),this.transcriptionSessions=new BS(this._client)}};Kd.Sessions=$S;Kd.TranscriptionSessions=BS;class zS extends Z{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:Q([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}cancel(e,t){return this._client.post($`/chatkit/sessions/${e}/cancel`,{...t,headers:Q([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}}let qS=class extends Z{retrieve(e,t){return this._client.get($`/chatkit/threads/${e}`,{...t,headers:Q([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",Wc,{query:e,...t,headers:Q([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete($`/chatkit/threads/${e}`,{...t,headers:Q([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}listItems(e,t={},r){return this._client.getAPIList($`/chatkit/threads/${e}/items`,Wc,{query:t,...r,headers:Q([{"OpenAI-Beta":"chatkit_beta=v1"},r==null?void 0:r.headers])})}};class Gd extends Z{constructor(){super(...arguments),this.sessions=new zS(this._client),this.threads=new qS(this._client)}}Gd.Sessions=zS;Gd.Threads=qS;class WS extends Z{create(e,t,r){return this._client.post($`/threads/${e}/messages`,{body:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{thread_id:s}=t;return this._client.get($`/threads/${s}/messages/${e}`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:s,...i}=t;return this._client.post($`/threads/${s}/messages/${e}`,{body:i,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList($`/threads/${e}/messages`,Ge,{query:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{thread_id:s}=t;return this._client.delete($`/threads/${s}/messages/${e}`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class KS extends Z{retrieve(e,t,r){const{thread_id:s,run_id:i,...o}=t;return this._client.get($`/threads/${s}/runs/${i}/steps/${e}`,{query:o,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t,r){const{thread_id:s,...i}=t;return this._client.getAPIList($`/threads/${s}/runs/${e}/steps`,Ge,{query:i,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}const bM=n=>{if(typeof Buffer<"u"){const e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};var ff={};const li=n=>{var e,t,r,s;if(typeof globalThis.process<"u")return((e=ff==null?void 0:ff[n])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(s=(r=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:s.trim()};var ct,bs,Gm,Rn,Qu,wn,Ss,Ci,xs,Yc,Yt,Ju,Xu,Sa,la,ua,xw,Ew,Iw,Tw,bw,Sw,kw;class ka extends Jg{constructor(){super(...arguments),ct.add(this),Gm.set(this,[]),Rn.set(this,{}),Qu.set(this,{}),wn.set(this,void 0),Ss.set(this,void 0),Ci.set(this,void 0),xs.set(this,void 0),Yc.set(this,void 0),Yt.set(this,void 0),Ju.set(this,void 0),Xu.set(this,void 0),Sa.set(this,void 0)}[(Gm=new WeakMap,Rn=new WeakMap,Qu=new WeakMap,wn=new WeakMap,Ss=new WeakMap,Ci=new WeakMap,xs=new WeakMap,Yc=new WeakMap,Yt=new WeakMap,Ju=new WeakMap,Xu=new WeakMap,Sa=new WeakMap,ct=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new bs;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Dn.fromReadableStream(e,this.controller);for await(const o of s)L(this,ct,"m",la).call(this,o);if((i=s.controller.signal)!=null&&i.aborted)throw new hn;return this._addRun(L(this,ct,"m",ua).call(this))}toReadableStream(){return new Dn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s){const i=new bs;return i._run(()=>i._runToolAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},a=await e.submitToolOutputs(t,o,{...s,signal:this.controller.signal});this._connected();for await(const c of a)L(this,ct,"m",la).call(this,c);if((u=a.controller.signal)!=null&&u.aborted)throw new hn;return this._addRun(L(this,ct,"m",ua).call(this))}static createThreadAssistantStream(e,t,r){const s=new bs;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new bs;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return L(this,Ju,"f")}currentRun(){return L(this,Xu,"f")}currentMessageSnapshot(){return L(this,wn,"f")}currentRunStepSnapshot(){return L(this,Sa,"f")}async finalRunSteps(){return await this.done(),Object.values(L(this,Rn,"f"))}async finalMessages(){return await this.done(),Object.values(L(this,Qu,"f"))}async finalRun(){if(await this.done(),!L(this,Ss,"f"))throw Error("Final run was not received.");return L(this,Ss,"f")}async _createThreadAssistantStream(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},o=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const u of o)L(this,ct,"m",la).call(this,u);if((a=o.controller.signal)!=null&&a.aborted)throw new hn;return this._addRun(L(this,ct,"m",ua).call(this))}async _createAssistantStream(e,t,r,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},a=await e.create(t,o,{...s,signal:this.controller.signal});this._connected();for await(const c of a)L(this,ct,"m",la).call(this,c);if((u=a.controller.signal)!=null&&u.aborted)throw new hn;return this._addRun(L(this,ct,"m",ua).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(sf(i)&&sf(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(o=>typeof o=="string"||typeof o=="number")){i.push(...s);continue}for(const o of s){if(!sf(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const a=o.index;if(a==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);const u=i[a];u==null?i.push(o):i[a]=this.accumulateDelta(u,o)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s){return await this._createToolAssistantStream(t,e,r,s)}}bs=ka,la=function(e){if(!this.ended)switch(re(this,Ju,e),L(this,ct,"m",Iw).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":L(this,ct,"m",kw).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":L(this,ct,"m",Ew).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":L(this,ct,"m",xw).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ua=function(){if(this.ended)throw new ee("stream has ended, this shouldn't happen");if(!L(this,Ss,"f"))throw Error("Final run has not been received");return L(this,Ss,"f")},xw=function(e){const[t,r]=L(this,ct,"m",bw).call(this,e,L(this,wn,"f"));re(this,wn,t),L(this,Qu,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,o=t.content[s.index];if(o&&o.type=="text")this._emit("textDelta",i,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=L(this,Ci,"f")){if(L(this,xs,"f"))switch(L(this,xs,"f").type){case"text":this._emit("textDone",L(this,xs,"f").text,L(this,wn,"f"));break;case"image_file":this._emit("imageFileDone",L(this,xs,"f").image_file,L(this,wn,"f"));break}re(this,Ci,s.index)}re(this,xs,t.content[s.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(L(this,Ci,"f")!==void 0){const s=e.data.content[L(this,Ci,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,L(this,wn,"f"));break;case"text":this._emit("textDone",s.text,L(this,wn,"f"));break}}L(this,wn,"f")&&this._emit("messageDone",e.data),re(this,wn,void 0)}},Ew=function(e){const t=L(this,ct,"m",Tw).call(this,e);switch(re(this,Sa,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==L(this,Yc,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(L(this,Yt,"f")&&this._emit("toolCallDone",L(this,Yt,"f")),re(this,Yc,i.index),re(this,Yt,t.step_details.tool_calls[i.index]),L(this,Yt,"f")&&this._emit("toolCallCreated",L(this,Yt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":re(this,Sa,void 0),e.data.step_details.type=="tool_calls"&&L(this,Yt,"f")&&(this._emit("toolCallDone",L(this,Yt,"f")),re(this,Yt,void 0)),this._emit("runStepDone",e.data,t);break}},Iw=function(e){L(this,Gm,"f").push(e),this._emit("event",e)},Tw=function(e){switch(e.event){case"thread.run.step.created":return L(this,Rn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=L(this,Rn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=bs.accumulateDelta(t,r.delta);L(this,Rn,"f")[e.data.id]=s}return L(this,Rn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":L(this,Rn,"f")[e.data.id]=e.data;break}if(L(this,Rn,"f")[e.data.id])return L(this,Rn,"f")[e.data.id];throw new Error("No snapshot available")},bw=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let o=t.content[i.index];t.content[i.index]=L(this,ct,"m",Sw).call(this,i,o)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Sw=function(e,t){return bs.accumulateDelta(t,e)},kw=function(e){switch(re(this,Xu,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":re(this,Ss,e.data),L(this,Yt,"f")&&(this._emit("toolCallDone",L(this,Yt,"f")),re(this,Yt,void 0));break}};let e_=class extends Z{constructor(){super(...arguments),this.steps=new KS(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post($`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}retrieve(e,t,r){const{thread_id:s}=t;return this._client.get($`/threads/${s}/runs/${e}`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:s,...i}=t;return this._client.post($`/threads/${s}/runs/${e}`,{body:i,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList($`/threads/${e}/runs`,Ge,{query:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{thread_id:s}=t;return this._client.post($`/threads/${s}/runs/${e}/cancel`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(s.id,{thread_id:e},r)}createAndStream(e,t,r){return ka.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){var i;const s=Q([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const{data:o,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const h=parseInt(c);isNaN(h)||(u=h)}}await El(u);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,t,r){return ka.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){const{thread_id:s,...i}=t;return this._client.post($`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:i,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){const s=await this.submitToolOutputs(e,t,r);return await this.poll(s.id,t,r)}submitToolOutputsStream(e,t,r){return ka.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}};e_.Steps=KS;class Hd extends Z{constructor(){super(...arguments),this.runs=new e_(this._client),this.messages=new WS(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get($`/threads/${e}`,{...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post($`/threads/${e}`,{body:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t){return this._client.delete($`/threads/${e}`,{...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return ka.createThreadAssistantStream(e,this._client.beta.threads,t)}}Hd.Runs=e_;Hd.Messages=WS;class _o extends Z{constructor(){super(...arguments),this.realtime=new Kd(this._client),this.chatkit=new Gd(this._client),this.assistants=new US(this._client),this.threads=new Hd(this._client)}}_o.Realtime=Kd;_o.ChatKit=Gd;_o.Assistants=US;_o.Threads=Hd;class GS extends Z{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class HS extends Z{retrieve(e,t,r){const{container_id:s}=t;return this._client.get($`/containers/${s}/files/${e}/content`,{...r,headers:Q([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}}let t_=class extends Z{constructor(){super(...arguments),this.content=new HS(this._client)}create(e,t,r){return this._client.post($`/containers/${e}/files`,Ks({body:t,...r},this._client))}retrieve(e,t,r){const{container_id:s}=t;return this._client.get($`/containers/${s}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList($`/containers/${e}/files`,Ge,{query:t,...r})}delete(e,t,r){const{container_id:s}=t;return this._client.delete($`/containers/${s}/files/${e}`,{...r,headers:Q([{Accept:"*/*"},r==null?void 0:r.headers])})}};t_.Content=HS;class n_ extends Z{constructor(){super(...arguments),this.files=new t_(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get($`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",Ge,{query:e,...t})}delete(e,t){return this._client.delete($`/containers/${e}`,{...t,headers:Q([{Accept:"*/*"},t==null?void 0:t.headers])})}}n_.Files=t_;class QS extends Z{create(e,t,r){const{include:s,...i}=t;return this._client.post($`/conversations/${e}/items`,{query:{include:s},body:i,...r})}retrieve(e,t,r){const{conversation_id:s,...i}=t;return this._client.get($`/conversations/${s}/items/${e}`,{query:i,...r})}list(e,t={},r){return this._client.getAPIList($`/conversations/${e}/items`,Wc,{query:t,...r})}delete(e,t,r){const{conversation_id:s}=t;return this._client.delete($`/conversations/${s}/items/${e}`,r)}}class r_ extends Z{constructor(){super(...arguments),this.items=new QS(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get($`/conversations/${e}`,t)}update(e,t,r){return this._client.post($`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete($`/conversations/${e}`,t)}}r_.Items=QS;class JS extends Z{create(e,t){const r=!!e.encoding_format;let s=r?e.encoding_format:"base64";r&&ut(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?i:(ut(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(o=>(o&&o.data&&o.data.forEach(a=>{const u=a.embedding;a.embedding=bM(u)}),o)))}}class XS extends Z{retrieve(e,t,r){const{eval_id:s,run_id:i}=t;return this._client.get($`/evals/${s}/runs/${i}/output_items/${e}`,r)}list(e,t,r){const{eval_id:s,...i}=t;return this._client.getAPIList($`/evals/${s}/runs/${e}/output_items`,Ge,{query:i,...r})}}class s_ extends Z{constructor(){super(...arguments),this.outputItems=new XS(this._client)}create(e,t,r){return this._client.post($`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){const{eval_id:s}=t;return this._client.get($`/evals/${s}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList($`/evals/${e}/runs`,Ge,{query:t,...r})}delete(e,t,r){const{eval_id:s}=t;return this._client.delete($`/evals/${s}/runs/${e}`,r)}cancel(e,t,r){const{eval_id:s}=t;return this._client.post($`/evals/${s}/runs/${e}`,r)}}s_.OutputItems=XS;class i_ extends Z{constructor(){super(...arguments),this.runs=new s_(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get($`/evals/${e}`,t)}update(e,t,r){return this._client.post($`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",Ge,{query:e,...t})}delete(e,t){return this._client.delete($`/evals/${e}`,t)}}i_.Runs=s_;let YS=class extends Z{create(e,t){return this._client.post("/files",Ks({body:e,...t},this._client))}retrieve(e,t){return this._client.get($`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",Ge,{query:e,...t})}delete(e,t){return this._client.delete($`/files/${e}`,t)}content(e,t){return this._client.get($`/files/${e}/content`,{...t,headers:Q([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let o=await this.retrieve(e);for(;!o.status||!s.has(o.status);)if(await El(t),o=await this.retrieve(e),Date.now()-i>r)throw new qg({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return o}};class ZS extends Z{}let ek=class extends Z{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class o_ extends Z{constructor(){super(...arguments),this.graders=new ek(this._client)}}o_.Graders=ek;class tk extends Z{create(e,t,r){return this._client.getAPIList($`/fine_tuning/checkpoints/${e}/permissions`,Wd,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get($`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){const{fine_tuned_model_checkpoint:s}=t;return this._client.delete($`/fine_tuning/checkpoints/${s}/permissions/${e}`,r)}}let a_=class extends Z{constructor(){super(...arguments),this.permissions=new tk(this._client)}};a_.Permissions=tk;class nk extends Z{list(e,t={},r){return this._client.getAPIList($`/fine_tuning/jobs/${e}/checkpoints`,Ge,{query:t,...r})}}class l_ extends Z{constructor(){super(...arguments),this.checkpoints=new nk(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get($`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",Ge,{query:e,...t})}cancel(e,t){return this._client.post($`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList($`/fine_tuning/jobs/${e}/events`,Ge,{query:t,...r})}pause(e,t){return this._client.post($`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post($`/fine_tuning/jobs/${e}/resume`,t)}}l_.Checkpoints=nk;class yo extends Z{constructor(){super(...arguments),this.methods=new ZS(this._client),this.jobs=new l_(this._client),this.checkpoints=new a_(this._client),this.alpha=new o_(this._client)}}yo.Methods=ZS;yo.Jobs=l_;yo.Checkpoints=a_;yo.Alpha=o_;class rk extends Z{}class u_ extends Z{constructor(){super(...arguments),this.graderModels=new rk(this._client)}}u_.GraderModels=rk;class sk extends Z{createVariation(e,t){return this._client.post("/images/variations",Ks({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ks({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class ik extends Z{retrieve(e,t){return this._client.get($`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Wd,e)}delete(e,t){return this._client.delete($`/models/${e}`,t)}}class ok extends Z{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class ak extends Z{accept(e,t,r){return this._client.post($`/realtime/calls/${e}/accept`,{body:t,...r,headers:Q([{Accept:"*/*"},r==null?void 0:r.headers])})}hangup(e,t){return this._client.post($`/realtime/calls/${e}/hangup`,{...t,headers:Q([{Accept:"*/*"},t==null?void 0:t.headers])})}refer(e,t,r){return this._client.post($`/realtime/calls/${e}/refer`,{body:t,...r,headers:Q([{Accept:"*/*"},r==null?void 0:r.headers])})}reject(e,t={},r){return this._client.post($`/realtime/calls/${e}/reject`,{body:t,...r,headers:Q([{Accept:"*/*"},r==null?void 0:r.headers])})}}class lk extends Z{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class Qd extends Z{constructor(){super(...arguments),this.clientSecrets=new lk(this._client),this.calls=new ak(this._client)}}Qd.ClientSecrets=lk;Qd.Calls=ak;function SM(n,e){return!e||!AM(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:uk(n,e)}function uk(n,e){const t=n.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:CM(e,s)};if(s.type==="message"){const i=s.content.map(o=>o.type==="output_text"?{...o,parsed:kM(e,o.text)}:o);return{...s,content:i}}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||Hm(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const s of r.output)if(s.type==="message"){for(const i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function kM(n,e){var t,r,s,i;return((r=(t=n.text)==null?void 0:t.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((s=n.text)==null?void 0:s.format)?((i=n.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function AM(n){var e;return!!Hg((e=n.text)==null?void 0:e.format)}function RM(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function PM(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function CM(n,e){const t=PM(n.tools??[],e.name);return{...e,...e,parsed_arguments:RM(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function Hm(n){const e=[];for(const t of n.output)if(t.type==="message")for(const r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var ui,yu,xr,vu,Aw,Rw,Pw,Cw;class c_ extends Jg{constructor(e){super(),ui.add(this),yu.set(this,void 0),xr.set(this,void 0),vu.set(this,void 0),re(this,yu,e)}static createResponse(e,t,r){const s=new c_(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),L(this,ui,"m",Aw).call(this);let i,o=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),o=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const u of i)L(this,ui,"m",Rw).call(this,u,o);if((a=i.controller.signal)!=null&&a.aborted)throw new hn;return L(this,ui,"m",Pw).call(this)}[(yu=new WeakMap,xr=new WeakMap,vu=new WeakMap,ui=new WeakSet,Aw=function(){this.ended||re(this,xr,void 0)},Rw=function(t,r){if(this.ended)return;const s=(o,a)=>{(r==null||a.sequence_number>r)&&this._emit(o,a)},i=L(this,ui,"m",Cw).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{const o=i.output[t.output_index];if(!o)throw new ee(`missing output at index ${t.output_index}`);if(o.type==="message"){const a=o.content[t.content_index];if(!a)throw new ee(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new ee(`expected content to be 'output_text', got ${a.type}`);s("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const o=i.output[t.output_index];if(!o)throw new ee(`missing output at index ${t.output_index}`);o.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:o.arguments});break}default:s(t.type,t);break}},Pw=function(){if(this.ended)throw new ee("stream has ended, this shouldn't happen");const t=L(this,xr,"f");if(!t)throw new ee("request ended without sending any events");re(this,xr,void 0);const r=NM(t,L(this,yu,"f"));return re(this,vu,r),r},Cw=function(t){var s;let r=L(this,xr,"f");if(!r){if(t.type!=="response.created")throw new ee(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=re(this,xr,t.response),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{const i=r.output[t.output_index];if(!i)throw new ee(`missing output at index ${t.output_index}`);const o=i.type,a=t.part;o==="message"&&a.type!=="reasoning_text"?i.content.push(a):o==="reasoning"&&a.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(a));break}case"response.output_text.delta":{const i=r.output[t.output_index];if(!i)throw new ee(`missing output at index ${t.output_index}`);if(i.type==="message"){const o=i.content[t.content_index];if(!o)throw new ee(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new ee(`expected content to be 'output_text', got ${o.type}`);o.text+=t.delta}break}case"response.function_call_arguments.delta":{const i=r.output[t.output_index];if(!i)throw new ee(`missing output at index ${t.output_index}`);i.type==="function_call"&&(i.arguments+=t.delta);break}case"response.reasoning_text.delta":{const i=r.output[t.output_index];if(!i)throw new ee(`missing output at index ${t.output_index}`);if(i.type==="reasoning"){const o=(s=i.content)==null?void 0:s[t.content_index];if(!o)throw new ee(`missing content at index ${t.content_index}`);if(o.type!=="reasoning_text")throw new ee(`expected content to be 'reasoning_text', got ${o.type}`);o.text+=t.delta}break}case"response.completed":{re(this,xr,t.response);break}}return r},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=L(this,vu,"f");if(!e)throw new ee("stream ended without producing a ChatCompletion");return e}}function NM(n,e){return SM(n,e)}class ck extends Z{list(e,t={},r){return this._client.getAPIList($`/responses/${e}/input_items`,Ge,{query:t,...r})}}class dk extends Z{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class Jd extends Z{constructor(){super(...arguments),this.inputItems=new ck(this._client),this.inputTokens=new dk(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&Hm(r),r))}retrieve(e,t={},r){return this._client.get($`/responses/${e}`,{query:t,...r,stream:(t==null?void 0:t.stream)??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&Hm(s),s))}delete(e,t){return this._client.delete($`/responses/${e}`,{...t,headers:Q([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>uk(r,e))}stream(e,t){return c_.createResponse(this._client,e,t)}cancel(e,t){return this._client.post($`/responses/${e}/cancel`,t)}}Jd.InputItems=ck;Jd.InputTokens=dk;class hk extends Z{create(e,t,r){return this._client.post($`/uploads/${e}/parts`,Ks({body:t,...r},this._client))}}class d_ extends Z{constructor(){super(...arguments),this.parts=new hk(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post($`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post($`/uploads/${e}/complete`,{body:t,...r})}}d_.Parts=hk;const DM=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};class fk extends Z{create(e,t,r){return this._client.post($`/vector_stores/${e}/file_batches`,{body:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:s}=t;return this._client.get($`/vector_stores/${s}/file_batches/${e}`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{vector_store_id:s}=t;return this._client.post($`/vector_stores/${s}/file_batches/${e}/cancel`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r){const{vector_store_id:s,...i}=t;return this._client.getAPIList($`/vector_stores/${s}/file_batches/${e}/files`,Ge,{query:i,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async poll(e,t,r){var i;const s=Q([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const{data:o,response:a}=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse();switch(o.status){case"in_progress":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const h=parseInt(c);isNaN(h)||(u=h)}}await El(u);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,o=Math.min(i,t.length),a=this._client,u=t.values(),c=[...r];async function h(p){for(let w of p){const k=await a.files.create({file:w,purpose:"assistants"},s);c.push(k.id)}}const f=Array(o).fill(u).map(h);return await DM(f),await this.createAndPoll(e,{file_ids:c})}}class mk extends Z{create(e,t,r){return this._client.post($`/vector_stores/${e}/files`,{body:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:s}=t;return this._client.get($`/vector_stores/${s}/files/${e}`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{vector_store_id:s,...i}=t;return this._client.post($`/vector_stores/${s}/files/${e}`,{body:i,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList($`/vector_stores/${e}/files`,Ge,{query:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{vector_store_id:s}=t;return this._client.delete($`/vector_stores/${s}/files/${e}`,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){var i;const s=Q([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const o=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse(),a=o.data;switch(a.status){case"in_progress":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=o.response.headers.get("openai-poll-after-ms");if(c){const h=parseInt(c);isNaN(h)||(u=h)}}await El(u);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){const{vector_store_id:s}=t;return this._client.getAPIList($`/vector_stores/${s}/files/${e}/content`,Wd,{...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class Xd extends Z{constructor(){super(...arguments),this.files=new mk(this._client),this.fileBatches=new fk(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get($`/vector_stores/${e}`,{...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post($`/vector_stores/${e}`,{body:t,...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",Ge,{query:e,...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete($`/vector_stores/${e}`,{...t,headers:Q([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,r){return this._client.getAPIList($`/vector_stores/${e}/search`,Wd,{body:t,method:"post",...r,headers:Q([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}Xd.Files=mk;Xd.FileBatches=fk;class pk extends Z{create(e,t){return this._client.post("/videos",gw({body:e,...t},this._client))}retrieve(e,t){return this._client.get($`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",Wc,{query:e,...t})}delete(e,t){return this._client.delete($`/videos/${e}`,t)}downloadContent(e,t={},r){return this._client.get($`/videos/${e}/content`,{query:t,...r,headers:Q([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}remix(e,t,r){return this._client.post($`/videos/${e}/remix`,gw({body:t,...r},this._client))}}var _i,gk,Yu;class _k extends Z{constructor(){super(...arguments),_i.add(this)}async unwrap(e,t,r=this._client.webhookSecret,s=300){return await this.verifySignature(e,t,r,s),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");L(this,_i,"m",gk).call(this,r);const i=Q([t]).values,o=L(this,_i,"m",Yu).call(this,i,"webhook-signature"),a=L(this,_i,"m",Yu).call(this,i,"webhook-timestamp"),u=L(this,_i,"m",Yu).call(this,i,"webhook-id"),c=parseInt(a,10);if(isNaN(c))throw new ta("Invalid webhook timestamp format");const h=Math.floor(Date.now()/1e3);if(h-c>s)throw new ta("Webhook timestamp is too old");if(c>h+s)throw new ta("Webhook timestamp is too new");const f=o.split(" ").map(S=>S.startsWith("v1,")?S.substring(3):S),p=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),w=u?`${u}.${a}.${e}`:`${a}.${e}`,k=await crypto.subtle.importKey("raw",p,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const S of f)try{const C=Buffer.from(S,"base64");if(await crypto.subtle.verify("HMAC",k,C,new TextEncoder().encode(w)))return}catch{continue}throw new ta("The given webhook signature does not match the expected signature")}}_i=new WeakSet,gk=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Yu=function(e,t){if(!e)throw new Error("Headers are required");const r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var Qm,h_,Zu,yk;class ue{constructor({baseURL:e=li("OPENAI_BASE_URL"),apiKey:t=li("OPENAI_API_KEY"),organization:r=li("OPENAI_ORG_ID")??null,project:s=li("OPENAI_PROJECT_ID")??null,webhookSecret:i=li("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if(Qm.add(this),Zu.set(this,void 0),this.completions=new GS(this),this.chat=new Zg(this),this.embeddings=new JS(this),this.files=new YS(this),this.images=new sk(this),this.audio=new Tl(this),this.moderations=new ok(this),this.models=new ik(this),this.fineTuning=new yo(this),this.graders=new u_(this),this.vectorStores=new Xd(this),this.webhooks=new _k(this),this.beta=new _o(this),this.batches=new FS(this),this.uploads=new d_(this),this.responses=new Jd(this),this.realtime=new Qd(this),this.conversations=new r_(this),this.evals=new i_(this),this.containers=new n_(this),this.videos=new pk(this),t===void 0)throw new ee("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const a={apiKey:t,organization:r,project:s,webhookSecret:i,...o,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&OO())throw new ee(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=a.baseURL,this.timeout=a.timeout??h_.DEFAULT_TIMEOUT,this.logger=a.logger??console;const u="warn";this.logLevel=u,this.logLevel=mw(a.logLevel,"ClientOptions.logLevel",this)??mw(li("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??UO(),re(this,Zu,BO),this._options=a,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=r,this.project=s,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return Q([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return HO(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${pi}`}defaultIdempotencyKey(){return`stainless-node-retry-${$b()}`}makeStatusError(e,t,r,s){return gt.generate(e,t,r,s)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(r){throw r instanceof ee?r:new ee(`Failed to get token from 'apiKey' function: ${r.message}`,{cause:r})}if(typeof t!="string"||!t)throw new ee(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,r){const s=!L(this,Qm,"m",yk).call(this)&&r||this.baseURL,i=PO(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return CO(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new qd(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var A,x;const s=await e,i=s.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(s);const{req:o,url:a,timeout:u}=await this.buildRequest(s,{retryCount:i-t});await this.prepareRequest(o,{url:a,options:s});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),h=r===void 0?"":`, retryOf: ${r}`,f=Date.now();if(ut(this).debug(`[${c}] sending request`,gs({retryOfRequestLogID:r,method:s.method,url:a,options:s,headers:o.headers})),(A=s.signal)!=null&&A.aborted)throw new hn;const p=new AbortController,w=await this.fetchWithTimeout(a,o,u,p).catch(Lm),k=Date.now();if(w instanceof globalThis.Error){const T=`retrying, ${t} attempts remaining`;if((x=s.signal)!=null&&x.aborted)throw new hn;const P=Mm(w)||/timed? ?out/i.test(String(w)+("cause"in w?String(w.cause):""));if(t)return ut(this).info(`[${c}] connection ${P?"timed out":"failed"} - ${T}`),ut(this).debug(`[${c}] connection ${P?"timed out":"failed"} (${T})`,gs({retryOfRequestLogID:r,url:a,durationMs:k-f,message:w.message})),this.retryRequest(s,t,r??c);throw ut(this).info(`[${c}] connection ${P?"timed out":"failed"} - error; no more retries left`),ut(this).debug(`[${c}] connection ${P?"timed out":"failed"} (error; no more retries left)`,gs({retryOfRequestLogID:r,url:a,durationMs:k-f,message:w.message})),P?new qg:new Bd({cause:w})}const S=[...w.headers.entries()].filter(([T])=>T==="x-request-id").map(([T,P])=>", "+T+": "+JSON.stringify(P)).join(""),C=`[${c}${h}${S}] ${o.method} ${a} ${w.ok?"succeeded":"failed"} with status ${w.status} in ${k-f}ms`;if(!w.ok){const T=await this.shouldRetry(w);if(t&&T){const v=`retrying, ${t} attempts remaining`;return await $O(w.body),ut(this).info(`${C} - ${v}`),ut(this).debug(`[${c}] response error (${v})`,gs({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:k-f})),this.retryRequest(s,t,r??c,w.headers)}const P=T?"error; no more retries left":"error; not retryable";ut(this).info(`${C} - ${P}`);const M=await w.text().catch(v=>Lm(v).message),V=VO(M),y=V?void 0:M;throw ut(this).debug(`[${c}] response error (${P})`,gs({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,message:y,durationMs:Date.now()-f})),this.makeStatusError(w.status,V,y,w.headers)}return ut(this).info(C),ut(this).debug(`[${c}] response start`,gs({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:k-f})),{response:w,options:s,controller:p,requestLogID:c,retryOfRequestLogID:r,startTime:f}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){const r=this.makeRequest(t,null,void 0);return new rM(this,r,e)}async fetchWithTimeout(e,t,r,s){const{signal:i,method:o,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const u=setTimeout(()=>s.abort(),r),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,h={signal:s.signal,...c?{duplex:"half"}:{},method:"GET",...a};o&&(h.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(u)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,s){let i;const o=s==null?void 0:s.get("retry-after-ms");if(o){const u=parseFloat(o);Number.isNaN(u)||(i=u)}const a=s==null?void 0:s.get("retry-after");if(a&&!i){const u=parseFloat(a);Number.isNaN(u)?i=Date.parse(a)-Date.now():i=u*1e3}if(!(i&&0<=i&&i<60*1e3)){const u=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,u)}return await El(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){const r={...e},{method:s,path:i,query:o,defaultBaseURL:a}=r,u=this.buildURL(i,o,a);"timeout"in r&&DO("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:c,body:h}=this.buildBody({options:r}),f=await this.buildHeaders({options:e,method:s,bodyHeaders:c,retryCount:t});return{req:{method:s,headers:f,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"},...h&&{body:h},...this.fetchOptions??{},...r.fetchOptions??{}},url:u,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:s}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const o=Q([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...FO(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=Q([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:eS(e)}:L(this,Zu,"f").call(this,{body:e,headers:r})}}h_=ue,Zu=new WeakMap,Qm=new WeakSet,yk=function(){return this.baseURL!=="https://api.openai.com/v1"};ue.OpenAI=h_;ue.DEFAULT_TIMEOUT=6e5;ue.OpenAIError=ee;ue.APIError=gt;ue.APIConnectionError=Bd;ue.APIConnectionTimeoutError=qg;ue.APIUserAbortError=hn;ue.NotFoundError=Wb;ue.ConflictError=Kb;ue.RateLimitError=Hb;ue.BadRequestError=Bb;ue.AuthenticationError=zb;ue.InternalServerError=Qb;ue.PermissionDeniedError=qb;ue.UnprocessableEntityError=Gb;ue.InvalidWebhookSignatureError=ta;ue.toFile=lM;ue.Completions=GS;ue.Chat=Zg;ue.Embeddings=JS;ue.Files=YS;ue.Images=sk;ue.Audio=Tl;ue.Moderations=ok;ue.Models=ik;ue.FineTuning=yo;ue.Graders=u_;ue.VectorStores=Xd;ue.Webhooks=_k;ue.Beta=_o;ue.Batches=FS;ue.Uploads=d_;ue.Responses=Jd;ue.Realtime=Qd;ue.Conversations=r_;ue.Evals=i_;ue.Containers=n_;ue.Videos=pk;function VM({db:n,role:e}){const[t,r]=W.useState([]),[s,i]=W.useState([]),[o,a]=W.useState([]),[u,c]=W.useState([]),[h,f]=W.useState([]),[p,w]=W.useState(""),[k,S]=W.useState(!1);W.useEffect(()=>{if(!n)return;const P=Xe(Ve(n,"tasks"),E=>{const b=[];E.forEach(N=>b.push({id:N.id,...N.data()})),r(b)}),M=Xe(Ve(n,"reports"),E=>{const b=[];E.forEach(N=>b.push({id:N.id,...N.data()})),i(b)}),V=Xe(Ve(n,"contractors"),E=>{const b=[];E.forEach(N=>b.push({id:N.id,...N.data()})),a(b)}),y=Xe(Ve(n,"budget"),E=>{const b=[];E.forEach(N=>b.push({id:N.id,...N.data()})),c(b)}),_=pO(Ve(n,"chatHistory"),gO("timestamp","asc")),v=Xe(_,E=>{const b=[];E.forEach(N=>{var Ae,ot;const R=N.data();b.push({role:R.role,content:R.content,timestamp:((ot=(Ae=R.timestamp)==null?void 0:Ae.toMillis)==null?void 0:ot.call(Ae))||Date.now()})}),f(b)});return()=>{P(),M(),V(),y(),v()}},[n]);const C=(P,M)=>{const V=M.toLowerCase().split(/\s+/),y=P.toLowerCase();let _=0;return V.forEach(v=>{if(v.length>2){const E=(y.match(new RegExp(v,"g"))||[]).length;_+=E}}),_},A=P=>{const M=[];return t.forEach(V=>{const y=`Task: ${V.title||""} | Contractor: ${V.contractor||""} | Status: ${V.status||""} | Description: ${V.description||""}`,_=C(y,P);_>0&&M.push({id:V.id,type:"task",content:y,relevanceScore:_})}),s.forEach(V=>{const y=`Report: ${V.title||""} | Date: ${V.date||""} | Content: ${V.content||""}`,_=C(y,P);_>0&&M.push({id:V.id,type:"report",content:y,relevanceScore:_})}),o.forEach(V=>{const y=`Contractor: ${V.name||""} | Trade: ${V.trade||""} | Contact: ${V.contact||""}`,_=C(y,P);_>0&&M.push({id:V.id,type:"contractor",content:y,relevanceScore:_})}),u.forEach(V=>{const y=`Budget Item: ${V.item||""} | Amount: ${V.amount||""} | Status: ${V.status||""}`,_=C(y,P);_>0&&M.push({id:V.id,type:"budget",content:y,relevanceScore:_})}),M.sort((V,y)=>(y.relevanceScore||0)-(V.relevanceScore||0)).slice(0,10)},x=async(P,M)=>{if(n)try{await go(Ve(n,"chatHistory"),{role:P,content:M,timestamp:wO(),userRole:P==="user"?P:null})}catch(V){console.error("Failed to save message:",V)}},T=async()=>{var M,V,y;if(!p.trim())return;S(!0);const P={role:"user",content:p,timestamp:Date.now()};f(_=>[..._,P]),await x("user",p),w("");try{const _=A(p),v=new ue({baseURL:"https://api.llm7.io/v1",apiKey:"unused",dangerouslyAllowBrowser:!0}),E=`Project Status:
- Total Tasks: ${t.length}
- Completed Tasks: ${t.filter(tt=>tt.status==="pm_approved").length}
- In Progress: ${t.filter(tt=>tt.status==="waiting_pm_approval").length}
- Not Started: ${t.filter(tt=>tt.status==="not_started").length}
- Daily Reports Submitted: ${s.length}
- Active Contractors: ${o.length}
- Budget Items: ${u.length}`,b=_.length>0?`
Relevant Information from Database:
${_.map((tt,J)=>`${J+1}. [${tt.type.toUpperCase()}] ${tt.content}`).join(`
`)}`:`
No specific relevant documents found in database.`,N=`${E}${b}

User Role: ${e}
User Question: ${p}`;console.log("Calling llm7 API with RAG context..."),console.log("Retrieved documents:",_.length);const R=await v.chat.completions.create({model:"gpt-4.1-2025-04-14",messages:[{role:"user",content:N}]});console.log("Response:",R);const Ae=((y=(V=(M=R.choices)==null?void 0:M[0])==null?void 0:V.message)==null?void 0:y.content)||"No response received from API",ot={role:"assistant",content:Ae,timestamp:Date.now()};f(tt=>[...tt,ot]),await x("assistant",Ae)}catch(_){const v=_ instanceof Error?_.message:"Unknown error";console.error("Error:",v);const E={role:"assistant",content:` Error: ${v}`,timestamp:Date.now()};f(b=>[...b,E]),await x("assistant",` Error: ${v}`)}S(!1)};return g.jsx("div",{className:"grid grid-cols-1 gap-8 h-[calc(100vh-180px)]",children:g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg overflow-hidden flex flex-col",children:[g.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6",children:[g.jsx("h3",{className:"text-2xl font-bold text-white",children:"Ask Gemini "}),g.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Get AI insights about your project"})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[h.length===0?g.jsx("div",{className:"flex items-center justify-center h-full text-center",children:g.jsxs("div",{children:[g.jsx("div",{className:"text-5xl mb-4",children:""}),g.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:"Ask me anything about your construction project"}),g.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-2",children:"Tasks, reports, timeline, progress, and more"})]})}):h.map((P,M)=>g.jsx("div",{className:`flex ${P.role==="user"?"justify-end":"justify-start"}`,children:g.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-3 rounded-xl ${P.role==="user"?"bg-blue-600 text-white rounded-br-none":"bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100 rounded-bl-none"}`,children:[g.jsx("p",{className:"text-sm whitespace-pre-wrap",children:P.content}),g.jsx("span",{className:"text-xs opacity-70 mt-1 block",children:new Date(P.timestamp).toLocaleTimeString()})]})},M)),k&&g.jsx("div",{className:"flex justify-start",children:g.jsx("div",{className:"bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100 px-4 py-3 rounded-xl rounded-bl-none",children:g.jsxs("div",{className:"flex gap-2",children:[g.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),g.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),g.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})})]}),g.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 p-6 bg-slate-50 dark:bg-slate-900",children:g.jsxs("div",{className:"flex gap-3",children:[g.jsx("input",{className:"flex-1 border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20 focus:border-blue-500 placeholder-slate-400 dark:placeholder-slate-500 font-medium",placeholder:"Ask about tasks, reports, progress...",value:p,onChange:P=>w(P.target.value),onKeyPress:P=>P.key==="Enter"&&!k&&T(),disabled:k}),g.jsx("button",{onClick:T,disabled:k||!p.trim(),className:"px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 disabled:from-slate-400 disabled:to-slate-500 text-white rounded-xl font-bold hover:shadow-lg hover:shadow-blue-200 dark:hover:shadow-blue-900 transition-all active:scale-95 disabled:cursor-not-allowed",children:k?"":""})]})})]})})}function OM({db:n,role:e}){var k,S;const[t,r]=W.useState([]),[s,i]=W.useState([]),[o,a]=W.useState(""),[u,c]=W.useState(!1),[h,f]=W.useState("");W.useEffect(()=>{if(!n)return;const C=Xe(Ve(n,"tasks"),x=>{const T=[];x.forEach(P=>T.push({id:P.id,...P.data()})),r(T)}),A=Xe(Ve(n,"reports"),x=>{const T=[];x.forEach(P=>T.push({id:P.id,...P.data()})),i(T)});return()=>{C(),A()}},[n]);const p=async C=>{var A,x,T;c(!0),f(C),a("");try{const P=new ue({baseURL:"https://api.llm7.io/v1",apiKey:"unused",dangerouslyAllowBrowser:!0});let M="";if(C==="reminders"){const _=t.filter(v=>v.status!=="pm_approved");M=`Generate 3-4 professional contractor reminder messages for these overdue tasks:
${JSON.stringify(_.slice(0,5).map(v=>({contractor:v.contractor||"Unknown",title:v.title||v.id})),null,2)}

Make them professional, courteous, and action-oriented.`}else if(C==="update"){const _=t.filter(E=>E.status==="pm_approved").length,v=t.length;M=`Write a professional 2-3 paragraph stakeholder update email for a construction project with the following progress:
- ${_}/${v} tasks approved (${Math.round(_/v*100)}% complete)
- ${s.length} daily reports submitted
- Make it positive, professional, and include next steps.`}else if(C==="risk"){const _=t.filter(b=>b.status!=="pm_approved"),v=t.length,E=v>0?Math.round(_.length/v*100):0;M=`Analyze schedule risks for a construction project where ${_.length}/${v} tasks are not yet approved (${E}% remaining). Provide:
1. Risk assessment
2. Potential impacts
3. 3-4 mitigation strategies`}console.log("Calling llm7 API...");const V=await P.chat.completions.create({model:"gpt-4o-mini-2024-07-18",messages:[{role:"user",content:M}]});console.log("Response:",V);const y=((T=(x=(A=V.choices)==null?void 0:A[0])==null?void 0:x.message)==null?void 0:T.content)||"No response received";a(y)}catch(P){const M=P instanceof Error?P.message:"Unknown error";console.error("Error:",M),a(` Error: ${M}`)}c(!1)},w=[{key:"reminders",label:"Contractor Reminders",icon:"",color:"from-orange-600 to-orange-700"},{key:"update",label:"Stakeholder Update",icon:"",color:"from-purple-600 to-purple-700"},{key:"risk",label:"Risk Analysis",icon:"",color:"from-red-600 to-red-700"}];return g.jsxs("div",{className:"grid gap-8",children:[g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:w.map(C=>g.jsxs("button",{onClick:()=>p(C.key),disabled:u,className:`bg-gradient-to-br ${C.color} rounded-2xl p-8 text-white hover:shadow-xl hover:shadow-slate-400 dark:hover:shadow-slate-900 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed group`,children:[g.jsx("div",{className:"text-4xl mb-3 group-hover:scale-110 transition-transform",children:C.icon}),g.jsx("h3",{className:"font-bold text-lg",children:C.label}),g.jsxs("p",{className:"text-sm opacity-90 mt-2",children:["Generate professional ",C.label.toLowerCase()]})]},C.key))}),o&&g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg overflow-hidden",children:[g.jsxs("div",{className:"bg-gradient-to-r from-slate-100 dark:from-slate-700 to-slate-50 dark:to-slate-800 px-8 py-6 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:(k=w.find(C=>C.key===h))==null?void 0:k.label}),g.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"AI-generated content"})]}),g.jsx("span",{className:"text-4xl",children:(S=w.find(C=>C.key===h))==null?void 0:S.icon})]}),g.jsxs("div",{className:"p-8",children:[g.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-xl p-6 text-slate-900 dark:text-slate-100 whitespace-pre-wrap text-sm leading-relaxed font-medium border border-slate-200 dark:border-slate-700",children:o}),g.jsx("button",{onClick:()=>{navigator.clipboard.writeText(o),alert("Copied to clipboard!")},className:"mt-6 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all active:scale-95",children:" Copy to Clipboard"})]})]}),u&&g.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border-2 border-slate-200 dark:border-slate-700 shadow-lg p-8 flex items-center justify-center gap-4",children:[g.jsxs("div",{className:"flex gap-2",children:[g.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full animate-bounce"}),g.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),g.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]}),g.jsx("span",{className:"text-slate-700 dark:text-slate-300 font-bold",children:"Generating content..."})]})]})}const MM={PROJECT_WORK_VALUE:11e4,TOTAL_SCHEDULED_DRAWS:127400,MONTHLY_INTEREST:2900,PROJECT_DURATION_MONTHS:6,PROPERTY_ADDRESS:"4821 Briscoe St & 4829 Briscoe St, Houston, TX 77033",PROJECT_NAME:"RED CARPET CONTRACTORS Project: Tech Camp 1"},LM=[{drawNumber:1,taskAllocation:.4,interestMonths:2,amount:49800},{drawNumber:2,taskAllocation:.35,interestMonths:1.33,amount:29466.67},{drawNumber:3,taskAllocation:.25,interestMonths:1.33,amount:24966.67},{drawNumber:4,taskAllocation:1,interestMonths:1.33,amount:23166.66}],jM=async n=>{if(n)try{const e=ze(n,"config","prd");if((await Bg(e)).exists()||await Om(e,MM),(await vO(Ve(n,"draws"))).empty)for(const s of LM)await go(Ve(n,"draws"),{...s,status:"not_scheduled"})}catch(e){console.error("Error initializing PRD data:",e)}},FM=[{key:"dashboard",label:"Dashboard"},{key:"tasks",label:"Tasks"},{key:"budget",label:"Budget & Draws"},{key:"reports",label:"Daily Reports"},{key:"contractors",label:"Contractors"},{key:"media",label:"Pictures & Videos"},{key:"ask",label:"Ask Gemini"},{key:"pro",label:"Gemini Pro"}];function UM(){const[n,e]=W.useState("dashboard"),[t,r]=W.useState("site_manager"),[s,i]=W.useState(!0),[o,a]=W.useState(!1),{theme:u,toggleTheme:c}=EO(),h=W.useMemo(()=>({apiKey:"AIzaSyALLCpmX9jtAHNVKdCkK53ZG_-Osav4PYI",authDomain:"tech-camp-construction-project.firebaseapp.com",projectId:"tech-camp-construction-project",storageBucket:"tech-camp-construction-project.firebasestorage.app",messagingSenderId:"8702531655",appId:"1:8702531655:web:fbe635528823cebfb23962"}),[]),f=!!(h.apiKey&&h.projectId),p=W.useMemo(()=>f?tI(h):null,[f,h]),w=W.useMemo(()=>p?YN(p):null,[p]),k=W.useMemo(()=>p?sO(p):null,[p]);return W.useEffect(()=>{w?(O1(w).catch(()=>{}),$1(w,()=>a(!0))):a(!0),k&&(iO(k).catch(()=>{}),jM(k));const S=()=>i(navigator.onLine);return S(),window.addEventListener("online",S),window.addEventListener("offline",S),()=>{window.removeEventListener("online",S),window.removeEventListener("offline",S)}},[w,k]),g.jsxs("div",{className:`min-h-screen bg-white dark:bg-slate-950 ${u==="dark"?"dark":""}`,children:[g.jsx("style",{children:`
        :root {
          color-scheme: ${u==="dark"?"dark":"light"};
        }
      `}),g.jsxs("header",{className:"sticky top-0 z-10 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 shadow-sm",children:[g.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 py-3 sm:py-4 flex items-center gap-3 sm:gap-6",children:[g.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[g.jsx("div",{className:"w-8 sm:w-10 h-8 sm:h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center flex-shrink-0",children:g.jsx("span",{className:"text-white font-bold text-base sm:text-lg",children:""})}),g.jsxs("div",{className:"min-w-0",children:[g.jsx("div",{className:"text-base sm:text-xl font-bold text-slate-900 dark:text-white truncate",children:"FPM BuildTrack"}),g.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 hidden sm:block",children:"Project Management"})]})]}),g.jsxs("div",{className:"ml-auto flex items-center gap-2 sm:gap-4 flex-shrink-0",children:[g.jsx("button",{onClick:c,className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all",title:`Switch to ${u==="light"?"dark":"light"} mode`,children:u==="light"?"":""}),g.jsxs("div",{className:"hidden sm:flex items-center gap-2 sm:gap-3 bg-slate-50 dark:bg-slate-800 px-3 sm:px-4 py-2 rounded-lg",children:[g.jsx("span",{className:"text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300",children:"Role:"}),g.jsxs("select",{value:t,onChange:S=>r(S.target.value),className:"bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-md px-2 sm:px-3 py-1 text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[g.jsx("option",{value:"site_manager",children:"Site Manager"}),g.jsx("option",{value:"project_manager",children:"Project Manager"}),g.jsx("option",{value:"portfolio_manager",children:"Portfolio Manager"})]})]}),!s&&g.jsx("span",{className:"text-xs px-2 py-1 sm:px-3 sm:py-2 bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-200 rounded-full font-medium flex-shrink-0",children:""})]})]}),g.jsx("nav",{className:"max-w-7xl mx-auto px-3 sm:px-6 pb-2 sm:pb-4 flex gap-1 overflow-x-auto scrollbar-hide",children:FM.map(S=>g.jsx("button",{className:`px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap transition-all flex-shrink-0 ${n===S.key?"bg-blue-600 text-white shadow-lg shadow-blue-200 dark:shadow-blue-900":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800"}`,onClick:()=>e(S.key),children:S.label},S.key))})]}),g.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 py-4 sm:py-8 bg-gradient-to-br from-slate-50 via-blue-50 to-slate-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 min-h-[calc(100vh-120px)]",children:[!o&&g.jsxs("div",{className:"text-center py-12",children:[g.jsx("div",{className:"inline-block",children:g.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-blue-600 border-t-transparent rounded-full"})}),g.jsx("p",{className:"mt-4 text-slate-600 dark:text-slate-400",children:"Initializing..."})]}),o&&g.jsxs(g.Fragment,{children:[!f&&g.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900 border border-amber-200 dark:border-amber-800 rounded-lg text-sm text-amber-800 dark:text-amber-200 flex items-center gap-3",children:[g.jsx("span",{children:""}),g.jsx("span",{children:"Firebase is not configured. Add values to .env for full functionality."})]}),f&&n==="dashboard"&&g.jsx(IO,{db:k,role:t}),f&&n==="tasks"&&g.jsx(TO,{db:k,role:t}),f&&n==="budget"&&g.jsx(bO,{db:k,role:t}),f&&n==="reports"&&g.jsx(SO,{db:k,role:t}),f&&n==="contractors"&&g.jsx(kO,{db:k}),f&&n==="media"&&g.jsx(AO,{db:k}),n==="ask"&&g.jsx(VM,{db:k,role:t}),n==="pro"&&g.jsx(OM,{db:k,role:t})]})]})]})}const $M=qE(document.getElementById("root"));$M.render(g.jsx(xO,{children:g.jsx(UM,{})}));
